<!DOCTYPE html>

<html>

<body>
	<header>
		<h1><b>Disfigure</b></h1>
		<h3>Blending one posture to another posture</h3></br>
	</header>

	<div id="spinner"></div>

	<script src="importmap.js"></script>
	<script type="module">

		import * as Three from 'three';
		import * as Happy from 'disfigure';


		// create a default world

		new Happy.World( );
		Happy.controls.autoRotate = true;
		Happy.controls.target.y = 0.7;


		// create a man with a posture
		
		var man = new Happy.Man( ),
			manA = new Happy.Man( ),
			manB = new Happy.Man( );

		var postureA = man.posture,
			postureB = { "version": 8, "position": [ 0, 0, 0 ], "rotation": [ 0, 0, 0, "XYZ" ], "angles": [ 8, 0, 0, -4, 4, -6, 3, -34, 0, -5, -60, -8, -7, -1, 25, 0, 0, 0, 52, 0, 0, 0, -4, 0, -32, 0, -23, -23, 0, 0, 49, 26, 40, 0, 45, 0, 88, 0, 0, 0, 6, 0, -16, 0, 5, 0, 0, 0, 0, 7, 7, 0, 140, 0, 0, 0, 0, 0, 0, -25, 5, -20, 12, 0, 50, 0, 50, 0, 0, 0, -5, -17 ] };

		
		manA.material.wireframe = true;
		manB.material.wireframe = true;

		// man's stick

		var geometry = new Three.CylinderGeometry( 0.01, 0.01, 1.8 ),
			material = new Three.MeshStandardMaterial( { color: 'crimson' } ),
			stick = new Three.Mesh( geometry, material );

		stick.rotation.set( 1.5, 0, 0 );
		stick.position.set( -0.1, -0.03, 0 );
		stick.castShadow = true;

		man.r_wrist.attach( stick );

		// set the start position, standing on the floor
		manA.posture = postureA;
		manA.l_foot.lockTo( 0, 0, 0.1, 0, 0.02, 0 );
		postureA = manA.posture;
		
		// set the end position, standing on the floor
		manB.posture = postureB;
		manB.l_foot.lockTo( 0, 0, 0.1, 0, 0.02, 0 );
		postureB = manB.posture;
		

		Happy.setAnimationLoop( ( t )=>{

			var k = Happy.regular( t/400 + Math.sin( t/400 * 2 )/2, 0, 0, 1 );
			k = Math.min( k, 1 );
			k = Math.max( k, 0 );

			// make intermediate position, standin on the floor
			man.blend( postureA, postureB, k );
			man.l_foot.lockTo( 0, 0, 0.1, 0, 0.02, 0 );

		} );

	</script>
</body>
</html>