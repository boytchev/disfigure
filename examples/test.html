<!DOCTYPE html>

<html>

<head>
	<script src="importmap.js"></script>
</head>

<body>
	<script type="module">
	
		import * as THREE from 'three';
		import * as HAPPY from 'disfigure';
		
		new HAPPY.World( {stats:true} );
		
		var a = new HAPPY.Man( );
		a.position.set( 0.4, 0, 0 );

		var b = new HAPPY.Woman( );
		b.position.set( -0.4, 0, 0 );

		var c = new HAPPY.Child( );
		c.position.set( 0, 0, 0.5 );

		var box = new THREE.Mesh(
			new THREE.BoxGeometry( 1, 0.2, 0.01, 100, 10, 1 ),
			new THREE.MeshStandardMaterial( {color: 'crimson'} )
		)
		
		a.head.attach( box );
console.log(a.posture.headMatrix.value.elements)		
		var anim = (e)=>{

//var m = new THREE.Matrix3().copy( a.posture.headMatrix.value );
//m.premultiply(a.posture.chestMatrix.value);
//m.premultiply(a.posture.waistMatrix.value);
//box.matrix.setFromMatrix3( m );
//box.matrix.transpose();
//box.matrix.elements[13] = 1.7;

			var m = e.target;
			var t = e.time/2000 + m.uid;

			m.head.bend = HAPPY.chaotic( t, 0, -30, 50 );
			m.head.turn = HAPPY.chaotic( t, 4, -60, 60 );
			m.head.tilt = HAPPY.chaotic( t, 2, -50, 50 );

			m.chest.bend = HAPPY.chaotic( t, 1, -20, 40 );
			m.chest.turn = HAPPY.chaotic( t, 6, -60, 60 );
			m.chest.tilt = HAPPY.chaotic( t, 6, -30, 30 );
			
			m.waist.bend = HAPPY.chaotic( t, 3, -20, 40 );
			m.waist.turn = HAPPY.chaotic( t, 5, -60, 60 );
			m.waist.tilt = HAPPY.chaotic( t, 6, -30, 30 );



			m.elbowLeft.bend = HAPPY.chaotic( t, 9, 0, 140 );
			m.elbowRight.bend = HAPPY.chaotic( t, 7, 0, 140 );

			m.wristLeft.bend = HAPPY.chaotic( t, -2, -60, 60 );
			m.wristLeft.turn = HAPPY.chaotic( t, -3, -45, 45 );
			m.wristLeft.tilt = HAPPY.chaotic( t, -2, -40, 40 );

			m.wristRight.bend = HAPPY.chaotic( t, -1, -60, 60 );
			m.wristRight.turn = HAPPY.chaotic( t, -4, -45, 45 );
			m.wristRight.tilt = HAPPY.chaotic( t, -1, -40, 40 );
			
			m.armLeft.straddle = HAPPY.chaotic( t, 5, -50, 40 );
			m.armLeft.turn = HAPPY.chaotic( t, 6, -20, 20 );
			m.armLeft.foreward = HAPPY.chaotic( t, 7, -20, 80 );

			m.armRight.straddle = HAPPY.chaotic( t, -5, -50, 40 );
			m.armRight.turn = HAPPY.chaotic( t, -6, -20, 20 );
			m.armRight.foreward = HAPPY.chaotic( t, -7, -20, 80 );



			m.kneeLeft.bend = HAPPY.chaotic( t, 6, 0, 140 );
			m.kneeRight.bend = HAPPY.chaotic( t, 0, 0, 140 );
			
			m.footLeft.bend = HAPPY.chaotic( t, 7, -40, 40 );
			m.footRight.bend = HAPPY.chaotic( t, 5, -40, 40 );
			
			m.ankleLeft.bend = HAPPY.chaotic( t, -31, -40, 70 );
			m.ankleLeft.turn = HAPPY.chaotic( t, 22, 0, 70 );
			m.ankleLeft.tilt = HAPPY.chaotic( t, -2, -40, 40 );
			
			m.ankleRight.bend = HAPPY.chaotic( t, 1, -40, 70 );
			m.ankleRight.turn = HAPPY.chaotic( t, -11, 0, 70 );
			m.ankleRight.tilt = HAPPY.chaotic( t, -13, -40, 40 );

			m.legLeft.turn = HAPPY.chaotic( t, 8, -40, 80 );
			m.legLeft.straddle = HAPPY.chaotic( t, -8, 0, 40 );
			m.legLeft.foreward = HAPPY.chaotic( t, -2, -40, 80 );

			m.legRight.turn = HAPPY.chaotic( t, -1, -40, 80 );
			m.legRight.straddle = HAPPY.chaotic( t, -3, 0, 40 );
			m.legRight.foreward = HAPPY.chaotic( t, 4, -40, 80 );
		};
		
		a.addEventListener( 'animate', anim );
		b.addEventListener( 'animate', anim );
		c.addEventListener( 'animate', anim );

	</script>
</body>
</html>