/*! disfigure v0.0.7 */
"use strict";var e=require("three"),t=require("three/tsl");const o=t.Fn((([e])=>{var o=e.cos().toVar(),s=e.sin().toVar();return t.mat3(1,0,0,0,o,s,0,s.negate(),o)})).setLayout({name:"matRotX",type:"mat3",inputs:[{name:"angle",type:"float"}]}),s=t.Fn((([e])=>{var o=e.cos().toVar(),s=e.sin().toVar();return t.mat3(o,0,s.negate(),0,1,0,s,0,o)})).setLayout({name:"matRotY",type:"mat3",inputs:[{name:"angle",type:"float"}]}),r=t.Fn((([e])=>{var o=e.cos().toVar(),s=e.sin().toVar();return t.mat3(o,s,0,s.negate(),o,0,0,0,1)})).setLayout({name:"matRotZ",type:"mat3",inputs:[{name:"angle",type:"float"}]}),a=t.Fn((([e])=>{var t=o(e.x),a=s(e.y),i=r(e.z);return a.mul(t).mul(i)})).setLayout({name:"matRotYXZ",type:"mat3",inputs:[{name:"angles",type:"vec3"}]}),i=t.Fn((([e])=>{var t=o(e.x),a=s(e.y),i=r(e.z);return a.mul(i).mul(t)})).setLayout({name:"matRotYZX",type:"mat3",inputs:[{name:"angles",type:"vec3"}]}),n=t.Fn((([e])=>{var t=o(e.x),a=s(e.y),i=r(e.z);return t.mul(a).mul(i)})).setLayout({name:"matRotXYZ",type:"mat3",inputs:[{name:"angles",type:"vec3"}]}),m=t.Fn((([e])=>{var t=o(e.x),a=s(e.y),i=r(e.z);return t.mul(i).mul(a)})).setLayout({name:"matRotXZY",type:"mat3",inputs:[{name:"angles",type:"vec3"}]}),u=t.Fn((([e])=>{var t=o(e.x),a=s(e.y);return r(e.z).mul(t).mul(a)})).setLayout({name:"matRotZXY",type:"mat3",inputs:[{name:"angles",type:"vec3"}]}),l=t.Fn((([e])=>{var t=o(e.x),a=s(e.y);return r(e.z).mul(a).mul(t)})).setLayout({name:"matRotZYX",type:"mat3",inputs:[{name:"angles",type:"vec3"}]});class p{constructor(t,o,s,r,a){this.pivot=new e.Vector3(t,o,s),this.mirrorPivot=new e.Vector3(-t,o,s),this.min=r,this.max=a}}var f=t.Fn((([e,t,o,s])=>e.sub(t).mul(a(o.mul(s))).add(t))).setLayout({name:"jointRotate",type:"vec3",inputs:[{name:"pos",type:"vec3"},{name:"center",type:"vec3"},{name:"angle",type:"vec3"},{name:"amount",type:"float"}]}),y=t.Fn((([e,o,s,r])=>t.mix(e,e.sub(o).mul(m(s.mul(r))).mul(t.float(1).sub(r.mul(2*Math.PI).sub(Math.PI).cos().add(1).div(2).div(4).mul(s.z.cos().oneMinus()))).add(o),r.pow(.25)))).setLayout({name:"jointRotate2",type:"vec3",inputs:[{name:"pos",type:"vec3"},{name:"center",type:"vec3"},{name:"angle",type:"vec3"},{name:"amount",type:"float"}]});var h=t.Fn((({skeleton:e,posture:o,mode:s,vertex:r})=>{var a=r.toVar(),i=e.arm.fuzzy().toVar();t.If(i.greaterThan(0),(()=>{a.assign(f(a,s.mul(e.wrist.pivot),o.wristLeft,e.wrist.fuzzy())),a.assign(f(a,s.mul(e.forearm.pivot),o.forearmLeft,e.forearm.fuzzy())),a.assign(f(a,s.mul(e.elbow.pivot),o.elbowLeft,e.elbow.fuzzy())),a.assign(y(a,s.mul(e.arm.pivot),o.armLeft,i))}));var n=e.arm.mirrorFuzzy().toVar();t.If(n.greaterThan(0),(()=>{a.assign(f(a,s.mul(e.wrist.mirrorPivot),o.wristRight,e.wrist.mirrorFuzzy())),a.assign(f(a,s.mul(e.forearm.mirrorPivot),o.forearmRight,e.forearm.mirrorFuzzy())),a.assign(f(a,s.mul(e.elbow.mirrorPivot),o.elbowRight,e.elbow.mirrorFuzzy())),a.assign(y(a,s.mul(e.arm.mirrorPivot),o.armRight,n))})),a.assign(f(a,s.mul(e.head.pivot),o.head,e.head.fuzzy())),a.assign(f(a,s.mul(e.chest.pivot),o.chest,e.chest.fuzzy())),a.assign(f(a,s.mul(e.waist.pivot),o.waist,e.waist.fuzzy()));var m=e.hip.fuzzy().toVar();t.If(m.greaterThan(0),(()=>{a.assign(f(a,s.mul(e.foot.pivot),o.footLeft,e.foot.fuzzy())),a.assign(f(a,s.mul(e.ankle.pivot),o.ankleLeft,e.ankle.fuzzy())),a.assign(f(a,s.mul(e.leg.pivot),o.legLeft,e.leg.fuzzy())),a.assign(f(a,s.mul(e.knee.pivot),o.kneeLeft,e.knee.fuzzy())),a.assign(f(a,s.mul(e.hip2.pivot),o.hip2Left,e.hip2.fuzzy())),a.assign(f(a,s.mul(e.hip.pivot),o.hipLeft,m))}));var u=e.hip.mirrorFuzzy().toVar();return t.If(u.greaterThan(0),(()=>{a.assign(f(a,s.mul(e.foot.mirrorPivot),o.footRight,e.ankle.fuzzy())),a.assign(f(a,s.mul(e.ankle.mirrorPivot),o.ankleRight,e.ankle.fuzzy())),a.assign(f(a,s.mul(e.leg.mirrorPivot),o.legRight,e.leg.fuzzy())),a.assign(f(a,s.mul(e.knee.mirrorPivot),o.kneeRight,e.knee.fuzzy())),a.assign(f(a,s.mul(e.hip2.mirrorPivot),o.hip2Right,e.hip2.fuzzy())),a.assign(f(a,s.mul(e.hip.mirrorPivot),o.hipRight,u))})),a})),c=t.Fn((({skeleton:e,posture:o})=>{var s=o.select,r=t.float(0).add(e.head.fuzzy().mul(t.select(s.equal(1),1,0))).add(e.chest.fuzzy().mul(t.select(s.equal(2),1,0))).add(e.waist.fuzzy().mul(t.select(s.equal(3),1,0))).add(e.hip.fuzzy().mul(t.select(s.equal(11),1,0))).add(e.leg.fuzzy().mul(t.select(s.equal(12),1,0))).add(e.knee.fuzzy().mul(t.select(s.equal(13),1,0))).add(e.ankle.fuzzy().mul(t.select(s.equal(14),1,0))).add(e.foot.fuzzy().mul(t.select(s.equal(16),1,0))).add(e.hip2.fuzzy().mul(t.select(s.equal(15),1,0))).add(e.arm.fuzzy().mul(t.select(s.equal(21),1,0))).add(e.elbow.fuzzy().mul(t.select(s.equal(22),1,0))).add(e.forearm.fuzzy().mul(t.select(s.equal(23),1,0))).add(e.wrist.fuzzy().mul(t.select(s.equal(24),1,0))).clamp(0,1).negate().toVar();return t.If(r.lessThan(-.999),(()=>{r.assign(.2)})),t.vec3(0,r.div(2),r.div(1))})),v=t.Fn((()=>{var e=t.positionGeometry,o=t.float(0).add(e.x.mul(72).cos().smoothstep(.9,1)).add(e.y.mul(74).cos().smoothstep(.9,1)).add(e.z.mul(74).add(e.y.mul(4.5).add(.5).cos().mul(1).add(2.5)).abs().smoothstep(.6,0)).smoothstep(.6,1).oneMinus().pow(.1);return t.vec3(o)}));exports.LocusT=class extends p{constructor(e,t,o,s,r,a){super(e,t,o,s,r),this.topY=a}fuzzy(){var e=t.positionGeometry.x,o=t.positionGeometry.y;return o.step(this.topY).mul(e.smoothstep(-.01,.015)).mul(o.smoothstep(e.div(.7).add(this.min),e.div(7).add(this.max))).pow(2)}mirrorFuzzy(){var e=t.positionGeometry.x,o=t.positionGeometry.y;return o.step(this.topY).mul(e.smoothstep(.01,-.015)).mul(o.smoothstep(e.div(-.7).add(this.min),e.div(-7).add(this.max))).pow(2)}},exports.LocusX=class extends p{fuzzy(){return t.positionGeometry.x.smoothstep(this.min,this.max)}mirrorFuzzy(){return t.positionGeometry.x.smoothstep(-this.min,-this.max)}},exports.LocusXY=class extends p{constructor(e,t,o,s,r,a,i){super(e,t,o,s,r),this.minY=a,this.maxY=i}fuzzy(){var e=t.positionGeometry.x.smoothstep(this.min,this.max),o=t.positionGeometry.y.smoothstep(this.minY,this.maxY);return e.mul(o)}mirrorFuzzy(){var e=t.positionGeometry.x.smoothstep(-this.min,-this.max),o=t.positionGeometry.y.smoothstep(this.minY,this.maxY);return e.mul(o)}},exports.LocusY=class extends p{fuzzy(){return t.positionGeometry.y.smoothstep(this.min,this.max)}},exports.LocusYZ=class extends p{constructor(e,t,o,s,r,a){super(e,t,o,s,r),this.slope=Math.tan((90-a)*Math.PI/180)}fuzzy(){return t.positionGeometry.y.add(t.positionGeometry.z.div(this.slope)).smoothstep(this.min,this.max)}},exports.credits=function(e,t){var o=new XMLHttpRequest;o.onreadystatechange=function(){4==this.readyState&&200==this.status&&(document.getElementById(t).innerHTML=this.responseText.split("||")[0])},(e=e.split(".")).pop(),e.push("txt"),e=e.join("."),o.open("GET",e,!0),o.send()},exports.matRotXYZ=n,exports.matRotXZY=m,exports.matRotYXZ=a,exports.matRotYZX=i,exports.matRotZXY=u,exports.matRotZYX=l,exports.processModel=function(t,o,s,r){return function(t){var o=[];t.traverse((t=>{if(t.isMesh){var s=t.geometry.clone().applyMatrix4(t.matrixWorld),r=t.material.clone();o.push(new e.Mesh(s,r))}})),t.clear(),t.position.set(0,0,0),t.rotation.set(0,0,0,"XYZ"),t.scale.set(1,1,1),t.add(...o)}(t),function(t,o,s,r){t.traverse((t=>{if(t.isMesh){var a=new e.MeshPhysicalNodeMaterial;Object.assign(a,t.material),a.metalness=.1,a.roughness=.6,r.colorNode&&(a.colorNode=r.colorNode()),r.positionNode&&(a.positionNode=r.positionNode({skeleton:o,posture:s})),r.normalNode&&(a.normalNode=r.normalNode({skeleton:o,posture:s})),r.emissiveNode&&(a.emissiveNode=r.emissiveNode({skeleton:o,posture:s})),t.material=a}}))}(t,o,s,r),function(t){var o=new e.Vector3;(new e.Box3).setFromObject(t,!0).getCenter(o),t.position.sub(o)}(t),t},exports.tslColorNode=v,exports.tslEmissiveNode=c,exports.tslNormalNode=function(e){return e.vertex=t.normalGeometry,e.mode=t.float(0),t.transformNormalToView(h(e)).normalize()},exports.tslPositionNode=function(e){return e.vertex=t.positionGeometry,e.mode=t.float(1),h(e)},exports.tslPosture=function(){return{head:t.uniform(t.vec3(0,0,0)),chest:t.uniform(t.vec3(0,0,0)),waist:t.uniform(t.vec3(0,0,0)),kneeLeft:t.uniform(t.vec3(0,0,0)),kneeRight:t.uniform(t.vec3(0,0,0)),ankleLeft:t.uniform(t.vec3(0,0,0)),ankleRight:t.uniform(t.vec3(0,0,0)),footLeft:t.uniform(t.vec3(0,0,0)),footRight:t.uniform(t.vec3(0,0,0)),hipLeft:t.uniform(t.vec3(0,0,0)),hip2Left:t.uniform(t.vec3(0,0,0)),hipRight:t.uniform(t.vec3(0,0,0)),hip2Right:t.uniform(t.vec3(0,0,0)),legLeft:t.uniform(t.vec3(0,0,0)),legRight:t.uniform(t.vec3(0,0,0)),elbowLeft:t.uniform(t.vec3(0,0,0)),elbowRight:t.uniform(t.vec3(0,0,0)),forearmLeft:t.uniform(t.vec3(0,0,0)),forearmRight:t.uniform(t.vec3(0,0,0)),wristLeft:t.uniform(t.vec3(0,0,0)),wristRight:t.uniform(t.vec3(0,0,0)),armLeft:t.uniform(t.vec3(0,0,0)),armRight:t.uniform(t.vec3(0,0,0))}};
