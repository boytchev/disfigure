/*! disfigure v0.0.7 */
"use strict";var e=require("three"),t=require("three/tsl"),a=require("three/addons/libs/lil-gui.module.min.js"),o=require("three/addons/controls/OrbitControls.js");function s(e){var t=Object.create(null);return e&&Object.keys(e).forEach((function(a){if("default"!==a){var o=Object.getOwnPropertyDescriptor(e,a);Object.defineProperty(t,a,o.get?o:{enumerable:!0,get:function(){return e[a]}})}})),t.default=e,Object.freeze(t)}var i=s(e),n=s(a);const r=t.Fn((([e])=>{var a=e.cos().toVar(),o=e.sin().toVar();return t.mat3(1,0,0,0,a,o,0,o.negate(),a)})).setLayout({name:"matRotX",type:"mat3",inputs:[{name:"angle",type:"float"}]}),l=t.Fn((([e])=>{var a=e.cos().toVar(),o=e.sin().toVar();return t.mat3(a,0,o.negate(),0,1,0,o,0,a)})).setLayout({name:"matRotY",type:"mat3",inputs:[{name:"angle",type:"float"}]}),u=t.Fn((([e])=>{var a=e.cos().toVar(),o=e.sin().toVar();return t.mat3(a,o,0,o.negate(),a,0,0,0,1)})).setLayout({name:"matRotZ",type:"mat3",inputs:[{name:"angle",type:"float"}]}),m=t.Fn((([e])=>{var t=r(e.x),a=l(e.y),o=u(e.z);return a.mul(t).mul(o)})).setLayout({name:"matRotYXZ",type:"mat3",inputs:[{name:"angles",type:"vec3"}]}),d=t.Fn((([e])=>{var t=r(e.x),a=l(e.y),o=u(e.z);return a.mul(o).mul(t)})).setLayout({name:"matRotYZX",type:"mat3",inputs:[{name:"angles",type:"vec3"}]}),h=t.Fn((([e])=>{var t=r(e.x),a=l(e.y),o=u(e.z);return t.mul(a).mul(o)})).setLayout({name:"matRotXYZ",type:"mat3",inputs:[{name:"angles",type:"vec3"}]}),p=t.Fn((([e])=>{var t=r(e.x),a=l(e.y),o=u(e.z);return t.mul(o).mul(a)})).setLayout({name:"matRotXZY",type:"mat3",inputs:[{name:"angles",type:"vec3"}]}),v=t.Fn((([e])=>{var t=r(e.x),a=l(e.y);return u(e.z).mul(t).mul(a)})).setLayout({name:"matRotZXY",type:"mat3",inputs:[{name:"angles",type:"vec3"}]}),c=t.Fn((([e])=>{var t=r(e.x),a=l(e.y);return u(e.z).mul(a).mul(t)})).setLayout({name:"matRotZYX",type:"mat3",inputs:[{name:"angles",type:"vec3"}]});var f=new i.Scene;f.background=new i.Color("whitesmoke");var y=new i.PerspectiveCamera(30,innerWidth/innerHeight);y.position.set(-2,1,3.5),y.lookAt(f.position);var g=new i.WebGPURenderer({antialias:!0});g.outputColorSpace=i.LinearSRGBColorSpace,g.setSize(innerWidth,innerHeight),document.body.appendChild(g.domElement),window.addEventListener("resize",(()=>{y.aspect=innerWidth/innerHeight,y.updateProjectionMatrix(),g.setSize(innerWidth,innerHeight)}));var x=new o.OrbitControls(y,g.domElement);x.enableDamping=!0,x.dampingFactor=.05;var z=new i.AmbientLight("white",1);f.add(z);var R=new i.DirectionalLight("white",2);R.position.set(0,0,1),f.add(R);var L,w=new i.AxesHelper,b={animate:!1},M={isolated:!1,randomize:function(e=i.MathUtils.randInt(Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER)){function t(e=-1,t=1){return i.MathUtils.seededRandom()*(t-e)+e}i.MathUtils.seededRandom(e),G.rotation.y+=t()-.2,k.waist.value.set(t()/4-.2,t()/2,t()/2.5),k.chest.value.set(t()/3,0,t()/3),k.head.value.set(t()/2,t()/2,t()/3),k.kneeLeft.value.set(-(t()+1)/1.5,0,0),k.kneeRight.value.set(-(t()+1)/1.5,0,0),k.footLeft.value.set(.5*t()+.15,0,0),k.footRight.value.set(.5*t()+.15,0,0),k.ankleLeft.value.set(t()/2,0,t()/4),k.ankleRight.value.set(t()/2,0,t()/4),k.legLeft.value.set(0,t()-.25,0),k.legRight.value.set(0,t()+.25,0),k.hipLeft.value.set(t()/1+.25,0,-(t()+1)/4),k.hip2Left.value.set(0,t(),0),k.hipRight.value.set(t()/1+.25,0,(t()+1)/4),k.hip2Right.value.set(0,t(),0),k.elbowLeft.value.set(0,t()+1,0),k.elbowRight.value.set(0,-(t()+1),0),k.forearmLeft.value.set(.5*(1.5*t()+1),0,0),k.forearmRight.value.set(.5*(1.5*t()+1),0,0),k.wristLeft.value.set(0,.5*t()+.1,.7*t()),k.wristRight.value.set(0,.5*t()+.1,-.7*t()),k.armLeft.value.set(.7*(t()/1.5-.15),0,.7*t()),k.armRight.value.set(.7*(t()/1.5-.15),0,.7*t()),N()}},k={},F={},G=new i.Group;function P(e){switch(G.add(w),e){case 1:w.position.copy(F.head.pivot);break;case 2:w.position.copy(F.chest.pivot);break;case 3:w.position.copy(F.waist.pivot);break;case 11:w.position.copy(F.hipLeftPos);break;case 15:w.position.copy(F.hip2.pivot);break;case 12:w.position.copy(F.leg.pivot);break;case 13:w.position.copy(F.knee.pivot);break;case 14:w.position.copy(F.ankle.pivot);break;case 16:w.position.copy(F.foot.pivot);break;case 21:w.position.copy(F.arm.pivot);break;case 22:w.position.copy(F.elbow.pivot);break;case 23:w.position.copy(F.forearm.pivot);break;case 24:w.position.copy(F.wrist.pivot);break;default:G.remove(w)}}function N(){for(var e of L.controllersRecursive())e.updateDisplay()}g.setAnimationLoop((function(e){var t;b.animate&&(t=e/1e3,k.waist.value.set(Math.sin(t)/4-.2,Math.cos(1.2*t)/2,Math.sin(3*t)/2.5),k.chest.value.set(Math.cos(3*t)/3,0,Math.cos(3*t*1.5)/3),k.head.value.set(Math.cos(3*t)/2,Math.sin(1.2*t*2)/2,Math.cos(3*t*1.5)/3),k.kneeLeft.value.set(-(Math.cos(3*t)+1)/1.5,0,0),k.kneeRight.value.set(-(Math.sin(2.4*t)+1)/1.5,0,0),k.footLeft.value.set(.5*Math.cos(1.7*t)+.15,0,0),k.footRight.value.set(.5*Math.sin(1.9*t)+.15,0,0),k.ankleLeft.value.set(Math.cos(3*t)/2,0*Math.cos(2.8*t)/2,Math.cos(2.2*t)/4),k.ankleRight.value.set(Math.sin(3.2*t)/2,0*Math.cos(2.3*t)/2,Math.sin(2.1*t)/4),k.legLeft.value.set(0,Math.cos(2.8*t)-.25,0),k.legRight.value.set(0,Math.cos(2.3*t)+.25,0),k.hipLeft.value.set(Math.cos(3*t)/1+.25,0,-(Math.cos(2.2*t)+1)/4),k.hip2Left.value.set(0,Math.cos(2.8*t),0),k.hipRight.value.set(Math.sin(2.2*t)/1+.25,0,(Math.sin(2.6*t)+1)/4),k.hip2Right.value.set(0,Math.sin(3.2*t),0),k.elbowLeft.value.set(0,Math.cos(2*t-1)+1,0),k.elbowRight.value.set(0,-(Math.sin(1.8*t)+1),0),k.forearmLeft.value.set(.5*(1.5*Math.cos(3.6*t-1)+1),0,0),k.forearmRight.value.set(.5*(1.5*Math.sin(1.8*t*3+1)+1),0,0),k.wristLeft.value.set(0,.5*Math.cos(3.6*t-1)+.1,.7*Math.cos(2.6*t+1)),k.wristRight.value.set(0,.5*Math.cos(3.6*t-1)+.1,-.7*Math.cos(2.6*t+1)),k.armLeft.value.set(.7*(Math.cos(3*t)/1.5-.15),0,.7*Math.cos(2.2*t)),k.armRight.value.set(.7*(Math.sin(2.4*t)/1.5-.15),0,.7*Math.sin(2.7*t)),N()),x.update(),R.position.copy(y.position),g.render(f,y)}));class Y{constructor(t,a,o,s,i){this.pivot=new e.Vector3(t,a,o),this.mirrorPivot=new e.Vector3(-t,a,o),this.min=s,this.max=i}}function E({hipLeftSpan:e}){var a=t.positionGeometry.x,o=t.positionGeometry.y;return o.sub(a.mul(2)).smoothstep(e.z,t.float(e.w).sub(a.mul(1.6))).mul(o.smoothstep(e.x,e.y)).mul(a.smoothstep(-.01,.01))}var B=t.Fn((([e,t,a,o])=>e.sub(t).mul(m(a.mul(o))).add(t))).setLayout({name:"jointRotate",type:"vec3",inputs:[{name:"pos",type:"vec3"},{name:"center",type:"vec3"},{name:"angle",type:"vec3"},{name:"amount",type:"float"}]}),q=t.Fn((([e,a,o,s])=>t.mix(e,e.sub(a).mul(p(o.mul(s))).mul(t.float(1).sub(s.mul(2*Math.PI).sub(Math.PI).cos().add(1).div(2).div(4).mul(o.z.cos().oneMinus()))).add(a),s.pow(.25)))).setLayout({name:"jointRotate2",type:"vec3",inputs:[{name:"pos",type:"vec3"},{name:"center",type:"vec3"},{name:"angle",type:"vec3"},{name:"amount",type:"float"}]});var A=t.Fn((({skeleton:e,posture:a,mode:o,vertex:s})=>{var i=s.toVar(),n=e.arm.fuzzy().toVar();t.If(n.greaterThan(0),(()=>{i.assign(B(i,o.mul(e.wrist.pivot),a.wristLeft,e.wrist.fuzzy())),i.assign(B(i,o.mul(e.forearm.pivot),a.forearmLeft,e.forearm.fuzzy())),i.assign(B(i,o.mul(e.elbow.pivot),a.elbowLeft,e.elbow.fuzzy())),i.assign(q(i,o.mul(e.arm.pivot),a.armLeft,n))}));var r=e.arm.mirrorFuzzy().toVar();t.If(r.greaterThan(0),(()=>{i.assign(B(i,o.mul(e.wrist.mirrorPivot),a.wristRight,e.wrist.mirrorFuzzy())),i.assign(B(i,o.mul(e.forearm.mirrorPivot),a.forearmRight,e.forearm.mirrorFuzzy())),i.assign(B(i,o.mul(e.elbow.mirrorPivot),a.elbowRight,e.elbow.mirrorFuzzy())),i.assign(q(i,o.mul(e.arm.mirrorPivot),a.armRight,r))})),i.assign(B(i,o.mul(e.head.pivot),a.head,e.head.fuzzy())),i.assign(B(i,o.mul(e.chest.pivot),a.chest,e.chest.fuzzy())),i.assign(B(i,o.mul(e.waist.pivot),a.waist,e.waist.fuzzy()));var l=E(e).toVar();t.If(l.greaterThan(0),(()=>{i.assign(B(i,o.mul(e.foot.pivot),a.footLeft,e.foot.fuzzy())),i.assign(B(i,o.mul(e.ankle.pivot),a.ankleLeft,e.ankle.fuzzy())),i.assign(B(i,o.mul(e.leg.pivot),a.legLeft,e.leg.fuzzy())),i.assign(B(i,o.mul(e.knee.pivot),a.kneeLeft,e.knee.fuzzy())),i.assign(B(i,o.mul(e.hip2.pivot),a.hip2Left,e.hip2.fuzzy())),i.assign(B(i,o.mul(e.hipLeftPos),a.hipLeft,l))}));var u=function({hipRightSpan:e}){var a=t.positionGeometry.x,o=t.positionGeometry.y;return o.add(a.mul(2)).smoothstep(e.z,t.float(e.w).add(a.mul(1.6))).mul(o.smoothstep(e.x,e.y)).mul(a.smoothstep(.01,-.01))}(e).toVar();return t.If(u.greaterThan(0),(()=>{i.assign(B(i,o.mul(e.foot.mirrorPivot),a.footRight,e.ankle.fuzzy())),i.assign(B(i,o.mul(e.ankle.mirrorPivot),a.ankleRight,e.ankle.fuzzy())),i.assign(B(i,o.mul(e.leg.mirrorPivot),a.legRight,e.leg.fuzzy())),i.assign(B(i,o.mul(e.knee.mirrorPivot),a.kneeRight,e.knee.fuzzy())),i.assign(B(i,o.mul(e.hip2.mirrorPivot),a.hip2Right,e.hip2.fuzzy())),i.assign(B(i,o.mul(e.hipRightPos),a.hipRight,u))})),i})),I=t.Fn((({skeleton:e,posture:a})=>{var o=a.select,s=t.float(0).add(e.head.fuzzy().mul(t.select(o.equal(1),1,0))).add(e.chest.fuzzy().mul(t.select(o.equal(2),1,0))).add(e.waist.fuzzy().mul(t.select(o.equal(3),1,0))).add(E(e).mul(t.select(o.equal(11),1,0))).add(e.leg.fuzzy().mul(t.select(o.equal(12),1,0))).add(e.knee.fuzzy().mul(t.select(o.equal(13),1,0))).add(e.ankle.fuzzy().mul(t.select(o.equal(14),1,0))).add(e.foot.fuzzy().mul(t.select(o.equal(16),1,0))).add(e.hip2.fuzzy().mul(t.select(o.equal(15),1,0))).add(e.arm.fuzzy().mul(t.select(o.equal(21),1,0))).add(e.elbow.fuzzy().mul(t.select(o.equal(22),1,0))).add(e.forearm.fuzzy().mul(t.select(o.equal(23),1,0))).add(e.wrist.fuzzy().mul(t.select(o.equal(24),1,0))).toVar();return s.assign(t.select(a.isolated,s.smoothstep(0,1).mul(2*Math.PI).sub(Math.PI).cos().add(1).div(2).pow(1/4).mul(1.1).negate(),s.clamp(0,1).pow(.75).negate())),t.vec3(0,s.div(2),s.div(1))})),X=t.Fn((()=>{var e=t.positionGeometry,a=t.float(0).add(e.x.mul(72).cos().smoothstep(.9,1)).add(e.y.mul(74).cos().smoothstep(.9,1)).add(e.z.mul(74).add(e.y.mul(4.5).add(.5).cos().mul(1).add(2.5)).abs().smoothstep(.6,0)).smoothstep(.6,1).oneMinus().pow(.1);return t.vec3(a)}));exports.LocusX=class extends Y{fuzzy(){return t.positionGeometry.x.smoothstep(this.min,this.max)}mirrorFuzzy(){return t.positionGeometry.x.smoothstep(-this.min,-this.max)}},exports.LocusXY=class extends Y{constructor(e,t,a,o,s,i,n){super(e,t,a,o,s),this.minY=i,this.maxY=n}fuzzy(){var e=t.positionGeometry.x.smoothstep(this.min,this.max),a=t.positionGeometry.y.smoothstep(this.minY,this.maxY);return e.mul(a)}mirrorFuzzy(){var e=t.positionGeometry.x.smoothstep(-this.min,-this.max),a=t.positionGeometry.y.smoothstep(this.minY,this.maxY);return e.mul(a)}},exports.LocusY=class extends Y{fuzzy(){return t.positionGeometry.y.smoothstep(this.min,this.max)}},exports.LocusYZ=class extends Y{constructor(e,t,a,o,s,i){super(e,t,a,o,s),this.slope=Math.tan((90-i)*Math.PI/180)}fuzzy(){return t.positionGeometry.y.add(t.positionGeometry.z.div(this.slope)).smoothstep(this.min,this.max)}},exports.createGui=function(e,a,o){F=e,(k=a).select=t.uniform(0,"int"),k.isolated=t.uniform(0,"int"),G=o,(L=new n.GUI).domElement.style.marginRight=0;var s=L.addFolder("DEBUG");function i(e,t,a=""){return`<div class="padded ${a}">${e} &nbsp; <span class="icon">${t}</span></div>`}return s.close(),s.add(k.select,"value",{Nothing:0,Head:1,Chest:2,Waist:3,Hip:11,Hip2:15,Leg:12,Knee:13,Ankle:14,Foot:16,Arm:21,Elbow:22,Forearm:23,Wrist:24}).name("Show").onChange(P),s.add(M,"isolated",!1).name("Isolated").onChange((()=>{k.isolated.value=M.isolated?1:0})),s.add(b,"animate",!1).name("Animate"),s.add(M,"randomize").name("Randomize"),(s=L.addFolder("TORSO")).add(k.head.value,"x",-.7,.5).name(i("Head","&#x2195;")),s.add(k.head.value,"z",-.5,.5).name(i("","&#x21B6;")),s.add(k.head.value,"y",-1,1).name(i("","&#x2194;")),s.add(k.chest.value,"x",-.7,.4).name(i("Chest","&#x2195;","border")),s.add(k.chest.value,"z",-.5,.5).name(i("","&#x21B6;")),s.add(k.waist.value,"x",-1,.6).name(i("Waist","&#x2195;","border")),s.add(k.waist.value,"z",-.5,.5).name(i("","&#x21B6;")),s.add(k.waist.value,"y",-1,1).name(i("","&#x2194;")),(s=L.addFolder("LEFT LEG").close()).add(k.hipLeft.value,"x",-.6,2.7).name(i("Leg","&#x2195;")),s.add(k.hipLeft.value,"z",-2.4,.2).name(i("","&#x21BA;")),s.add(k.hip2Left.value,"y",-1.4,1.4).name(i("","&#x2194;")),s.add(k.kneeLeft.value,"x",-2.6,0).name(i("Knee","&#x2195;","border")),s.add(k.ankleLeft.value,"x",-1,.7).name(i("Ankle","&#x2195;","border")),s.add(k.legLeft.value,"y",-3,3).name(i("","&#x2194;")),s.add(k.ankleLeft.value,"z",-.5,.5).name(i("","&#x21BA;")),s.add(k.footLeft.value,"x",-.3,.6).name(i("Foot","&#x2195;","border")),(s=L.addFolder("RIGHT LEG").close()).add(k.hipRight.value,"x",-.6,2.7).name(i("Leg","&#x2195;")),s.add(k.hipRight.value,"z",-.2,2.4).name(i("","&#x21BB;")),s.add(k.hip2Right.value,"y",-1.4,1.4).name(i("","&#x2194;")),s.add(k.kneeRight.value,"x",-2.6,0).name(i("Knee","&#x2195;","border")),s.add(k.ankleRight.value,"x",-1,.7).name(i("Ankle","&#x2195;","border")),s.add(k.legRight.value,"y",-3,3).name(i("","&#x2194;")),s.add(k.ankleRight.value,"z",-.5,.5).name(i("","&#x21BB;")),s.add(k.footRight.value,"x",-.3,.6).name(i("Foot","&#x2195;","border")),(s=L.addFolder("LEFT ARM").close()).add(k.armLeft.value,"z",-1.5,1.7).name(i("Arm","&#x2195;")),s.add(k.armLeft.value,"y",-.5,2).name(i("","&#x2194;")),s.add(k.armLeft.value,"x",-.5,.5).name(i("","&#x21BB;")),s.add(k.elbowLeft.value,"y",0,2.7).name(i("Elbow","&#x2195;","border")),s.add(k.wristLeft.value,"z",-1.4,1.4).name(i("Wrist","&#x2195;","border")),s.add(k.wristLeft.value,"y",-.6,.4).name(i("","&#x2194;")),s.add(k.forearmLeft.value,"x",-1.5,3).name(i("","&#x21BB;")),(s=L.addFolder("RIGHT ARM").close()).add(k.armRight.value,"z",-1.5,1.7).name(i("Arm","&#x2195;")),s.add(k.armRight.value,"y",-2,.5).name(i("","&#x2194;")),s.add(k.armRight.value,"x",-.5,.5).name(i("","&#x21BB;")),s.add(k.elbowRight.value,"y",-2.7,0).name(i("Elbow","&#x2195;","border")),s.add(k.wristRight.value,"z",-1.4,1.4).name(i("Wrist","&#x2195;","border")),s.add(k.wristRight.value,"y",-.4,.6).name(i("","&#x2194;")),s.add(k.forearmRight.value,"x",-1.5,3).name(i("","&#x21BB;")),L},exports.credits=function(e,t){var a=new XMLHttpRequest;a.onreadystatechange=function(){4==this.readyState&&200==this.status&&(document.getElementById(t).innerHTML=this.responseText.split("||")[0])},(e=e.split(".")).pop(),e.push("txt"),e=e.join("."),a.open("GET",e,!0),a.send()},exports.matRotXYZ=h,exports.matRotXZY=p,exports.matRotYXZ=m,exports.matRotYZX=d,exports.matRotZXY=v,exports.matRotZYX=c,exports.processModel=function(t,a,o,s){return function(t){var a=[];t.traverse((t=>{if(t.isMesh){var o=t.geometry.clone().applyMatrix4(t.matrixWorld),s=t.material.clone();a.push(new e.Mesh(o,s))}})),t.clear(),t.position.set(0,0,0),t.rotation.set(0,0,0,"XYZ"),t.scale.set(1,1,1),t.add(...a)}(t),function(t,a,o,s){t.traverse((t=>{if(t.isMesh){var i=new e.MeshPhysicalNodeMaterial;Object.assign(i,t.material),i.metalness=.1,i.roughness=.6,s.colorNode&&(i.colorNode=s.colorNode()),s.positionNode&&(i.positionNode=s.positionNode({skeleton:a,posture:o})),s.normalNode&&(i.normalNode=s.normalNode({skeleton:a,posture:o})),s.emissiveNode&&(i.emissiveNode=s.emissiveNode({skeleton:a,posture:o})),t.material=i}}))}(t,a,o,s),function(t){var a=new e.Vector3;(new e.Box3).setFromObject(t,!0).getCenter(a),t.position.sub(a)}(t),t},exports.scene=f,exports.tslColorNode=X,exports.tslEmissiveNode=I,exports.tslNormalNode=function(e){return e.vertex=t.normalGeometry,e.mode=t.float(0),t.transformNormalToView(A(e)).normalize()},exports.tslPositionNode=function(e){return e.vertex=t.positionGeometry,e.mode=t.float(1),A(e)},exports.tslPosture=function(){return{head:t.uniform(t.vec3(0,0,0)),chest:t.uniform(t.vec3(0,0,0)),waist:t.uniform(t.vec3(0,0,0)),kneeLeft:t.uniform(t.vec3(0,0,0)),kneeRight:t.uniform(t.vec3(0,0,0)),ankleLeft:t.uniform(t.vec3(0,0,0)),ankleRight:t.uniform(t.vec3(0,0,0)),footLeft:t.uniform(t.vec3(0,0,0)),footRight:t.uniform(t.vec3(0,0,0)),hipLeft:t.uniform(t.vec3(0,0,0)),hip2Left:t.uniform(t.vec3(0,0,0)),hipRight:t.uniform(t.vec3(0,0,0)),hip2Right:t.uniform(t.vec3(0,0,0)),legLeft:t.uniform(t.vec3(0,0,0)),legRight:t.uniform(t.vec3(0,0,0)),elbowLeft:t.uniform(t.vec3(0,0,0)),elbowRight:t.uniform(t.vec3(0,0,0)),forearmLeft:t.uniform(t.vec3(0,0,0)),forearmRight:t.uniform(t.vec3(0,0,0)),wristLeft:t.uniform(t.vec3(0,0,0)),wristRight:t.uniform(t.vec3(0,0,0)),armLeft:t.uniform(t.vec3(0,0,0)),armRight:t.uniform(t.vec3(0,0,0))}};
