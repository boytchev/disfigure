/*! disfigure v0.0.12 */
"use strict";var e=require("three"),t=require("three/addons/loaders/GLTFLoader.js"),o=require("three/tsl"),s=require("three/addons/math/SimplexNoise.js"),r=require("three/addons/controls/OrbitControls.js");function a(e){var t=Object.create(null);return e&&Object.keys(e).forEach((function(o){if("default"!==o){var s=Object.getOwnPropertyDescriptor(e,o);Object.defineProperty(t,o,s.get?s:{enumerable:!0,get:function(){return e[o]}})}})),t.default=e,Object.freeze(t)}var i=a(e);const n=o.Fn((([e])=>{var t=e.cos().toVar(),s=e.sin().toVar();return o.mat3(1,0,0,0,t,s,0,s.negate(),t)})).setLayout({name:"matRotX",type:"mat3",inputs:[{name:"angle",type:"float"}]}),l=o.Fn((([e])=>{var t=e.cos().toVar(),s=e.sin().toVar();return o.mat3(t,0,s.negate(),0,1,0,s,0,t)})).setLayout({name:"matRotY",type:"mat3",inputs:[{name:"angle",type:"float"}]}),u=o.Fn((([e])=>{var t=e.cos().toVar(),s=e.sin().toVar();return o.mat3(t,s,0,s.negate(),t,0,0,0,1)})).setLayout({name:"matRotZ",type:"mat3",inputs:[{name:"angle",type:"float"}]});o.Fn((([e])=>{var t=n(e.x),o=l(e.y),s=u(e.z);return o.mul(t).mul(s)})).setLayout({name:"matRotYXZ",type:"mat3",inputs:[{name:"angles",type:"vec3"}]});const m=o.Fn((([e])=>{var t=n(e.x),o=l(e.y),s=u(e.z);return o.mul(s).mul(t)})).setLayout({name:"matRotYZX",type:"mat3",inputs:[{name:"angles",type:"vec3"}]});o.Fn((([e])=>{var t=n(e.x),o=l(e.y),s=u(e.z);return t.mul(o).mul(s)})).setLayout({name:"matRotXYZ",type:"mat3",inputs:[{name:"angles",type:"vec3"}]});const h=o.Fn((([e])=>{var t=n(e.x),o=l(e.y),s=u(e.z);return t.mul(s).mul(o)})).setLayout({name:"matRotXZY",type:"mat3",inputs:[{name:"angles",type:"vec3"}]});o.Fn((([e])=>{var t=n(e.x),o=l(e.y);return u(e.z).mul(t).mul(o)})).setLayout({name:"matRotZXY",type:"mat3",inputs:[{name:"angles",type:"vec3"}]}),o.Fn((([e])=>{var t=n(e.x),o=l(e.y);return u(e.z).mul(o).mul(t)})).setLayout({name:"matRotZYX",type:"mat3",inputs:[{name:"angles",type:"vec3"}]});const c=o.Fn((([e,t,o])=>o.smoothstep(e,t).smoothstep(0,1).smoothstep(0,1))).setLayout({name:"smoother",type:"float",inputs:[{name:"edgeFrom",type:"float"},{name:"edgeTo",type:"float"},{name:"value",type:"float"}]});o.Fn((()=>o.vec3(1))),new s.SimplexNoise;var g=o.Fn((([e,t,o,s])=>e.sub(t).mul(m(o.mul(s))).add(t))).setLayout({name:"jointRotate",type:"vec3",inputs:[{name:"pos",type:"vec3"},{name:"center",type:"vec3"},{name:"angle",type:"vec3"},{name:"amount",type:"float"}]}),p=o.Fn((([e,t,o,s])=>e.sub(t).mul(h(o.mul(s))).add(t).toVar())).setLayout({name:"jointRotate2",type:"vec3",inputs:[{name:"pos",type:"vec3"},{name:"center",type:"vec3"},{name:"angle",type:"vec3"},{name:"amount",type:"float"}]});function f(e){return e.vertex=o.positionGeometry,e.mode=o.float(1),L(e)}function d(e){return e.vertex=o.normalGeometry,e.mode=o.float(0),o.transformNormalToView(L(e)).xyz}var L=o.Fn((({space:e,posture:t,mode:s,vertex:r})=>{var a=r.toVar(),i=e.armLeft.locus().toVar();o.If(i.greaterThan(0),(()=>{a.assign(g(a,s.mul(e.wristLeft.pivot),t.wristLeft,e.wristLeft.locus())),a.assign(g(a,s.mul(e.forearmLeft.pivot),t.forearmLeft,e.forearmLeft.locus())),a.assign(g(a,s.mul(e.elbowLeft.pivot),t.elbowLeft,e.elbowLeft.locus())),a.assign(p(a,s.mul(e.armLeft.pivot),t.armLeft,e.armLeft.locus()))}));var n=e.armRight.locus().toVar();o.If(n.greaterThan(0),(()=>{a.assign(g(a,s.mul(e.wristRight.pivot),t.wristRight,e.wristRight.locus())),a.assign(g(a,s.mul(e.forearmRight.pivot),t.forearmRight,e.forearmRight.locus())),a.assign(g(a,s.mul(e.elbowRight.pivot),t.elbowRight,e.elbowRight.locus())),a.assign(p(a,s.mul(e.armRight.pivot),t.armRight,e.armRight.locus()))})),a.assign(g(a,s.mul(e.head.pivot),t.head,e.head.locus())),a.assign(g(a,s.mul(e.chest.pivot),t.chest,e.chest.locus())),a.assign(g(a,s.mul(e.waist.pivot),t.waist,e.waist.locus()));var l=e.legLeft.locus().toVar();o.If(l.greaterThan(0),(()=>{a.assign(g(a,s.mul(e.footLeft.pivot),t.footLeft,e.footLeft.locus())),a.assign(g(a,s.mul(e.ankleLeft.pivot),t.ankleLeft,e.ankleLeft.locus())),a.assign(g(a,s.mul(e.ankleLongLeft.pivot),t.ankleLongLeft,e.ankleLongLeft.locus())),a.assign(g(a,s.mul(e.kneeLeft.pivot),t.kneeLeft,e.kneeLeft.locus())),a.assign(g(a,s.mul(e.legLongLeft.pivot),t.legLongLeft,e.legLongLeft.locus())),a.assign(g(a,s.mul(e.legLeft.pivot),t.legLeft,l))}));var u=e.legRight.locus().toVar();return o.If(u.greaterThan(0),(()=>{a.assign(g(a,s.mul(e.footRight.pivot),t.footRight,e.footRight.locus())),a.assign(g(a,s.mul(e.ankleRight.pivot),t.ankleRight,e.ankleRight.locus())),a.assign(g(a,s.mul(e.ankleLongRight.pivot),t.ankleLongRight,e.ankleLongRight.locus())),a.assign(g(a,s.mul(e.kneeRight.pivot),t.kneeRight,e.kneeRight.locus())),a.assign(g(a,s.mul(e.legLongRight.pivot),t.legLongRight,e.legLongRight.locus())),a.assign(g(a,s.mul(e.legRight.pivot),t.legRight,u))})),a}));function v(e,t,o=0){return t*e/1e3+o}function x(t,o){return new e.Vector3(v(t[0],o.scale,o.x),v(t[1],o.scale,o.y),v(t[2],o.scale,o.z))}function w(e){var t=Object.assign(Object.create(e),e);return t.pivot=t.pivot.clone(),t.pivot.x*=-1,t}class y{constructor(e,t,o,s=0,r){this.pivot=x(t,e),this.minY=v(o[0],e.scale,e.y),this.maxY=v(o[1],e.scale,e.y),r&&(this.minX=v(r[0],e.scale,e.x),this.maxX=v(r[1],e.scale,e.x)),this.slope=Math.tan((90-s)*Math.PI/180)}mirror(){var e=w(this);return"minX"in e&&(e.minX*=-1,e.maxX*=-1),e}locus(e=o.positionGeometry){var t=e.x,s=e.y,r=e.z;0!=this.angle&&(s=s.add(r.sub(this.pivot.z).div(this.slope)));var a=c(this.minY,this.maxY,s);return"minX"in this&&(a=a.max(c(this.minX,this.maxX,t.abs().add(s.sub(this.pivot.y))))),a}}class R{constructor(e,t,o,s=0){this.pivot=x(t,e),this.minX=v(o[0],e.scale,e.x),this.maxX=v(o[1],e.scale,e.x),this.slope=Math.tan((90-s)*Math.PI/180)}mirror(){var e=w(this);return e.minX*=-1,e.maxX*=-1,e}locus(e=o.positionGeometry){var t=e.x,s=e.z,r=o.float(this.minX),a=o.float(this.maxX);if(0!=this.angle){var i=s.sub(this.pivot.z).div(this.slope).max(.01).mul(t.sign());r=r.sub(i),a=a.add(i)}return c(r,a,t)}}class b extends R{constructor(e,t,o,s){super(e,t,o),this.minY=v(s[0],e.scale,e.y),this.maxY=v(s[1],e.scale,e.y)}locus(e=o.positionGeometry){var t=e.x,s=e.y,r=e.y.sub(this.pivot.y).div(4,t.sign()),a=.8;return o.float(1).mul(c(o.float(this.minX).sub(r),o.float(this.maxX).sub(r),t)).mul(o.min(c(this.minY,this.minY*a+(1-a)*this.maxY,s),c(this.maxY,this.maxY*a+(1-a)*this.minY,s))).pow(2)}}class k extends b{constructor(e,t,o,s,r=0){super(e,t,o,s),this.grown=r}locus(e=o.positionGeometry){var t=e.x,s=e.z;if(0==this.grown)var r=e.y.sub(t.abs().mul(.2)).add(s.mul(1/6)),a=o.vec3(e.x.mul(2),e.y,e.z.min(0)).sub(o.vec3(0,this.pivot.y,0)).length().smoothstep(0,.13).pow(10);else r=e.y.sub(t.abs().mul(.2)).add(s.abs().mul(.5)),a=o.vec3(e.x.mul(2),e.y,e.z.min(0)).sub(o.vec3(0,this.pivot.y,0)).length().smoothstep(0,.065).pow(10);return o.float(a).mul(t.smoothstep(this.minX,this.maxX),c(this.minY,this.maxY,r).pow(2))}}class Y{constructor(e,t){const o={LocusT:k,LocusX:R,LocusXY:b,LocusY:y};for(var s in t)if("_"!=s){var r=o[t[s].shift()];t[s]=new r(e,...t[s])}this._=t._,this.head=t.head,this.chest=t.chest,this.waist=t.waist,this.kneeLeft=t?.kneeLeft??t.knee,this.kneeRight=t?.kneeRight??t.knee.mirror(),this.ankleLeft=t?.ankleLeft??t.ankle,this.ankleRight=t?.ankleRight??t.ankle.mirror(),this.ankleLongLeft=t?.ankleLongLeft??t.ankleLong,this.ankleLongRight=t?.ankleLongRight??t.ankleLong.mirror(),this.legLongLeft=t?.legLongLeft??t.legLong,this.legLongRight=t?.legLongRight??t.legLong.mirror(),this.footLeft=t?.footLeft??t.foot,this.footRight=t?.footRight??t.foot.mirror(),this.legLeft=t?.legLeft??t.leg,this.legRight=t?.legRight??t.leg.mirror(),this.elbowLeft=t?.elbowLeft??t.elbow,this.elbowRight=t?.elbowRight??t.elbow.mirror(),this.forearmLeft=t?.forearmLeft??t.forearm,this.forearmRight=t?.forearmRight??t.forearm.mirror(),this.wristLeft=t?.wristLeft??t.wrist,this.wristRight=t?.wristRight??t.wrist.mirror(),this.armLeft=t?.armLeft??t.arm,this.armRight=t?.armRight??t.arm.mirror()}}var X=Object.freeze({__proto__:null,SPACE:{head:["LocusY",[0,878,-37],[838,923],30],chest:["LocusY",[0,661,-8],[438,929],0,[40,300]],waist:["LocusY",[0,570,-9],[310,840]],leg:["LocusT",[41,546,-19],[-2,2],[690,441]],legLong:["LocusY",[39,0,-19],[700,140]],knee:["LocusY",[50,286,-23],[341,218],20],ankle:["LocusY",[41,51,-1],[97,10],-10],ankleLong:["LocusY",[51,206,-29],[430,-10]],foot:["LocusY",[0,20,12],[111,-185],120],elbow:["LocusX",[238,815,-40],[230,260],0],forearm:["LocusX",[170,815,-38],[46,490]],wrist:["LocusX",[375,820,-40],[354,402]],arm:["LocusXY",[85,790,-40],[30,150],[600,900]]},URL:"man.glb"}),z=Object.freeze({__proto__:null,SPACE:{head:["LocusY",[0,872,-30],[827,919],30],chest:["LocusY",[0,661,-8],[438,929],0,[40,300]],waist:["LocusY",[0,570,-9],[350,840]],leg:["LocusT",[41,546,-19],[-2,2],[690,441]],legLong:["LocusY",[44,0,-19],[700,140]],knee:["LocusY",[50,286,-23],[341,218],20],ankle:["LocusY",[44,51,-4],[97,10],-10],ankleLong:["LocusY",[51,201,-29],[430,-33]],foot:["LocusY",[0,20,12],[111,-185],120],elbow:["LocusX",[238,815,-40],[230,260],0],forearm:["LocusX",[170,815,-38],[54,475]],wrist:["LocusX",[359,815,-34],[343,380]],arm:["LocusXY",[80,793,-40],[30,137],[600,900]]},URL:"woman.glb"}),S=Object.freeze({__proto__:null,SPACE:{head:["LocusY",[0,850,-32],[807,894],30],chest:["LocusY",[0,640,1],[419,914],0,[40,300]],waist:["LocusY",[0,530,-7],[285,836]],leg:["LocusT",[40,521,-9],[-1,1],[625,430],1],legLong:["LocusY",[46,0,-5],[700,140]],knee:["LocusY",[50,288,-12],[346,221],20],ankle:["LocusY",[54,48,-14],[81,33],-10],ankleLong:["LocusY",[51,201,-25],[430,-33]],foot:["LocusY",[0,20,6],[83,-200],120],elbow:["LocusX",[249,793,-56],[230,273],0],forearm:["LocusX",[170,794,-59],[54,475]],wrist:["LocusX",[398,802,-57],[384,409]],arm:["LocusXY",[80,793,-40],[30,137],[600,900]]},URL:"child.glb"});const M=2*Math.PI;var N,j=new t.GLTFLoader,C=[];function F(e){return(e=(e=(e%360+360)%360)>180?e-360:e)*M/360}class P extends i.Group{constructor(t){super(),this.castShadow=!0,this.receiveShadow=!0,this.dims={},this.posture=(t.SPACE,{head:o.uniform(o.vec3(0,0,0)),chest:o.uniform(o.vec3(0,0,0)),waist:o.uniform(o.vec3(0,0,0)),kneeLeft:o.uniform(o.vec3(0,0,0)),kneeRight:o.uniform(o.vec3(0,0,0)),ankleLeft:o.uniform(o.vec3(0,0,0)),ankleRight:o.uniform(o.vec3(0,0,0)),footLeft:o.uniform(o.vec3(0,0,0)),footRight:o.uniform(o.vec3(0,0,0)),legLeft:o.uniform(o.vec3(0,0,0)),legLongLeft:o.uniform(o.vec3(0,0,0)),legRight:o.uniform(o.vec3(0,0,0)),legLongRight:o.uniform(o.vec3(0,0,0)),ankleLongLeft:o.uniform(o.vec3(0,0,0)),ankleLongRight:o.uniform(o.vec3(0,0,0)),elbowLeft:o.uniform(o.vec3(0,0,0)),elbowRight:o.uniform(o.vec3(0,0,0)),forearmLeft:o.uniform(o.vec3(0,0,0)),forearmRight:o.uniform(o.vec3(0,0,0)),wristLeft:o.uniform(o.vec3(0,0,0)),wristRight:o.uniform(o.vec3(0,0,0)),armLeft:o.uniform(o.vec3(0,0,0)),armRight:o.uniform(o.vec3(0,0,0))}),j.load("../assets/models/"+t.URL,(o=>{var s=function(t){var o=[];t.traverse((t=>{if(t.isMesh){var s=t.geometry.clone().applyMatrix4(t.matrixWorld),r=t.material.clone();if(t.isSkinnedMesh){t.pose();for(var a=s.getAttribute("position"),i=s.getAttribute("normal"),n=new e.Vector3,l=0;l<a.count;l++)n.fromBufferAttribute(a,l),t.applyBoneTransform(l,n),a.setXYZ(l,...n),n.fromBufferAttribute(i,l),t.applyBoneTransform(l,n),i.setXYZ(l,...n)}var u=new e.Mesh(s,r);u.frustumCulled=!1,o.push(u)}}));var s=new e.Group;return s.add(...o),s}(o.scene);!function(t,o){var s=new e.Vector3,r=(new e.Box3).setFromObject(t,!0);r.getCenter(s),t.position.sub(s),o.x=(r.max.x+r.min.x)/2,o.y=r.min.y,o.z=(r.max.z+r.min.z)/2,o.scale=Math.max(r.max.x-r.min.x,r.max.y-r.min.y,r.max.z-r.min.z)}(s,this.dims),function(t,o,s,r,a){t.traverse((t=>{if(t.isMesh){var i=new e.MeshPhysicalNodeMaterial;Object.assign(i,t.material),Object.assign(i,a),r.colorNode&&(i.colorNode=r.colorNode()),r.positionNode&&(i.positionNode=r.positionNode({space:o,posture:s})),r.normalNode&&(i.normalNode=r.normalNode({space:o,posture:s})),r.emissiveNode&&(i.emissiveNode=r.emissiveNode({space:o,posture:s})),t.material=i,t.castShadow=!0,t.receiveShadow=!0}}))}(s,new Y(this.dims,t.SPACE),this.posture,{positionNode:f,normalNode:d},{color:new i.Color(16699833),metalness:0,roughness:.6}),s.position.y=-this.dims.y/2,s.castShadow=!0,s.receiveShadow=!0,this.add(s),C.push(this)}))}head(e,t=0,o=0){this.posture.head.value.set(e,t,o)}get headNod(){return this.posture.head.value.x}set headNod(e){this.posture.head.value.x=F(e)}get headSpin(){return this.posture.head.value.y}set headSpin(e){this.posture.head.value.y=F(e)}get headTilt(){return this.posture.head.value.z}set headTilt(e){this.posture.head.value.z=F(e)}get waistNod(){return this.posture.waist.value.x}set waistNod(e){this.posture.waist.value.x=F(e)}get waistSpin(){return this.posture.waist.value.y}set waistSpin(e){this.posture.waist.value.y=F(e)}}exports.renderer=void 0,exports.scene=void 0,exports.camera=void 0,exports.light=void 0,exports.cameraLight=void 0,exports.controls=void 0;class O extends Event{#e;constructor(e){super(e)}get target(){return this.#e}set target(e){this.#e=e}}function T(){var e=new Event("animate");window.dispatchEvent(e),e=new O("animate"),C.forEach((t=>{e.target=t,t.dispatchEvent(e)})),N&&N(e.timeStamp),exports.controls&&exports.controls.update(),exports.renderer.render(exports.scene,exports.camera)}exports.Child=class extends P{constructor(){super(S)}},exports.Man=class extends P{constructor(){super(X),this.posture.legLeft.value.z=-.1,this.posture.legRight.value.z=.1,this.posture.ankleLeft.value.z=.1,this.posture.ankleRight.value.z=-.1}},exports.Woman=class extends P{constructor(){super(z),this.posture.legLeft.value.z=.05,this.posture.legRight.value.z=-.05}},exports.everybody=C,exports.setAnimationLoop=function(e){N=e},exports.world=function(e){if(exports.renderer=new i.WebGPURenderer({antialias:!0}),exports.renderer.setSize(innerWidth,innerHeight),exports.renderer.shadowMap.enabled=!0,exports.renderer.shadowMap.type=i.PCFSoftShadowMap,document.body.appendChild(exports.renderer.domElement),document.body.style.overflow="hidden",document.body.style.margin="0",exports.scene=new i.Scene,exports.scene.background=new i.Color("whitesmoke"),exports.camera=new i.PerspectiveCamera(30,innerWidth/innerHeight),exports.camera.position.set(0,1,4),exports.camera.lookAt(0,1,0),(e?.lights??1)&&(exports.light=new i.DirectionalLight("white",2),exports.light.decay=0,exports.light.position.set(0,2,1).setLength(15),exports.light.shadow.mapSize.width=2048,exports.light.shadow.mapSize.height=exports.light.shadow.mapSize.width,exports.light.shadow.camera.near=1,exports.light.shadow.camera.far=50,exports.light.shadow.camera.left=-5,exports.light.shadow.camera.right=5,exports.light.shadow.camera.top=5,exports.light.shadow.camera.bottom=-5,exports.light.shadow.normalBias=.01,exports.light.autoUpdate=!1,exports.light.castShadow=!0,exports.scene.add(exports.light),exports.cameraLight=new i.DirectionalLight("white",2),exports.cameraLight.decay=0,exports.cameraLight.target=exports.scene,exports.camera.add(exports.cameraLight),exports.scene.add(exports.camera)),(e?.controls??1)&&(exports.controls=new r.OrbitControls(exports.camera,exports.renderer.domElement),exports.controls.enableDamping=!0,exports.controls.target.set(0,.8,0)),e?.ground??1){var t=document.createElement("CANVAS");t.width=128,t.height=128;var o=t.getContext("2d");o.fillStyle="white",o.filter="blur(10px)",o.beginPath(),o.arc(64,64,37.5,0,2*Math.PI),o.fill();var s=new i.Mesh(new i.CircleGeometry(50),new i.MeshLambertMaterial({color:"antiquewhite",transparent:!0,map:new i.CanvasTexture(t)}));s.receiveShadow=!0,s.rotation.x=-Math.PI/2,s.renderOrder=-1,exports.scene.add(s)}window.addEventListener("resize",(()=>{exports.camera.aspect=innerWidth/innerHeight,exports.camera.updateProjectionMatrix(),exports.renderer.setSize(innerWidth,innerHeight)})),exports.renderer.setAnimationLoop(T)};
