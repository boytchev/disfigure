/*! disfigure v0.0.18 */
"use strict";var e=require("three"),t=require("three/addons/loaders/GLTFLoader.js"),s=require("three/tsl"),r=require("three/addons/controls/OrbitControls.js"),i=require("three/addons/libs/stats.module.js"),o=require("three/addons/math/SimplexNoise.js"),a="undefined"!=typeof document?document.currentScript:null,n=s.Fn((([e,t])=>{var r=e.sub(t.pivot).mul(t.matrix).add(t.pivot);return s.mix(e,r,t.locus())})),h=s.Fn((([e,t])=>{var r=e.mul(t.matrix);return s.mix(e,r,t.locus())}));function l(e){return e.vertex=s.normalGeometry,e.fn=h,s.transformNormalToView(c(e))}var c=s.Fn((({fn:e,space:t,vertex:r})=>{var i=r.toVar();return s.If(t.l_arm.locus(),(()=>{i.assign(e(i,t.l_wrist)),i.assign(e(i,t.l_forearm)),i.assign(e(i,t.l_elbow)),i.assign(e(i,t.l_arm))})),s.If(t.r_arm.locus(),(()=>{i.assign(e(i,t.r_wrist)),i.assign(e(i,t.r_forearm)),i.assign(e(i,t.r_elbow)),i.assign(e(i,t.r_arm))})),s.If(t.l_leg.locus(),(()=>{i.assign(e(i,t.l_foot)),i.assign(e(i,t.l_ankle)),i.assign(e(i,t.l_shin)),i.assign(e(i,t.l_knee)),i.assign(e(i,t.l_thigh)),i.assign(e(i,t.l_leg))})),s.If(t.r_leg.locus(),(()=>{i.assign(e(i,t.r_foot)),i.assign(e(i,t.r_ankle)),i.assign(e(i,t.r_shin)),i.assign(e(i,t.r_knee)),i.assign(e(i,t.r_thigh)),i.assign(e(i,t.r_leg))})),i.assign(e(i,t.head)),i.assign(e(i,t.chest)),i.assign(e(i,t.waist)),i.assign(e(i,t.torso)),i}));exports.renderer=void 0,exports.scene=void 0,exports.camera=void 0,exports.light=void 0,exports.cameraLight=void 0,exports.controls=void 0,exports.ground=void 0;var d,p,m=[];class g extends Event{#e;constructor(){super("animate")}get target(){return this.#e}set target(e){this.#e=e}}var w=new g;function u(e){w.time=e,window.dispatchEvent(w),m.forEach((e=>{e.update(),e.dispatchEvent(w)})),d&&d(e),exports.controls&&exports.controls.update(),p&&p.update(),exports.renderer.render(exports.scene,exports.camera)}var _=0,x=document.getElementById("spinner");x&&setTimeout((()=>x.style.display="none"),3e3);const v=s.Fn((([e,t])=>t.smoothstep(e.x,e.y).smoothstep(0,1).smoothstep(0,1)),{edge:"vec2",value:"float",return:"float"});var f=s.Fn((([e,t,s,r])=>{var i=e.y,o=e.z;return i=i.add(o.sub(t.z).div(r)),v(s,i)}),{pos:"vec3",pivot:"vec3",rangeY:"vec2",slope:"float",return:"float"}),y=s.Fn((([e,t])=>v(t,e.x)),{pos:"vec3",rangeX:"vec2",return:"float"}),b=s.Fn((([e,t,r,i])=>{var o=e.x,a=e.y,n=a.sub(t.y).div(4,o.sign());return v(r,o.add(n)).mul(s.min(a.smoothstep(i.x,s.mix(i.x,i.y,.2)),a.smoothstep(i.y,s.mix(i.y,i.x,.2)))).pow(2)}),{pos:"vec3",pivot:"vec3",rangeX:"vec2",rangeY:"vec2",return:"float"}),k=s.Fn((([e,t,r,i,o])=>{var a=e.x,n=e.y,h=e.z,l=s.vec3(a.mul(2),n,h.min(0)).sub(s.vec3(0,t.y,0)).length().smoothstep(0,s.float(.13).div(s.float(o).add(1))).pow(10),c=n.sub(a.abs().mul(.2));return c=c.add(s.select(o.equal(1),h.abs().mul(.5),h.mul(1/6))),l.mul(a.smoothstep(r.x,r.y),v(i,c).pow(2))}),{pos:"vec3",pivot:"vec3",rangeX:"vec2",rangeY:"vec2",grown:"float",return:"float"});class S{constructor(t){this.pivot=new e.Vector3(...t),this.angle=new e.Vector3,this.matrix=s.uniform(s.mat3()),this.isRight=!1}mirror(){return this.isRight=!0,this.pivot.x*=-1,this.rangeX&&(this.rangeX.value.x*=-1,this.rangeX.value.y*=-1),this}}class M extends S{constructor(e,t,r=0){super(e),this.rangeY=s.vec2(...t),this.slope=Math.tan((90-r)*Math.PI/180)}locus(){return f(s.positionGeometry,this.pivot,this.rangeY,this.slope)}}class L extends S{constructor(e,t){super(e),this.rangeX=s.vec2(...t)}locus(){return y(s.positionGeometry,this.rangeX)}}class P extends L{constructor(e,t,r){super(e,t),this.rangeY=s.vec2(...r)}locus(){return _++,x&&_>=12*m.length&&(x.style.display="none"),b(s.positionGeometry,this.pivot,this.rangeX,this.rangeY)}}class z extends P{constructor(e,t,s,r=0){super(e,t,s),this.grown=r}locus(){return k(s.positionGeometry,this.pivot,this.rangeX,this.rangeY,this.grown)}}class C{constructor(e){this.head=new M(...e.head),this.chest=new M(...e.chest),this.waist=new M(...e.waist),this.torso=new M(...e.torso),this.l_knee=new M(...e.knee),this.r_knee=new M(...e.knee).mirror(),this.l_ankle=new M(...e.ankle),this.r_ankle=new M(...e.ankle).mirror(),this.l_shin=new M(...e.shin),this.r_shin=new M(...e.shin).mirror(),this.l_thigh=new M(...e.thigh),this.r_thigh=new M(...e.thigh).mirror(),this.l_foot=new M(...e.foot),this.r_foot=new M(...e.foot).mirror(),this.l_leg=new z(...e.leg),this.r_leg=new z(...e.leg).mirror(),this.l_elbow=new L(...e.elbow),this.r_elbow=new L(...e.elbow).mirror(),this.l_forearm=new L(...e.forearm),this.r_forearm=new L(...e.forearm).mirror(),this.l_wrist=new L(...e.wrist),this.r_wrist=new L(...e.wrist).mirror(),this.l_arm=new P(...e.arm),this.r_arm=new P(...e.arm).mirror()}}var E=new t.GLTFLoader;const R=("undefined"==typeof document?require("url").pathToFileURL(__filename).href:a&&"SCRIPT"===a.tagName.toUpperCase()&&a.src||new URL("disfigure.min.cjs.js",document.baseURI).href).replace("/src/body.js","/assets/models/");var F=new e.Matrix3,G=new e.Matrix3,U=new e.Vector3;function j(e,t,s){Object.defineProperty(e,t,{get:()=>e.angle[s]/(2*Math.PI/360),set(t){e.angle[s]=t*(2*Math.PI/360)}})}class A extends e.Group{constructor(e,t,s,r="xyz"){super(),this.model=e,this.parent=t,this.pivot=s.pivot,this.angle=s.angle,this.matrix=s.matrix,this.isRight=s.isRight,this.position.copy(s.pivot),j(this,"bend",r[0]),j(this,"raise",r[0]),j(this,"tilt",r[2]),j(this,"straddle",r[2]),j(this,"foreward",r[0]),j(this,"turn",r[1])}attach(t){t.parent&&(t=t.clone());var s=new e.Group,r=new e.Group;s.add(r),r.add(t),s.matrixAutoUpdate=!1,s.joint=this,this.model.children[0].add(s),this.model.accessories.push(s)}}var I=new e.Matrix4,X=new e.Euler,q=new e.PlaneGeometry,N=1;class Y extends e.Group{constructor(t,r,i){var o;super(),this.url=t,this.uid=N,N+=.3+2*Math.random(),this.castShadow=!0,this.receiveShadow=!0,this.accessories=[],this.model=new e.Mesh(q),E.load(this.url,(t=>{this.model.geometry=t.scene.children[0].geometry;var s=(new e.Box3).setFromObject(this.model,!0),r=s.max.y-s.min.y;this.height=i??r,this.model.scale.setScalar(this.height/r)})),this.space=new C(r),this.torso=new A(this,null,this.space.torso),this.waist=new A(this,this.torso,this.space.waist),this.chest=new A(this,this.waist,this.space.chest),this.head=new A(this,this.chest,this.space.head),this.l_leg=new A(this,this.torso,this.space.l_leg),this.l_thigh=new A(this,this.l_leg,this.space.l_thigh),this.l_knee=new A(this,this.l_thigh,this.space.l_knee),this.l_shin=new A(this,this.l_knee,this.space.l_shin),this.l_ankle=new A(this,this.l_shin,this.space.l_ankle),this.l_foot=new A(this,this.l_ankle,this.space.l_foot),this.r_leg=new A(this,this.torso,this.space.r_leg),this.r_thigh=new A(this,this.r_leg,this.space.r_thigh),this.r_knee=new A(this,this.r_thigh,this.space.r_knee),this.r_shin=new A(this,this.r_knee,this.space.r_shin),this.r_ankle=new A(this,this.r_shin,this.space.r_ankle),this.r_foot=new A(this,this.r_ankle,this.space.r_foot),this.l_arm=new A(this,this.chest,this.space.l_arm,"yxz"),this.l_elbow=new A(this,this.l_arm,this.space.l_elbow,"yxz"),this.l_forearm=new A(this,this.l_elbow,this.space.l_forearm,"zxy"),this.l_wrist=new A(this,this.l_forearm,this.space.l_wrist,"zxy"),this.r_arm=new A(this,this.chest,this.space.r_arm,"yxz"),this.r_elbow=new A(this,this.r_arm,this.space.r_elbow,"yxz"),this.r_forearm=new A(this,this.r_elbow,this.space.r_forearm,"zxy"),this.r_wrist=new A(this,this.r_forearm,this.space.r_wrist,"zxy"),this.model.material=new e.MeshPhysicalNodeMaterial({positionNode:(o={space:this.space},o.vertex=s.positionGeometry,o.fn=n,c(o)),normalNode:l({space:this.space}),colorNode:s.vec3(.99,.65,.49),metalness:0,roughness:.6}),this.model.position.y=0,this.model.castShadow=!0,this.model.receiveShadow=!0,this.add(this.model),m.push(this),exports.scene&&exports.scene.add(this),this.l_arm.straddle=this.r_arm.straddle=65,this.l_elbow.bend=this.r_elbow.bend=20}update(){function e(e,t,s,r){X.set(t*e.angle.x,s*e.angle.y,r*e.angle.z,"YZX"),I.makeRotationFromEuler(X);var i=I.elements;e.matrix.value.set(i[0],i[4],i[8],i[1],i[5],i[9],i[2],i[6],i[10])}for(var t of(e(this.head,-1,-1,1),e(this.chest,-1,-1,1),e(this.waist,-1,-1,1),e(this.torso,-1,-1,1),e(this.l_elbow,0,1,0),e(this.r_elbow,0,-1,0),e(this.l_wrist,0,1,1),e(this.r_wrist,0,-1,-1),e(this.space.l_forearm,-1,0,0),e(this.space.r_forearm,-1,0,0),e(this.l_arm,-1,1,1),e(this.r_arm,-1,-1,-1),e(this.l_knee,-1,0,0),e(this.r_knee,-1,0,0),e(this.l_ankle,-1,0,-1),e(this.r_ankle,-1,0,1),e(this.space.l_shin,0,-1,0),e(this.space.r_shin,0,1,0),e(this.l_foot,-1,0,0),e(this.r_foot,-1,0,0),e(this.space.l_thigh,0,-1,0),e(this.space.r_thigh,0,1,0),e(this.l_leg,1,0,-1),e(this.r_leg,1,0,1),this.accessories)){var s=t.joint;for(G.identity(),U.copy(s.pivot);s;s=s.parent)F.copy(s.matrix.value).transpose(),G.premultiply(F),U.sub(s.pivot).applyMatrix3(F).add(s.pivot);t.matrix.setFromMatrix3(G),t.matrix.setPosition(U)}}}class T extends Y{static URL="man.glb";static SPACE={head:[[0,1.566,-.066],[1.495,1.647],30],chest:[[0,1.177,-.014],[.777,1.658],0,[.072,.538]],waist:[[0,1.014,-.016],[.547,1.498]],torso:[[0,1.014,-.016],[-3,-2]],leg:[[.074,.97,-.034],[-.004,.004],[1.229,.782]],thigh:[[.07,-.009,-.034],[1.247,.242]],knee:[[.09,.504,-.041],[.603,.382],20],ankle:[[.074,.082,-.002],[.165,.008],-10],shin:[[.092,.36,-.052],[.762,-.027]],foot:[[0,.026,.022],[.19,-.342],120],elbow:[[.427,1.453,-.072],[.413,.467]],forearm:[[.305,1.453,-.068],[.083,.879]],wrist:[[.673,1.462,-.072],[.635,.722]],arm:[[.153,1.408,-.072],[.054,.269],[1.067,1.606]]};constructor(e){super(R+T.URL,T.SPACE,e),this.l_leg.straddle=this.r_leg.straddle=5,this.l_ankle.tilt=this.r_ankle.tilt=-5,this.l_ankle.bend=this.r_ankle.bend=3}}class W extends Y{static URL="woman.glb";static SPACE={head:[[.001,1.471,-.049],[1.395,1.551],30],chest:[[.001,1.114,-.012],[.737,1.568],0,[.069,.509]],waist:[[.001,.961,-.014],[.589,1.417]],torso:[[.001,.961,-.014],[-1.696,-1.694]],leg:[[.071,.92,-.031],[-.002,.005],[1.163,.742]],thigh:[[.076,-.003,-.031],[1.18,.233]],knee:[[.086,.48,-.037],[.573,.365],20],shin:[[.088,.337,-.047],[.724,-.059]],ankle:[[.076,.083,-.005],[.161,.014],-10],foot:[[.001,.031,.022],[.184,-.316],120],elbow:[[.404,1.375,-.066],[.39,.441]],forearm:[[.289,1.375,-.063],[.093,.805]],wrist:[[.608,1.375,-.056],[.581,.644]],arm:[[.137,1.338,-.066],[.052,.233],[1.011,1.519]]};constructor(e){super(R+W.URL,W.SPACE,e),this.l_leg.straddle=this.r_leg.straddle=-2.9,this.l_ankle.tilt=this.r_ankle.tilt=2.9,this.l_ankle.bend=this.r_ankle.bend=3}}class V extends Y{static URL="child.glb";static SPACE={head:[[0,1.149,-.058],[1.091,1.209],30],chest:[[0,.865,-.013],[.566,1.236],0,[.054,.406]],waist:[[0,.717,-.024],[.385,1.13]],torso:[[0,.717,-.024],[-1.354,-1.353]],leg:[[.054,.704,-.027],[-.001,.001],[.845,.581],1],thigh:[[.062,-0,-.021],[.946,.189]],knee:[[.068,.389,-.031],[.468,.299],20],shin:[[.069,.272,-.048],[.581,-.045]],ankle:[[.073,.065,-.033],[.109,.044],-10],foot:[[0,.027,-.006],[.112,-.271],120],elbow:[[.337,1.072,-.09],[.311,.369]],forearm:[[.23,1.074,-.094],[.073,.642]],wrist:[[.538,1.084,-.091],[.519,.553]],arm:[[.108,1.072,-.068],[.041,.185],[.811,1.217]]};constructor(e){super(R+V.URL,V.SPACE,e),this.l_ankle.bend=this.r_ankle.bend=3}}var O=new o.SimplexNoise;console.log("\n%c⋮⋮⋮ Disfigure\n%chttps://boytchev.github.io/disfigure/\n","color: navy","font-size:80%"),exports.Child=V,exports.Man=T,exports.Woman=W,exports.World=class{constructor(t){if(exports.renderer=new e.WebGPURenderer({antialias:!0}),exports.renderer.setSize(innerWidth,innerHeight),exports.renderer.shadowMap.enabled=t?.shadows??!0,exports.renderer.shadowMap.type=e.PCFSoftShadowMap,document.body.appendChild(exports.renderer.domElement),document.body.style.overflow="hidden",document.body.style.margin="0",exports.scene=new e.Scene,exports.scene.background=new e.Color("whitesmoke"),exports.camera=new e.PerspectiveCamera(30,innerWidth/innerHeight),exports.camera.position.set(0,1,4),exports.camera.lookAt(0,1,0),t?.stats&&(p=new i,document.body.appendChild(p.dom)),(t?.lights??1)&&(exports.light=new e.DirectionalLight("white",1.5),exports.light.position.set(0,14,7),(t?.shadows??1)&&(exports.light.shadow.mapSize.width=2048,exports.light.shadow.mapSize.height=exports.light.shadow.mapSize.width,exports.light.shadow.camera.near=1,exports.light.shadow.camera.far=50,exports.light.shadow.camera.left=-5,exports.light.shadow.camera.right=5,exports.light.shadow.camera.top=5,exports.light.shadow.camera.bottom=-5,exports.light.shadow.normalBias=.01,exports.light.autoUpdate=!1,exports.light.castShadow=!0),exports.scene.add(exports.light),exports.cameraLight=new e.DirectionalLight("white",1.5),exports.cameraLight.target=exports.scene,exports.camera.add(exports.cameraLight),exports.scene.add(exports.camera)),(t?.controls??1)&&(exports.controls=new r.OrbitControls(exports.camera,exports.renderer.domElement),exports.controls.enableDamping=!0,exports.controls.target.set(0,.8,0)),t?.ground??1){var s=document.createElement("CANVAS");s.width=128,s.height=128;var o=s.getContext("2d");o.fillStyle="white",o.filter="blur(10px)",o.beginPath(),o.arc(64,64,38,0,2*Math.PI),o.fill(),exports.ground=new e.Mesh(new e.CircleGeometry(50),new e.MeshLambertMaterial({color:"antiquewhite",transparent:!0,map:new e.CanvasTexture(s)})),exports.ground.receiveShadow=!0,exports.ground.rotation.x=-Math.PI/2,exports.ground.renderOrder=-1,exports.scene.add(exports.ground)}window.addEventListener("resize",(()=>{exports.camera.aspect=innerWidth/innerHeight,exports.camera.updateProjectionMatrix(),exports.renderer.setSize(innerWidth,innerHeight)})),exports.renderer.setAnimationLoop(u)}},exports.chaotic=function(e,t=0,s=-1,r=1){return s+(r-s)*(O.noise(e,t)+1)/2},exports.everybody=m,exports.random=function(e=-1,t=1){return e+(t-e)*Math.random()},exports.regular=function(e,t=0,s=-1,r=1){return s+(r-s)*(Math.sin(e+t)+1)/2},exports.setAnimationLoop=function(e){d=e};
