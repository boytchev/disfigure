/*! disfigure v0.0.13 */
import*as t from"three";import{Mesh as e,Group as s,Vector3 as i,Box3 as o,MeshPhysicalNodeMaterial as a,WebGPURenderer as r,PCFSoftShadowMap as n,Scene as h,Color as l,PerspectiveCamera as u,DirectionalLight as m,CircleGeometry as g,MeshLambertMaterial as c,CanvasTexture as d}from"three";import{GLTFLoader as L}from"three/addons/loaders/GLTFLoader.js";import{Fn as f,mat3 as p,vec3 as w,If as v,uniform as R,normalGeometry as b,float as k,transformNormalToView as x,positionGeometry as y,min as Y}from"three/tsl";import{SimplexNoise as X}from"three/addons/math/SimplexNoise.js";import{OrbitControls as z}from"three/addons/controls/OrbitControls.js";const j=f((([t])=>{var e=t.cos(),s=t.sin();return p(1,0,0,0,e,s,0,s.negate(),e)}),{angle:"float",return:"mat3"}),S=f((([t])=>{var e=t.cos(),s=t.sin();return p(e,0,s.negate(),0,1,0,s,0,e)}),{angle:"float",return:"mat3"}),N=f((([t])=>{var e=t.cos(),s=t.sin();return p(e,s,0,s.negate(),e,0,0,0,1)}),{angle:"float",return:"mat3"});f((([t])=>{var e=j(t.x),s=S(t.y),i=N(t.z);return s.mul(e).mul(i)}),{angles:"vec3",return:"mat3"});const M=f((([t])=>{var e=j(t.x),s=S(t.y),i=N(t.z);return s.mul(i).mul(e)}),{angles:"vec3",return:"mat3"});f((([t])=>{var e=j(t.x),s=S(t.y),i=N(t.z);return e.mul(s).mul(i)}),{angles:"vec3",return:"mat3"});const _=f((([t])=>{var e=j(t.x),s=S(t.y),i=N(t.z);return e.mul(i).mul(s)}),{angles:"vec3",return:"mat3"});f((([t])=>{var e=j(t.x),s=S(t.y);return N(t.z).mul(e).mul(s)}),{angles:"vec3",return:"mat3"}),f((([t])=>{var e=j(t.x),s=S(t.y);return N(t.z).mul(s).mul(e)}),{angles:"vec3",return:"mat3"});const E=f((([t,e,s])=>s.smoothstep(t,e).smoothstep(0,1).smoothstep(0,1)),{edgeFrom:"float",edgeTo:"float",value:"float",return:"float"});f((()=>w(1)));var P=new X;function C(t,e=0,s=-1,i=1){return s+(i-s)*(P.noise(t,e)+1)/2}function O(t,e=0,s=-1,i=1){return s+(i-s)*(Math.sin(t+e)+1)/2}var T=f((([t,e,s,i])=>t.sub(e).mul(M(s.mul(i,w(-1,-1,1)))).add(e)),{pos:"vec3",center:"vec3",angle:"vec3",amount:"float",return:"vec3"}),Z=f((([t,e,s,i])=>t.sub(e).mul(_(s.mul(i,w(-1,-1,1)))).add(e).toVar()),{pos:"vec3",center:"vec3",angle:"vec3",amount:"float",return:"vec3"});function A(t){return t.vertex=y,t.mode=k(1),I(t)}function V(t){return t.vertex=b,t.mode=k(0),x(I(t)).xyz}var I=f((({space:t,posture:e,mode:s,vertex:i})=>{var o=i.toVar(),a=t.armLeft.locus().toVar();v(a.greaterThan(0),(()=>{o.assign(T(o,s.mul(t.wristLeft.pivot),e.wristLeft.mul(w(1,-1,1)),t.wristLeft.locus())),o.assign(T(o,s.mul(t.forearmLeft.pivot),e.forearmLeft,t.forearmLeft.locus())),o.assign(T(o,s.mul(t.elbowLeft.pivot),e.elbowLeft.mul(-1),t.elbowLeft.locus())),o.assign(Z(o,s.mul(t.armLeft.pivot),e.armLeft.mul(w(1,-1,1)),t.armLeft.locus()))}));var r=t.armRight.locus().toVar();v(r.greaterThan(0),(()=>{o.assign(T(o,s.mul(t.wristRight.pivot),e.wristRight.mul(w(1,1,-1)),t.wristRight.locus())),o.assign(T(o,s.mul(t.forearmRight.pivot),e.forearmRight,t.forearmRight.locus())),o.assign(T(o,s.mul(t.elbowRight.pivot),e.elbowRight,t.elbowRight.locus())),o.assign(Z(o,s.mul(t.armRight.pivot),e.armRight.mul(w(1,1,-1)),t.armRight.locus()))})),o.assign(T(o,s.mul(t.head.pivot),e.head,t.head.locus())),o.assign(T(o,s.mul(t.chest.pivot),e.chest,t.chest.locus())),o.assign(T(o,s.mul(t.waist.pivot),e.waist,t.waist.locus()));var n=t.legLeft.locus().toVar();v(n.greaterThan(0),(()=>{o.assign(T(o,s.mul(t.footLeft.pivot),e.footLeft,t.footLeft.locus())),o.assign(T(o,s.mul(t.ankleLeft.pivot),e.ankleLeft.mul(w(1,1,-1)),t.ankleLeft.locus())),o.assign(T(o,s.mul(t.ankleLongLeft.pivot),e.ankleLongLeft,t.ankleLongLeft.locus())),o.assign(T(o,s.mul(t.kneeLeft.pivot),e.kneeLeft,t.kneeLeft.locus())),o.assign(T(o,s.mul(t.legLongLeft.pivot),e.legLongLeft,t.legLongLeft.locus())),o.assign(T(o,s.mul(t.legLeft.pivot),e.legLeft.mul(w(-1,1,-1)),n))}));var h=t.legRight.locus().toVar();return v(h.greaterThan(0),(()=>{o.assign(T(o,s.mul(t.footRight.pivot),e.footRight,t.footRight.locus())),o.assign(T(o,s.mul(t.ankleRight.pivot),e.ankleRight,t.ankleRight.locus())),o.assign(T(o,s.mul(t.ankleLongRight.pivot),e.ankleLongRight.mul(-1),t.ankleLongRight.locus())),o.assign(T(o,s.mul(t.kneeRight.pivot),e.kneeRight,t.kneeRight.locus())),o.assign(T(o,s.mul(t.legLongRight.pivot),e.legLongRight.negate(),t.legLongRight.locus())),o.assign(T(o,s.mul(t.legRight.pivot),e.legRight.mul(w(-1,1,1)),h))})),o}));function U(t,e,s=0){return e*t/1e3+s}function W(t,e){return new i(U(t[0],e.scale,e.x),U(t[1],e.scale,e.y),U(t[2],e.scale,e.z))}function H(t){var e=Object.assign(Object.create(t),t);return e.pivot=e.pivot.clone(),e.pivot.x*=-1,e}class F{constructor(t,e,s,i=0,o){this.pivot=W(e,t),this.minY=U(s[0],t.scale,t.y),this.maxY=U(s[1],t.scale,t.y),o&&(this.minX=U(o[0],t.scale,t.x),this.maxX=U(o[1],t.scale,t.x)),this.slope=Math.tan((90-i)*Math.PI/180)}mirror(){var t=H(this);return"minX"in t&&(t.minX*=-1,t.maxX*=-1),t}locus(t=y){var e=t.x,s=t.y,i=t.z;0!=this.angle&&(s=s.add(i.sub(this.pivot.z).div(this.slope)));var o=E(this.minY,this.maxY,s);return"minX"in this&&(o=o.max(E(this.minX,this.maxX,e.abs().add(s.sub(this.pivot.y))))),o}}class G{constructor(t,e,s,i=0){this.pivot=W(e,t),this.minX=U(s[0],t.scale,t.x),this.maxX=U(s[1],t.scale,t.x),this.slope=Math.tan((90-i)*Math.PI/180)}mirror(){var t=H(this);return t.minX*=-1,t.maxX*=-1,t}locus(t=y){var e=t.x,s=t.z,i=k(this.minX),o=k(this.maxX);if(0!=this.angle){var a=s.sub(this.pivot.z).div(this.slope).max(.01).mul(e.sign());i=i.sub(a),o=o.add(a)}return E(i,o,e)}}class q extends G{constructor(t,e,s,i){super(t,e,s),this.minY=U(i[0],t.scale,t.y),this.maxY=U(i[1],t.scale,t.y)}locus(t=y){var e=t.x,s=t.y,i=t.y.sub(this.pivot.y).div(4,e.sign()),o=.8;return k(1).mul(E(k(this.minX).sub(i),k(this.maxX).sub(i),e)).mul(Y(E(this.minY,this.minY*o+(1-o)*this.maxY,s),E(this.maxY,this.maxY*o+(1-o)*this.minY,s))).pow(2)}}class B extends q{constructor(t,e,s,i,o=0){super(t,e,s,i),this.grown=o}locus(t=y){var e=t.x,s=t.z;if(0==this.grown)var i=t.y.sub(e.abs().mul(.2)).add(s.mul(1/6)),o=w(t.x.mul(2),t.y,t.z.min(0)).sub(w(0,this.pivot.y,0)).length().smoothstep(0,.13).pow(10);else i=t.y.sub(e.abs().mul(.2)).add(s.abs().mul(.5)),o=w(t.x.mul(2),t.y,t.z.min(0)).sub(w(0,this.pivot.y,0)).length().smoothstep(0,.065).pow(10);return k(o).mul(e.smoothstep(this.minX,this.maxX),E(this.minY,this.maxY,i).pow(2))}}class D{constructor(t,e){const s={LocusT:B,LocusX:G,LocusXY:q,LocusY:F};var i={};for(var o in e)if("_"!=o){var a=s[e[o][0]];i[o]=new a(t,...e[o].slice(1))}this._=e._,this.head=i.head,this.chest=i.chest,this.waist=i.waist,this.kneeLeft=i?.kneeLeft??i.knee,this.kneeRight=i?.kneeRight??i.knee.mirror(),this.ankleLeft=i?.ankleLeft??i.ankle,this.ankleRight=i?.ankleRight??i.ankle.mirror(),this.ankleLongLeft=i?.ankleLongLeft??i.ankleLong,this.ankleLongRight=i?.ankleLongRight??i.ankleLong.mirror(),this.legLongLeft=i?.legLongLeft??i.legLong,this.legLongRight=i?.legLongRight??i.legLong.mirror(),this.footLeft=i?.footLeft??i.foot,this.footRight=i?.footRight??i.foot.mirror(),this.legLeft=i?.legLeft??i.leg,this.legRight=i?.legRight??i.leg.mirror(),this.elbowLeft=i?.elbowLeft??i.elbow,this.elbowRight=i?.elbowRight??i.elbow.mirror(),this.forearmLeft=i?.forearmLeft??i.forearm,this.forearmRight=i?.forearmRight??i.forearm.mirror(),this.wristLeft=i?.wristLeft??i.wrist,this.wristRight=i?.wristRight??i.wrist.mirror(),this.armLeft=i?.armLeft??i.arm,this.armRight=i?.armRight??i.arm.mirror()}}var J,K,Q,$,tt,et,st,it=[];class ot{constructor(t){if((J=new r({antialias:!0})).setSize(innerWidth,innerHeight),J.shadowMap.enabled=t?.shadows??!0,J.shadowMap.type=n,document.body.appendChild(J.domElement),document.body.style.overflow="hidden",document.body.style.margin="0",(K=new h).background=new l("whitesmoke"),(Q=new u(30,innerWidth/innerHeight)).position.set(0,1,4),Q.lookAt(0,1,0),(t?.lights??1)&&(($=new m("white",1.5)).decay=0,$.position.set(0,14,7),(t?.shadows??1)&&($.shadow.mapSize.width=2048,$.shadow.mapSize.height=$.shadow.mapSize.width,$.shadow.camera.near=1,$.shadow.camera.far=50,$.shadow.camera.left=-5,$.shadow.camera.right=5,$.shadow.camera.top=5,$.shadow.camera.bottom=-5,$.shadow.normalBias=.01,$.autoUpdate=!1,$.castShadow=!0),K.add($),(tt=new m("white",1.5)).decay=0,tt.target=K,Q.add(tt),K.add(Q)),(t?.controls??1)&&((et=new z(Q,J.domElement)).enableDamping=!0,et.target.set(0,.8,0)),t?.ground??1){var s=document.createElement("CANVAS");s.width=128,s.height=128;var i=s.getContext("2d");i.fillStyle="white",i.filter="blur(10px)",i.beginPath(),i.arc(64,64,37.5,0,2*Math.PI),i.fill();var o=new e(new g(50),new c({color:"antiquewhite",transparent:!0,map:new d(s)}));o.receiveShadow=!0,o.rotation.x=-Math.PI/2,o.renderOrder=-1,K.add(o)}window.addEventListener("resize",(()=>{Q.aspect=innerWidth/innerHeight,Q.updateProjectionMatrix(),J.setSize(innerWidth,innerHeight)})),J.setAnimationLoop(nt)}}class at extends Event{#t;constructor(){super("animate")}get target(){return this.#t}set target(t){this.#t=t}}var rt=new at("animate");function nt(t){rt.time=t,window.dispatchEvent(rt),it.forEach((t=>{t.dispatchEvent(rt)})),st&&st(t),et&&et.update(),J.render(K,Q)}function ht(t){st=t}var lt=Object.freeze({__proto__:null,SPACE:{head:["LocusY",[0,878,-37],[838,923],30],chest:["LocusY",[0,661,-8],[438,929],0,[40,300]],waist:["LocusY",[0,570,-9],[310,840]],leg:["LocusT",[41,546,-19],[-2,2],[690,441]],legLong:["LocusY",[39,0,-19],[700,140]],knee:["LocusY",[50,286,-23],[341,218],20],ankle:["LocusY",[41,51,-1],[97,10],-10],ankleLong:["LocusY",[51,206,-29],[430,-10]],foot:["LocusY",[0,20,12],[111,-185],120],elbow:["LocusX",[238,815,-40],[230,260],0],forearm:["LocusX",[170,815,-38],[46,490]],wrist:["LocusX",[375,820,-40],[354,402]],arm:["LocusXY",[85,790,-40],[30,150],[600,900]]},URL:"man.glb"}),ut=Object.freeze({__proto__:null,SPACE:{head:["LocusY",[0,872,-30],[827,919],30],chest:["LocusY",[0,661,-8],[438,929],0,[40,300]],waist:["LocusY",[0,570,-9],[350,840]],leg:["LocusT",[41,546,-19],[-2,2],[690,441]],legLong:["LocusY",[44,0,-19],[700,140]],knee:["LocusY",[50,286,-23],[341,218],20],ankle:["LocusY",[44,51,-4],[97,10],-10],ankleLong:["LocusY",[51,201,-29],[430,-33]],foot:["LocusY",[0,20,12],[111,-185],120],elbow:["LocusX",[238,815,-40],[230,260],0],forearm:["LocusX",[170,815,-38],[54,475]],wrist:["LocusX",[359,815,-34],[343,380]],arm:["LocusXY",[80,793,-40],[30,137],[600,900]]},URL:"woman.glb"}),mt=Object.freeze({__proto__:null,SPACE:{head:["LocusY",[0,850,-32],[807,894],30],chest:["LocusY",[0,640,1],[419,914],0,[40,300]],waist:["LocusY",[0,530,-7],[285,836]],leg:["LocusT",[40,521,-9],[-1,1],[625,430],1],legLong:["LocusY",[46,0,-5],[700,140]],knee:["LocusY",[50,288,-12],[346,221],20],ankle:["LocusY",[54,48,-14],[81,33],-10],ankleLong:["LocusY",[51,201,-25],[430,-33]],foot:["LocusY",[0,20,6],[83,-200],120],elbow:["LocusX",[249,793,-56],[230,273],0],forearm:["LocusX",[170,794,-59],[54,475]],wrist:["LocusX",[398,802,-57],[384,409]],arm:["LocusXY",[80,793,-40],[30,137],[600,900]]},URL:"child.glb"});var gt=new L;function ct(t){return 2*(t=(t=(t%360+360)%360)>180?t-360:t)*Math.PI/360}class dt{constructor(t,e,s,i,o="x",a="y",r="z"){this.isRight=t,this.jointX=e,this.jointY=s??e,this.jointZ=i??e,this.nameX=o,this.nameY=a,this.nameZ=r}get nod(){return this.jointX.value.x}set nod(t){this.jointX.value.x=ct(t)}get bend(){return this.jointX.value[this.nameX]}set bend(t){this.jointX.value[this.nameX]=ct(t)}get raise(){return this.jointX.value[this.nameX]}set raise(t){this.jointX.value[this.nameX]=ct(t)}get turn(){return this.jointY.value[this.nameY]}set turn(t){this.jointY.value[this.nameY]=ct(t)}get tilt(){return this.jointZ.value[this.nameZ]}set tilt(t){this.jointZ.value[this.nameZ]=ct(t)}get straddle(){return this.jointZ.value[this.nameZ]}set straddle(t){this.jointZ.value[this.nameZ]=ct(t)}}class Lt extends t.Group{constructor(t,r){super(),this.uid=10*Math.random(),this.castShadow=!0,this.receiveShadow=!0,this.dims={},this.posture=(t.SPACE,{head:R(w(0,0,0)),chest:R(w(0,0,0)),waist:R(w(0,0,0)),kneeLeft:R(w(0,0,0)),kneeRight:R(w(0,0,0)),ankleLeft:R(w(0,0,0)),ankleRight:R(w(0,0,0)),footLeft:R(w(0,0,0)),footRight:R(w(0,0,0)),legLeft:R(w(0,0,0)),legLongLeft:R(w(0,0,0)),legRight:R(w(0,0,0)),legLongRight:R(w(0,0,0)),ankleLongLeft:R(w(0,0,0)),ankleLongRight:R(w(0,0,0)),elbowLeft:R(w(0,0,0)),elbowRight:R(w(0,0,0)),forearmLeft:R(w(0,0,0)),forearmRight:R(w(0,0,0)),wristLeft:R(w(0,0,0)),wristRight:R(w(0,0,0)),armLeft:R(w(0,0,0)),armRight:R(w(0,0,0))}),this.head=new dt(!1,this.posture.head),this.chest=new dt(!1,this.posture.chest),this.waist=new dt(!1,this.posture.waist),this.legLeft=new dt(!1,this.posture.legLeft,this.posture.legLongLeft),this.kneeLeft=new dt(!1,this.posture.kneeLeft),this.ankleLeft=new dt(!1,this.posture.ankleLeft,this.posture.ankleLongLeft),this.footLeft=new dt(!1,this.posture.footLeft),this.legRight=new dt(!0,this.posture.legRight,this.posture.legLongRight),this.kneeRight=new dt(!0,this.posture.kneeRight),this.ankleRight=new dt(!0,this.posture.ankleRight,this.posture.ankleLongRight),this.footRight=new dt(!0,this.posture.footRight),this.armLeft=new dt(!1,this.posture.armLeft,this.posture.armLeft,this.posture.armLeft,"y","x","z"),this.elbowLeft=new dt(!1,this.posture.elbowLeft,null,null,"y"),this.wristLeft=new dt(!1,this.posture.wristLeft,this.posture.forearmLeft,this.posture.wristLeft,"z","x","y"),this.armRight=new dt(!0,this.posture.armRight,this.posture.armRight,this.posture.armRight,"y","x","z"),this.elbowRight=new dt(!0,this.posture.elbowRight,null,null,"y"),this.wristRight=new dt(!0,this.posture.wristRight,this.posture.forearmRight,this.posture.wristRight,"z","x","y"),gt.load("../assets/models/"+t.URL,(n=>{var h=function(t){var i=[];t.traverse((t=>{if(t.isMesh){var s=t.geometry.clone().applyMatrix4(t.matrixWorld),o=t.material.clone(),a=new e(s,o);a.frustumCulled=!1,i.push(a)}}));var o=new s;return o.add(...i),o}(n.scene);!function(t,e){var s=new i,a=(new o).setFromObject(t,!0);a.getCenter(s),t.position.sub(s),e.x=(a.max.x+a.min.x)/2,e.y=a.min.y,e.z=(a.max.z+a.min.z)/2,e.scale=Math.max(a.max.x-a.min.x,a.max.y-a.min.y,a.max.z-a.min.z),e.height=a.max.y-a.min.y}(h,this.dims),function(t,e,s,i,o){t.traverse((t=>{if(t.isMesh){var r=new a;Object.assign(r,t.material),Object.assign(r,o),i.colorNode&&(r.colorNode=i.colorNode()),i.positionNode&&(r.positionNode=i.positionNode({space:e,posture:s})),i.normalNode&&(r.normalNode=i.normalNode({space:e,posture:s})),i.emissiveNode&&(r.emissiveNode=i.emissiveNode({space:e,posture:s})),t.material=r,t.castShadow=!0,t.receiveShadow=!0}}))}(h,new D(this.dims,t.SPACE),this.posture,{positionNode:A,normalNode:V,colorNode:f((()=>w(254/255,209/255,185/255).pow(2.2)))},{metalness:0,roughness:.6}),h.position.y=-this.dims.y/2,r&&h.scale.setScalar(r/this.dims.height),h.castShadow=!0,h.receiveShadow=!0,this.add(h),it.push(this),K&&K.add(this)}))}}class ft extends Lt{constructor(t){super(lt,t),this.legLeft.straddle=5,this.legRight.straddle=5,this.ankleLeft.tilt=-5,this.ankleRight.tilt=-5,this.ankleLeft.bend=3,this.ankleRight.bend=3,this.position.y=-.005,this.armLeft.straddle=65,this.armRight.straddle=65,this.elbowLeft.bend=20,this.elbowRight.bend=20}}class pt extends Lt{constructor(t){super(ut,t),this.legLeft.straddle=-2.9,this.legRight.straddle=-2.9,this.ankleLeft.tilt=2.9,this.ankleRight.tilt=2.9,this.ankleLeft.bend=3,this.ankleRight.bend=3,this.position.y=-.005,this.armLeft.straddle=65,this.armRight.straddle=65,this.elbowLeft.bend=20,this.elbowRight.bend=20}}class wt extends Lt{constructor(t){super(mt,t),this.ankleLeft.bend=3,this.ankleRight.bend=3,this.position.y=-.005,this.armLeft.straddle=65,this.armRight.straddle=65,this.elbowLeft.bend=20,this.elbowRight.bend=20}}export{wt as Child,ft as Man,pt as Woman,ot as World,Q as camera,tt as cameraLight,C as chaotic,et as controls,it as everybody,$ as light,O as regular,J as renderer,K as scene,ht as setAnimationLoop};
