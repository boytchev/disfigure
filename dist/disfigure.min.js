/*! disfigure v0.0.18 */
import{WebGPURenderer as t,PCFSoftShadowMap as e,Scene as s,Color as i,PerspectiveCamera as r,DirectionalLight as h,Mesh as a,CircleGeometry as o,MeshLambertMaterial as n,CanvasTexture as l,Vector3 as c,Matrix3 as d,Matrix4 as w,Euler as m,PlaneGeometry as p,Group as _,MeshPhysicalNodeMaterial as u}from"three";import{GLTFLoader as g}from"three/addons/loaders/GLTFLoader.js";import{Fn as f,mix as v,If as x,normalGeometry as b,transformNormalToView as y,positionGeometry as k,min as z,vec3 as E,float as S,select as H,vec2 as P,uniform as X,mat3 as M}from"three/tsl";import{SimplexNoise as Y}from"three/addons/math/SimplexNoise.js";import{OrbitControls as I}from"three/addons/controls/OrbitControls.js";import R from"three/addons/libs/stats.module.js";var C=new Y;function A(t,e=0,s=-1,i=1){return s+(i-s)*(C.noise(t,e)+1)/2}function L(t,e=0,s=-1,i=1){return s+(i-s)*(Math.sin(t+e)+1)/2}function j(t=-1,e=1){return t+(e-t)*Math.random()}var T=f((([t,e])=>{var s=t.sub(e.pivot).mul(e.matrix).add(e.pivot);return v(t,s,e.locus())})),U=f((([t,e])=>{var s=t.mul(e.matrix);return v(t,s,e.locus())}));function G(t){return t.vertex=b,t.fn=U,y(J(t))}var N,Z,F,W,O,q,B,D,V,J=f((({fn:t,space:e,vertex:s})=>{var i=s.toVar();function r(s){for(var r of s)i.assign(t(i,e[r]))}return x(e.l_arm.locus(),(()=>{r(["l_wrist","l_forearm","l_elbow","l_arm"])})),x(e.r_arm.locus(),(()=>{r(["r_wrist","r_forearm","r_elbow","r_arm"])})),x(e.l_leg.locus(),(()=>{r(["l_foot","l_ankle","l_shin","l_knee","l_thigh","l_leg"])})),x(e.r_leg.locus(),(()=>{r(["r_foot","r_ankle","r_shin","r_knee","r_thigh","r_leg"])})),r(["head","chest","waist","torso"]),i})),K=[];class Q{constructor(c){if((N=new t({antialias:!0})).setSize(innerWidth,innerHeight),N.shadowMap.enabled=c?.shadows??!0,N.shadowMap.type=e,document.body.appendChild(N.domElement),document.body.style.overflow="hidden",document.body.style.margin="0",(Z=new s).background=new i("whitesmoke"),(F=new r(30,innerWidth/innerHeight)).position.set(0,1.5,4),c?.stats&&(V=new R,document.body.appendChild(V.dom)),(c?.lights??1)&&((W=new h("white",1.5)).position.set(0,14,7),(c?.shadows??1)&&(W.shadow.mapSize.width=2048,W.shadow.mapSize.height=W.shadow.mapSize.width,W.shadow.camera.near=1,W.shadow.camera.far=50,W.shadow.camera.left=-5,W.shadow.camera.right=5,W.shadow.camera.top=5,W.shadow.camera.bottom=-5,W.shadow.normalBias=.01,W.autoUpdate=!1,W.castShadow=!0),Z.add(W),(O=new h("white",1.5)).target=Z,F.add(O),Z.add(F)),(c?.controls??1)&&((q=new I(F,N.domElement)).enableDamping=!0,q.target.set(0,.9,0)),c?.ground??1){var d=document.createElement("CANVAS");d.width=128,d.height=128;var w=d.getContext("2d");w.fillStyle="white",w.filter="blur(10px)",w.beginPath(),w.arc(64,64,38,0,2*Math.PI),w.fill(),(B=new a(new o(50),new n({color:"antiquewhite",transparent:!0,map:new l(d)}))).receiveShadow=!0,B.rotation.x=-Math.PI/2,B.renderOrder=-1,Z.add(B)}window.addEventListener("resize",(()=>{F.aspect=innerWidth/innerHeight,F.updateProjectionMatrix(),N.setSize(innerWidth,innerHeight)})),N.setAnimationLoop(et)}}class $ extends Event{#t;constructor(){super("animate")}get target(){return this.#t}set target(t){this.#t=t}}var tt=new $;function et(t){tt.time=t,window.dispatchEvent(tt),K.forEach((t=>{t.update(),t.dispatchEvent(tt)})),D&&D(t),q&&q.update(),V&&V.update(),N.render(Z,F)}function st(t){D=t}var it=0,rt=document.getElementById("spinner");rt&&setTimeout((()=>rt.style.display="none"),3e3);const ht=f((([t,e])=>e.smoothstep(t.x,t.y).smoothstep(0,1).smoothstep(0,1)),{edge:"vec2",value:"float",return:"float"});var at=f((([t,e,s,i])=>{var r=t.y,h=t.z;return r=r.add(h.sub(e.z).div(i)),ht(s,r)}),{pos:"vec3",pivot:"vec3",rangeY:"vec2",slope:"float",return:"float"}),ot=f((([t,e])=>ht(e,t.x)),{pos:"vec3",rangeX:"vec2",return:"float"}),nt=f((([t,e,s,i])=>{var r=t.x,h=t.y,a=h.sub(e.y).div(4,r.sign());return ht(s,r.add(a)).mul(z(h.smoothstep(i.x,v(i.x,i.y,.2)),h.smoothstep(i.y,v(i.y,i.x,.2)))).pow(2)}),{pos:"vec3",pivot:"vec3",rangeX:"vec2",rangeY:"vec2",return:"float"}),lt=f((([t,e,s,i,r])=>{var h=t.x,a=t.y,o=t.z,n=E(h.mul(2),a,o.min(0)).sub(E(0,e.y,0)).length().smoothstep(0,S(.13).div(S(r).add(1))).pow(10),l=a.sub(h.abs().mul(.2));return l=l.add(H(r.equal(1),o.abs().mul(.5),o.mul(1/6))),n.mul(h.smoothstep(s.x,s.y),ht(i,l).pow(2))}),{pos:"vec3",pivot:"vec3",rangeX:"vec2",rangeY:"vec2",grown:"float",return:"float"});class ct{constructor(t){this.pivot=new c(...t),this.angle=new c,this.matrix=X(M()),this.isRight=!1}mirror(){return this.isRight=!0,this.pivot.x*=-1,this.rangeX&&(this.rangeX.value.x*=-1,this.rangeX.value.y*=-1),this}}class dt extends ct{constructor(t,e,s=0){super(t),this.rangeY=P(...e),this.slope=Math.tan((90-s)*Math.PI/180)}locus(){return at(k,this.pivot,this.rangeY,this.slope)}}class wt extends ct{constructor(t,e){super(t),this.rangeX=P(...e)}locus(){return ot(k,this.rangeX)}}class mt extends wt{constructor(t,e,s){super(t,e),this.rangeY=P(...s)}locus(){return it++,rt&&it>=12*K.length&&(rt.style.display="none"),nt(k,this.pivot,this.rangeX,this.rangeY)}}class pt extends mt{constructor(t,e,s,i=0){super(t,e,s),this.grown=i}locus(){return lt(k,this.pivot,this.rangeX,this.rangeY,this.grown)}}class _t{constructor(t){this.head=new dt(...t.head),this.chest=new dt(...t.chest),this.waist=new dt(...t.waist),this.torso=new dt(...t.torso),this.l_knee=new dt(...t.knee),this.r_knee=new dt(...t.knee).mirror(),this.l_ankle=new dt(...t.ankle),this.r_ankle=new dt(...t.ankle).mirror(),this.l_shin=new dt(...t.shin),this.r_shin=new dt(...t.shin).mirror(),this.l_thigh=new dt(...t.thigh),this.r_thigh=new dt(...t.thigh).mirror(),this.l_foot=new dt(...t.foot),this.r_foot=new dt(...t.foot).mirror(),this.l_leg=new pt(...t.leg),this.r_leg=new pt(...t.leg).mirror(),this.l_elbow=new wt(...t.elbow),this.r_elbow=new wt(...t.elbow).mirror(),this.l_forearm=new wt(...t.forearm),this.r_forearm=new wt(...t.forearm).mirror(),this.l_wrist=new wt(...t.wrist),this.r_wrist=new wt(...t.wrist).mirror(),this.l_arm=new mt(...t.arm),this.r_arm=new mt(...t.arm).mirror()}}var ut=new g;const gt=import.meta.url.replace("/src/body.js","/assets/models/");var ft=new d,vt=new d,xt=new c;function bt(t,e,s){Object.defineProperty(t,e,{get:()=>t.angle[s]/(2*Math.PI/360),set(e){t.angle[s]=e*(2*Math.PI/360)}})}class yt extends _{constructor(t,e,s,i="xyz"){super(),this.model=t,this.parent=e,this.pivot=s.pivot,this.angle=s.angle,this.matrix=s.matrix,this.isRight=s.isRight,this.position.copy(s.pivot),bt(this,"bend",i[0]),bt(this,"raise",i[0]),bt(this,"tilt",i[2]),bt(this,"straddle",i[2]),bt(this,"foreward",i[0]),bt(this,"turn",i[1])}attach(t){t.parent&&(t=t.clone());var e=new _,s=new _;e.add(s),s.add(t),e.matrixAutoUpdate=!1,e.joint=this,this.model.children[0].add(e),this.model.accessories.push(e)}}var kt=new w,zt=new m,Et=new p,St=1;class Ht extends _{constructor(t,e,s,i){var r;super(),this.url=t,this.uid=St,St+=.3+2*Math.random(),this.castShadow=!0,this.receiveShadow=!0,this.accessories=[],this.height=s??i,this.model=new a(Et),this.model.scale.setScalar(this.height/i),ut.load(this.url,(t=>{this.model.geometry=t.scene.children[0].geometry})),this.space=new _t(e),this.torso=new yt(this,null,this.space.torso),this.waist=new yt(this,this.torso,this.space.waist),this.chest=new yt(this,this.waist,this.space.chest),this.head=new yt(this,this.chest,this.space.head),this.l_leg=new yt(this,this.torso,this.space.l_leg),this.l_thigh=new yt(this,this.l_leg,this.space.l_thigh),this.l_knee=new yt(this,this.l_thigh,this.space.l_knee),this.l_shin=new yt(this,this.l_knee,this.space.l_shin),this.l_ankle=new yt(this,this.l_shin,this.space.l_ankle),this.l_foot=new yt(this,this.l_ankle,this.space.l_foot),this.r_leg=new yt(this,this.torso,this.space.r_leg),this.r_thigh=new yt(this,this.r_leg,this.space.r_thigh),this.r_knee=new yt(this,this.r_thigh,this.space.r_knee),this.r_shin=new yt(this,this.r_knee,this.space.r_shin),this.r_ankle=new yt(this,this.r_shin,this.space.r_ankle),this.r_foot=new yt(this,this.r_ankle,this.space.r_foot),this.l_arm=new yt(this,this.chest,this.space.l_arm,"yxz"),this.l_elbow=new yt(this,this.l_arm,this.space.l_elbow,"yxz"),this.l_forearm=new yt(this,this.l_elbow,this.space.l_forearm,"zxy"),this.l_wrist=new yt(this,this.l_forearm,this.space.l_wrist,"zxy"),this.r_arm=new yt(this,this.chest,this.space.r_arm,"yxz"),this.r_elbow=new yt(this,this.r_arm,this.space.r_elbow,"yxz"),this.r_forearm=new yt(this,this.r_elbow,this.space.r_forearm,"zxy"),this.r_wrist=new yt(this,this.r_forearm,this.space.r_wrist,"zxy"),this.model.material=new u({positionNode:(r={space:this.space},r.vertex=k,r.fn=T,J(r)),normalNode:G({space:this.space}),colorNode:E(.99,.65,.49),metalness:0,roughness:.6}),this.model.position.y=0,this.model.castShadow=!0,this.model.receiveShadow=!0,this.add(this.model),K.push(this),Z&&Z.add(this),this.l_arm.straddle=this.r_arm.straddle=65,this.l_elbow.bend=this.r_elbow.bend=20}update(){function t(t,e,s,i){zt.set(e*t.angle.x,s*t.angle.y,i*t.angle.z,"YZX"),kt.makeRotationFromEuler(zt);var r=kt.elements;t.matrix.value.set(r[0],r[4],r[8],r[1],r[5],r[9],r[2],r[6],r[10])}function e(t,e,s,i){zt.set(0,0,0,"YZX"),zt.reorder("ZXY"),zt.set(zt.x,zt.y,zt.z+i*t.angle.z),zt.reorder("YZX"),zt.set(zt.x,zt.y+s*t.angle.y,zt.z),zt.reorder("XYZ"),zt.set(zt.x+e*t.angle.x,zt.y,zt.z),kt.makeRotationFromEuler(zt);var r=kt.elements;t.matrix.value.set(r[0],r[4],r[8],r[1],r[5],r[9],r[2],r[6],r[10])}for(var s of(t(this.head,-1,-1,1),t(this.chest,-1,-1,1),t(this.waist,-1,-1,1),t(this.torso,-1,-1,1),t(this.l_elbow,0,1,0),t(this.r_elbow,0,-1,0),t(this.l_wrist,0,1,1),t(this.r_wrist,0,-1,-1),t(this.space.l_forearm,-1,0,0),t(this.space.r_forearm,-1,0,0),e(this.l_arm,-1,1,1),e(this.r_arm,-1,-1,-1),t(this.l_knee,-1,0,0),t(this.r_knee,-1,0,0),t(this.l_ankle,-1,0,-1),t(this.r_ankle,-1,0,1),t(this.space.l_shin,0,-1,0),t(this.space.r_shin,0,1,0),t(this.l_foot,-1,0,0),t(this.r_foot,-1,0,0),t(this.space.l_thigh,0,-1,0),t(this.space.r_thigh,0,1,0),e(this.l_leg,1,0,-1),e(this.r_leg,1,0,1),this.accessories)){var i=s.joint;for(vt.identity(),xt.copy(i.pivot);i;i=i.parent)ft.copy(i.matrix.value).transpose(),vt.premultiply(ft),xt.sub(i.pivot).applyMatrix3(ft).add(i.pivot);s.matrix.setFromMatrix3(vt),s.matrix.setPosition(xt)}}}class Pt extends Ht{static URL="man.glb";static HEIGHT=1.795;static SPACE={head:[[0,1.566,-.066],[1.495,1.647],30],chest:[[0,1.177,-.014],[.777,1.658],0,[.072,.538]],waist:[[0,1.014,-.016],[.547,1.498]],torso:[[0,1.014,-.016],[-3,-2]],leg:[[.074,.97,-.034],[-.004,.004],[1.229,.782]],thigh:[[.07,-.009,-.034],[1.247,.242]],knee:[[.09,.504,-.041],[.603,.382],20],ankle:[[.074,.082,-.002],[.165,.008],-10],shin:[[.092,.36,-.052],[.762,-.027]],foot:[[0,.026,.022],[.19,-.342],120],elbow:[[.427,1.453,-.072],[.413,.467]],forearm:[[.305,1.453,-.068],[.083,.879]],wrist:[[.673,1.462,-.072],[.635,.722]],arm:[[.153,1.408,-.072],[.054,.269],[1.067,1.616]]};constructor(t){super(gt+Pt.URL,Pt.SPACE,t,Pt.HEIGHT),this.l_leg.straddle=this.r_leg.straddle=5,this.l_ankle.tilt=this.r_ankle.tilt=-5,this.l_ankle.bend=this.r_ankle.bend=3}}class Xt extends Ht{static URL="woman.glb";static HEIGHT=1.691;static SPACE={head:[[.001,1.471,-.049],[1.395,1.551],30],chest:[[.001,1.114,-.012],[.737,1.568],0,[.069,.509]],waist:[[.001,.961,-.014],[.589,1.417]],torso:[[.001,.961,-.014],[-1.696,-1.694]],leg:[[.071,.92,-.031],[-.002,.005],[1.163,.742]],thigh:[[.076,-.003,-.031],[1.18,.233]],knee:[[.086,.48,-.037],[.573,.365],20],shin:[[.088,.337,-.047],[.724,-.059]],ankle:[[.076,.083,-.005],[.161,.014],-10],foot:[[.001,.031,.022],[.184,-.316],120],elbow:[[.404,1.375,-.066],[.39,.441]],forearm:[[.289,1.375,-.063],[.093,.805]],wrist:[[.608,1.375,-.056],[.581,.644]],arm:[[.137,1.338,-.066],[.052,.233],[1.011,1.519]]};constructor(t){super(gt+Xt.URL,Xt.SPACE,t,Xt.HEIGHT),this.l_leg.straddle=this.r_leg.straddle=-2.9,this.l_ankle.tilt=this.r_ankle.tilt=2.9,this.l_ankle.bend=this.r_ankle.bend=3}}class Mt extends Ht{static URL="child.glb";static HEIGHT=1.352;static SPACE={head:[[0,1.149,-.058],[1.091,1.209],30],chest:[[0,.865,-.013],[.566,1.236],0,[.054,.406]],waist:[[0,.717,-.024],[.385,1.13]],torso:[[0,.717,-.024],[-1.354,-1.353]],leg:[[.054,.704,-.027],[-.001,.001],[.845,.581],1],thigh:[[.062,-0,-.021],[.946,.189]],knee:[[.068,.389,-.031],[.468,.299],20],shin:[[.069,.272,-.048],[.581,-.045]],ankle:[[.073,.065,-.033],[.109,.044],-10],foot:[[0,.027,-.006],[.112,-.271],120],elbow:[[.337,1.072,-.09],[.311,.369]],forearm:[[.23,1.074,-.094],[.073,.642]],wrist:[[.538,1.084,-.091],[.519,.553]],arm:[[.108,1.072,-.068],[.041,.185],[.811,1.217]]};constructor(t){super(gt+Mt.URL,Mt.SPACE,t,Mt.HEIGHT),this.l_ankle.bend=this.r_ankle.bend=3}}console.log("\n%c⋮⋮⋮ Disfigure\n%chttps://boytchev.github.io/disfigure/\n","color: navy","font-size:80%");export{Mt as Child,Pt as Man,Xt as Woman,Q as World,F as camera,O as cameraLight,A as chaotic,q as controls,K as everybody,B as ground,W as light,j as random,L as regular,N as renderer,Z as scene,st as setAnimationLoop};
