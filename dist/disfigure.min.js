/*! disfigure v0.0.20 */
import{Color as t,WebGPURenderer as e,PCFSoftShadowMap as s,Scene as i,PerspectiveCamera as r,DirectionalLight as a,Mesh as o,CircleGeometry as n,MeshLambertMaterial as h,CanvasTexture as l,Vector3 as d,Matrix3 as c,Matrix4 as u,Vector4 as p,Euler as m,PlaneGeometry as w,MeshPhysicalNodeMaterial as g,MathUtils as _,Group as v}from"three";import{GLTFLoader as f}from"three/addons/loaders/GLTFLoader.js";import{Fn as y,mat3 as x,vec3 as b,mix as z,positionGeometry as k,vec2 as M,float as S,rotate as E,If as P,transformNormalToView as I,normalGeometry as A,min as X,select as j,uniform as Y}from"three/tsl";import{SimplexNoise as H}from"three/addons/math/SimplexNoise.js";import{OrbitControls as L}from"three/addons/controls/OrbitControls.js";import T from"three/addons/libs/stats.module.js";var C=y((({color:t,roughness:e,metalness:s})=>x(t,b(e,s,0),b(0,0,0))),{color:"vec3",roughness:"float",metalness:"float",return:"mat3"}),N=y((({value:t,fromValue:e,toValue:s})=>t.greaterThanEqual(e).and(t.lessThanEqual(s))),{value:"float",fromValue:"float",toValue:"float",return:"float"}),V=y((([t,e,s])=>x(z(t[0],e[0],s),z(t[1],e[1],s),b(0,0,0))),{matA:"mat3",matB:"mat3",k:"float",return:"mat3"}),R=new t;function U(t){return R.set(t),b(...R)}function G(t){return C(U(t),.2,.3)}function W(t){return C(U(t).mul(3),1,1)}var Z=y((({matA:t,matB:e,width:s=S(.1),options:i={}})=>{var r,a,{balance:o,blur:n,angle:h,polar:l,x:d,z:c}=i;return r=l?(a=k.xz.sub(M(d??0,c??0))).y.atan(a.x).div(S(s).mul(2)).cos():(a=E(k.xy,(h??0)*Math.PI/180)).y.div(s,1/Math.PI).cos(),o&&(r=r.add(o)),(n=n??1e-5)&&(r=r.smoothstep(-n,n)),V(t,e,r)})),q=y((({from:t,to:e,options:s={}})=>{var i=k.toVar(),r="yxzyx",a=0;s.side&&(a=1),s.front&&(a=2),s.angle&&i[r[a]].addAssign(i[r[a+1]].mul(Math.tan(s.angle*Math.PI/180))),s.sideAngle&&i[r[a]].addAssign(i[r[a+2]].mul(Math.tan(s.sideAngle*Math.PI/180)));var o=i[r[a]];if(s.wave){var n=i[r[a+1]].mul(S(Math.PI).div(s.width??Math.PI)).cos().toVar(),h=S(s.sharpness??0).mix(n,n.acos().mul(-2/Math.PI).sub(1)).mul(s.wave,.5);o=o.add(h)}return s.symmetry&&(o=o.abs()),N(o,t,e)})),B=y((([t])=>{var e=x(t[0]);for(let s=1;s<t.length;s+=2)P(t[s],(()=>{e.assign(t[s+1])}));return e})),O=new H;function F(t,e=0,s=-1,i=1){return s+(i-s)*(O.noise(t,e)+1)/2}function D(t,e=0,s=-1,i=1){return s+(i-s)*(Math.sin(t+e)+1)/2}function J(t=-1,e=1){return t+(e-t)*Math.random()}var K=y((([t,e,s,i])=>{var r=t.sub(e).mul(s).add(e);return z(t,r,i)})),Q=y((([t,e,s,i])=>{var r=t.mul(s);return z(t,r,i)}));function $(t){return I(lt(t,Q,A))}var tt,et,st,it,rt,at,ot,nt,ht,lt=y((([t,e,s])=>{s=s.toVar();var i=t.space;function r(r){for(var a of r)s.assign(e(s,i[a].pivot,t[a].matrix,i[a].locus()))}return P(i.l_arm.locus(),(()=>{r(["l_wrist","l_forearm","l_elbow","l_arm"])})),P(i.r_arm.locus(),(()=>{r(["r_wrist","r_forearm","r_elbow","r_arm"])})),P(i.l_leg.locus(),(()=>{r(["l_foot","l_ankle","l_shin","l_knee","l_thigh","l_leg"])})),P(i.r_leg.locus(),(()=>{r(["r_foot","r_ankle","r_shin","r_knee","r_thigh","r_leg"])})),r(["head","chest","waist","torso"]),s})),dt=[];class ct{constructor(d){if((tt=new e({antialias:d?.antialias??!0})).setSize(innerWidth,innerHeight),tt.shadowMap.enabled=d?.shadows??!0,tt.shadowMap.type=s,document.body.appendChild(tt.domElement),document.body.style.overflow="hidden",document.body.style.margin="0",(et=new i).background=new t("whitesmoke"),(st=new r(30,innerWidth/innerHeight)).position.set(0,1.5,4),d?.stats&&(ht=new T,document.body.appendChild(ht.dom)),(d?.lights??1)&&((it=new a("white",1.5)).position.set(0,14,7),(d?.shadows??1)&&(it.shadow.mapSize.width=2048,it.shadow.mapSize.height=it.shadow.mapSize.width,it.shadow.camera.near=1,it.shadow.camera.far=50,it.shadow.camera.left=-5,it.shadow.camera.right=5,it.shadow.camera.top=5,it.shadow.camera.bottom=-5,it.shadow.normalBias=.01,it.autoUpdate=!1,it.castShadow=!0),et.add(it),(rt=new a("white",1.5)).target=et,st.add(rt),et.add(st)),(d?.controls??1)&&((at=new L(st,tt.domElement)).enableDamping=!0,at.target.set(0,.9,0)),d?.ground??1){var c=document.createElement("CANVAS");c.width=128,c.height=128;var u=c.getContext("2d");u.fillStyle="white",u.filter="blur(10px)",u.beginPath(),u.arc(64,64,38,0,2*Math.PI),u.fill(),(ot=new o(new n(32),new h({color:"antiquewhite",transparent:!0,map:new l(c)}))).receiveShadow=!0,ot.rotation.x=-Math.PI/2,ot.renderOrder=-1,et.add(ot)}window.addEventListener("resize",(()=>{st.aspect=innerWidth/innerHeight,st.updateProjectionMatrix(),tt.setSize(innerWidth,innerHeight)})),tt.setAnimationLoop(mt)}}class ut extends Event{#t;constructor(){super("animate")}get target(){return this.#t}set target(t){this.#t=t}}var pt=new ut;function mt(t){try{pt.time=t,window.dispatchEvent(pt),dt.forEach((t=>{t.update(),t.dispatchEvent(pt)})),nt&&nt(t),at&&at.update(),ht&&ht.update(),tt.render(et,st)}catch(t){throw tt.setAnimationLoop(null),t}}function wt(t){nt=t}console.time("TSL");var gt=0,_t=document.getElementById("spinner");_t&&setTimeout((()=>_t.style.display="none"),1e4);const vt=y((([t,e])=>e.smoothstep(t.x,t.y).smoothstep(0,1).smoothstep(0,1)),{edge:"vec2",value:"float",return:"float"});var ft=y((([t,e,s,i])=>{var r=t.y,a=t.z;return r=r.add(a.sub(e.z).div(i)),vt(s,r)}),{pos:"vec3",pivot:"vec3",rangeY:"vec2",slope:"float",return:"float"}),yt=y((([t,e])=>vt(e,t.x)),{pos:"vec3",rangeX:"vec2",return:"float"}),xt=y((([t,e,s,i])=>{var r=t.x,a=t.y,o=a.sub(e.y).div(4,r.sign());return vt(s,r.add(o)).mul(X(a.smoothstep(i.x,z(i.x,i.y,.2)),a.smoothstep(i.y,z(i.y,i.x,.2)))).pow(2)}),{pos:"vec3",pivot:"vec3",rangeX:"vec2",rangeY:"vec2",return:"float"}),bt=y((([t,e,s,i,r])=>{var a=t.x,o=t.y,n=t.z,h=b(a.mul(2),o,n.min(0)).sub(b(0,e.y,0)).length().smoothstep(0,S(.13).div(S(r).add(1))).pow(10),l=o.sub(a.abs().mul(.2));return l=l.add(j(r.equal(1),n.abs().mul(.5),n.mul(1/6))),h.mul(a.smoothstep(s.x,s.y),vt(i,l).pow(2))}),{pos:"vec3",pivot:"vec3",rangeX:"vec2",rangeY:"vec2",grown:"float",return:"float"});class zt{constructor(t){this.pivot=new d(...t),this.isRight=!1}mirror(){return this.isRight=!0,this.pivot.x*=-1,this.rangeX&&(this.rangeX.value.x*=-1,this.rangeX.value.y*=-1),this}}class kt extends zt{constructor(t,e,s=0){super(t),this.rangeY=M(...e),this.slope=Math.tan((90-s)*Math.PI/180)}locus(){return ft(k,this.pivot,this.rangeY,this.slope)}}class Mt extends zt{constructor(t,e){super(t),this.rangeX=M(...e)}locus(){return yt(k,this.rangeX)}}class St extends Mt{constructor(t,e,s){super(t,e),this.rangeY=M(...s)}locus(){return gt++,_t&&gt>=12*dt.length&&(console.timeLog("TSL",gt),_t.style.display="none"),xt(k,this.pivot,this.rangeX,this.rangeY)}}class Et extends St{constructor(t,e,s,i=0){super(t,e,s),this.grown=i}locus(){return bt(k,this.pivot,this.rangeX,this.rangeY,this.grown)}}class Pt{constructor(t){var e={head:kt,chest:kt,waist:kt,torso:kt},s={knee:kt,ankle:kt,shin:kt,thigh:kt,foot:kt,leg:Et,elbow:Mt,forearm:Mt,wrist:Mt,arm:St};for(var i in e)this[i]=new e[i](...t[i]);for(var i in s)this["l_"+i]=new s[i](...t[i]),this["r_"+i]=new s[i](...t[i]).mirror()}}var It=new f;const At=import.meta.url.replace("/src/body.js","/assets/models/");var Xt=new c,jt=new c,Yt=new u,Ht=new d,Lt=new p,Tt=t=>180*t/Math.PI,Ct=t=>t/180*Math.PI,Nt=t=>Math.round(100*t)/100;function Vt(t,e,s){for(jt.identity();t;t=t.parent)Xt.copy(t.matrix.value).transpose(),jt.premultiply(Xt),e.sub(t.space.pivot).applyMatrix3(Xt).add(t.space.pivot);s.setFromMatrix3(jt),s.setPosition(e)}function Rt(t,e,s,i){Object.defineProperty(t,e,{get:()=>Tt(i*t.angle[s]),set(e){t.angle[s]=Ct(i*e)}})}class Ut{constructor(t,e,s,i,r,a,o,n,h,l="YZX"){this.model=t,this.model.joints.push(this),this.parent=e,this.space=s,this.angle=new d,this.matrix=Y(new c),this.order=l,Rt(this,"bend",i,o),Rt(this,"turn",r,n),Rt(this,"tilt",a,h),Rt(this,"foreward",i,o),Rt(this,"straddle",a,h)}attach(t,e,s,i){t.parent&&(t=t.clone()),void 0!==e&&t.position.set(e,s,i);var r=new v;r.add(t),r.matrixAutoUpdate=!1,r.joint=this,this.model.add(r),this.model.accessories.push(r)}point(t,e,s){return Ht.set(t,e,s),Ht.add(this.space.pivot),Vt(this,Ht,Yt),Lt.set(0,0,0,1),Lt.applyMatrix4(Yt),Ht.set(Lt.x,Lt.y,Lt.z),Ht}lockTo(t,e,s,i,r,a){this.model.position.set(0,0,0),Ht=this.point(t,e,s),this.model.position.sub(Ht),Ht.set(i,r,a),this.model.position.add(Ht)}}var Gt=new u,Wt=new m,Zt=new w,qt=1;class Bt extends o{constructor(t,e){var s,i=At+t.URL,r=t.SPACE,a=t.HEIGHT;super(Zt),this.url=i,this.uid=qt,qt+=1+10*Math.random(),this.castShadow=!0,this.receiveShadow=!0,this.accessories=[],this.joints=[],this.height=e??a,this.scale.setScalar(this.height/a),It.load(this.url,(t=>{this.geometry=t.scene.children[0].geometry})),this.space=new Pt(r),this.torso=new Ut(this,null,this.space.torso,"x","y","z",-1,-1,1),this.waist=new Ut(this,this.torso,this.space.waist,"x","y","z",-1,-1,1),this.chest=new Ut(this,this.waist,this.space.chest,"x","y","z",-1,-1,1),this.head=new Ut(this,this.chest,this.space.head,"x","y","z",-1,-1,1),this.l_leg=new Ut(this,this.torso,this.space.l_leg,"x","y","z",1,-1,-1,"XYZ"),this.l_thigh=new Ut(this,this.l_leg,this.space.l_thigh,"x","y","z",0,-1,0),this.l_knee=new Ut(this,this.l_thigh,this.space.l_knee,"x","y","z",-1,0,1),this.l_shin=new Ut(this,this.l_knee,this.space.l_shin,"x","y","z",0,-1,0),this.l_ankle=new Ut(this,this.l_shin,this.space.l_ankle,"x","y","z",-1,0,-1),this.l_foot=new Ut(this,this.l_ankle,this.space.l_foot,"x","y","z",-1,0,0),this.r_leg=new Ut(this,this.torso,this.space.r_leg,"x","y","z",1,1,1,"XYZ"),this.r_thigh=new Ut(this,this.r_leg,this.space.r_thigh,"x","y","z",0,1,0),this.r_knee=new Ut(this,this.r_thigh,this.space.r_knee,"x","y","z",-1,0,-1),this.r_shin=new Ut(this,this.r_knee,this.space.r_shin,"x","y","z",0,1,0),this.r_ankle=new Ut(this,this.r_shin,this.space.r_ankle,"x","y","z",-1,0,1),this.r_foot=new Ut(this,this.r_ankle,this.space.r_foot,"x","y","z",-1,0,0),this.l_arm=new Ut(this,this.chest,this.space.l_arm,"y","x","z",1,-1,1,"XYZ"),this.l_elbow=new Ut(this,this.l_arm,this.space.l_elbow,"y","x","z",1,0,0),this.l_forearm=new Ut(this,this.l_elbow,this.space.l_forearm,"z","x","y",0,-1,0),this.l_wrist=new Ut(this,this.l_forearm,this.space.l_wrist,"z","x","y",1,0,1),this.r_arm=new Ut(this,this.chest,this.space.r_arm,"y","x","z",-1,-1,-1,"XYZ"),this.r_elbow=new Ut(this,this.r_arm,this.space.r_elbow,"y","x","z",-1,0,0),this.r_forearm=new Ut(this,this.r_elbow,this.space.r_forearm,"z","x","y",0,-1,0),this.r_wrist=new Ut(this,this.r_forearm,this.space.r_wrist,"z","x","y",-1,0,-1),this.material=new g({positionNode:(s=this,lt(s,K,k)),normalNode:$(this),colorNode:b(.99,.65,.49),metalness:0,roughness:.6}),this.position.y=0,this.castShadow=!0,this.receiveShadow=!0,dt.push(this),et&&et.add(this),this.l_arm.straddle=this.r_arm.straddle=65,this.l_elbow.bend=this.r_elbow.bend=20}update(){for(var t of this.joints){Wt.set(t.angle.x,t.angle.y,t.angle.z,t.order),Gt.makeRotationFromEuler(Wt);var e=Gt.elements;t.matrix.value.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10])}for(var s of this.accessories){var i=s.joint;Ht.copy(i.space.pivot),Vt(i,Ht,s.matrix)}}get posture(){var t=[];for(var e of this.joints)t.push(...e.angle);var s=[...this.position],i=[...this.rotation];return{version:8,position:s.map((t=>Nt(t))),rotation:i,angles:t.map((t=>Nt(Tt(t))))}}get postureString(){return JSON.stringify(this.posture)}set posture(t){8!=t.version&&console.error("Incompatible posture version");var e=0,s=t.angles.map((t=>Ct(t)));for(var i of(this.position.set(...t.position),this.rotation.set(...t.rotation),this.joints))i.angle.set(s[e++],s[e++],s[e++]);this.update(),this.updateMatrixWorld(!0)}blend(t,e,s){function i(t,e){for(var i=[],r=0;r<t.length;r++)i[r]=_.lerp(t[r],e[r],s);return i}var r=new m(...t.rotation),a=new m(...e.rotation);r.reorder(a._order);var o={version:t.version,position:i(t.position,e.position),rotation:new m(...i([r._x,r._y,r._z],[a._x,a._y,a._z])),angles:i(t.angles,e.angles)};this.posture=o}dress(t){var e=B(t).toVar();this.material.colorNode=e[0].xyz,this.material.roughnessNode=e[1].x,this.material.metalnessNode=e[1].y}}class Ot extends Bt{static URL="man.glb";static HEIGHT=1.795;static SPACE={head:[[0,1.566,-.066],[1.495,1.647],30],chest:[[0,1.177,-.014],[.777,1.658],0,[.072,.538]],waist:[[0,1.014,-.016],[.547,1.498]],torso:[[0,1.014,-.016],[-3,-2]],leg:[[.074,.97,-.034],[-.004,.004],[1.229,.782]],thigh:[[.07,.737,-.034],[1.247,.242]],knee:[[.09,.504,-.041],[.603,.382],20],ankle:[[.074,.082,-.002],[.165,.008],-10],shin:[[.092,.36,-.052],[.762,-.027]],foot:[[.074,.026,.022],[.19,-.342],120],elbow:[[.427,1.453,-.072],[.413,.467]],forearm:[[.55,1.453,-.068],[.083,.879]],wrist:[[.673,1.462,-.072],[.635,.722]],arm:[[.153,1.408,-.072],[.054,.269],[1.067,1.616]]};constructor(t){super(Ot,t),this.l_leg.straddle=this.r_leg.straddle=5,this.l_ankle.tilt=this.r_ankle.tilt=-5,this.l_ankle.bend=this.r_ankle.bend=3}}class Ft extends Bt{static URL="woman.glb";static HEIGHT=1.691;static SPACE={head:[[.001,1.471,-.049],[1.395,1.551],30],chest:[[.001,1.114,-.012],[.737,1.568],0,[.069,.509]],waist:[[.001,.961,-.014],[.589,1.417]],torso:[[.001,.961,-.014],[-1.696,-1.694]],leg:[[.071,.92,-.031],[-.002,.005],[1.163,.742]],thigh:[[.076,.7,-.031],[1.18,.233]],knee:[[.086,.48,-.037],[.573,.365],20],shin:[[.088,.337,-.047],[.724,-.059]],ankle:[[.076,.083,-.005],[.161,.014],-10],foot:[[.076,.031,.022],[.184,-.316],120],elbow:[[.404,1.375,-.066],[.39,.441]],forearm:[[.506,1.375,-.063],[.093,.805]],wrist:[[.608,1.375,-.056],[.581,.644]],arm:[[.137,1.338,-.066],[.052,.233],[1.011,1.519]]};constructor(t){super(Ft,t),this.l_leg.straddle=this.r_leg.straddle=-2.9,this.l_ankle.tilt=this.r_ankle.tilt=2.9,this.l_ankle.bend=this.r_ankle.bend=3}}class Dt extends Bt{static URL="child.glb";static HEIGHT=1.352;static SPACE={head:[[0,1.149,-.058],[1.091,1.209],30],chest:[[0,.865,-.013],[.566,1.236],0,[.054,.406]],waist:[[0,.717,-.024],[.385,1.13]],torso:[[0,.717,-.024],[-1.354,-1.353]],leg:[[.054,.704,-.027],[-.001,.001],[.845,.581],1],thigh:[[.062,.547,-.021],[.946,.189]],knee:[[.068,.389,-.031],[.468,.299],20],shin:[[.069,.272,-.048],[.581,-.045]],ankle:[[.073,.065,-.033],[.109,.044],-10],foot:[[.073,.027,-.006],[.112,-.271],120],elbow:[[.337,1.072,-.09],[.311,.369]],forearm:[[.438,1.074,-.094],[.073,.642]],wrist:[[.538,1.084,-.091],[.519,.553]],arm:[[.108,1.072,-.068],[.041,.185],[.811,1.217]]};constructor(t){super(Dt,t),this.l_ankle.bend=this.r_ankle.bend=3}}console.log("\n%c⋮⋮⋮ Disfigure\n%chttps://boytchev.github.io/disfigure/\n","color: navy","font-size:80%");export{Dt as Child,Ot as Man,Ft as Woman,ct as World,Z as bands,st as camera,rt as cameraLight,F as chaotic,at as controls,dt as everybody,ot as ground,G as latex,it as light,J as random,D as regular,tt as renderer,et as scene,wt as setAnimationLoop,q as slice,W as velour};
