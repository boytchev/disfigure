/*! disfigure v0.0.18 */
import{Vector3 as t,Box3 as e,WebGPURenderer as s,PCFSoftShadowMap as i,Scene as r,Color as a,PerspectiveCamera as n,DirectionalLight as h,Mesh as o,CircleGeometry as l,MeshLambertMaterial as c,CanvasTexture as d,Matrix3 as w,Matrix4 as m,Euler as p,Group as g,MeshPhysicalNodeMaterial as _}from"three";import{GLTFLoader as u}from"three/addons/loaders/GLTFLoader.js";import{Fn as f,mix as v,If as b,normalGeometry as y,transformNormalToView as x,positionGeometry as k,min as S,vec3 as z,float as E,select as P,vec2 as L,uniform as M,mat3 as A}from"three/tsl";import{SimplexNoise as R}from"three/addons/math/SimplexNoise.js";import{OrbitControls as C}from"three/addons/controls/OrbitControls.js";import U from"three/addons/libs/stats.module.js";var X=f((([t,e])=>{var s=t.sub(e.pivot).mul(e.matrix).add(e.pivot);return v(t,s,e.locus())})),j=f((([t,e])=>{var s=t.mul(e.matrix);return v(t,s,e.locus())}));function Y(t){return t.vertex=y,t.fn=j,x(I(t))}var I=f((({fn:t,space:e,vertex:s})=>{var i=s.toVar();return b(e.l_arm.locus(),(()=>{i.assign(t(i,e.l_wrist)),i.assign(t(i,e.l_forearm)),i.assign(t(i,e.l_elbow)),i.assign(t(i,e.l_arm))})),b(e.r_arm.locus(),(()=>{i.assign(t(i,e.r_wrist)),i.assign(t(i,e.r_forearm)),i.assign(t(i,e.r_elbow)),i.assign(t(i,e.r_arm))})),b(e.l_leg.locus(),(()=>{i.assign(t(i,e.l_foot)),i.assign(t(i,e.l_ankle)),i.assign(t(i,e.l_shin)),i.assign(t(i,e.l_knee)),i.assign(t(i,e.l_thigh)),i.assign(t(i,e.l_leg))})),b(e.r_leg.locus(),(()=>{i.assign(t(i,e.r_foot)),i.assign(t(i,e.r_ankle)),i.assign(t(i,e.r_shin)),i.assign(t(i,e.r_knee)),i.assign(t(i,e.r_thigh)),i.assign(t(i,e.r_leg))})),i.assign(t(i,e.head)),i.assign(t(i,e.chest)),i.assign(t(i,e.waist)),i.assign(t(i,e.torso)),i}));var H=new R;function N(t,e=0,s=-1,i=1){return s+(i-s)*(H.noise(t,e)+1)/2}function F(t,e=0,s=-1,i=1){return s+(i-s)*(Math.sin(t+e)+1)/2}function O(t=-1,e=1){return t+(e-t)*Math.random()}var W,T,q,B,D,V,G,Z,J,K=[];class Q{constructor(t){if((W=new s({antialias:!0})).setSize(innerWidth,innerHeight),W.shadowMap.enabled=t?.shadows??!0,W.shadowMap.type=i,document.body.appendChild(W.domElement),document.body.style.overflow="hidden",document.body.style.margin="0",(T=new r).background=new a("whitesmoke"),(q=new n(30,innerWidth/innerHeight)).position.set(0,1,4),q.lookAt(0,1,0),t?.stats&&(J=new U,document.body.appendChild(J.dom)),(t?.lights??1)&&((B=new h("white",1.5)).position.set(0,14,7),(t?.shadows??1)&&(B.shadow.mapSize.width=2048,B.shadow.mapSize.height=B.shadow.mapSize.width,B.shadow.camera.near=1,B.shadow.camera.far=50,B.shadow.camera.left=-5,B.shadow.camera.right=5,B.shadow.camera.top=5,B.shadow.camera.bottom=-5,B.shadow.normalBias=.01,B.autoUpdate=!1,B.castShadow=!0),T.add(B),(D=new h("white",1.5)).target=T,q.add(D),T.add(q)),(t?.controls??1)&&((V=new C(q,W.domElement)).enableDamping=!0,V.target.set(0,.8,0)),t?.ground??1){var e=document.createElement("CANVAS");e.width=128,e.height=128;var w=e.getContext("2d");w.fillStyle="white",w.filter="blur(10px)",w.beginPath(),w.arc(64,64,38,0,2*Math.PI),w.fill(),(G=new o(new l(50),new c({color:"antiquewhite",transparent:!0,map:new d(e)}))).receiveShadow=!0,G.rotation.x=-Math.PI/2,G.renderOrder=-1,T.add(G)}window.addEventListener("resize",(()=>{q.aspect=innerWidth/innerHeight,q.updateProjectionMatrix(),W.setSize(innerWidth,innerHeight)})),W.setAnimationLoop(et)}}class $ extends Event{#t;constructor(){super("animate")}get target(){return this.#t}set target(t){this.#t=t}}var tt=new $;function et(t){tt.time=t,window.dispatchEvent(tt),K.forEach((t=>{t.update(),t.dispatchEvent(tt)})),Z&&Z(t),V&&V.update(),J&&J.update(),W.render(T,q)}function st(t){Z=t}var it=document.createElement("style");it.innerHTML="\n\t#spinner {position:fixed;left:49%;top:45%;animation:flash 1s 3;}\n\t#spinner::before {content:'Loading...'}\n\t@keyframes flash{to{opacity:0}}\n",document.head.appendChild(it);var rt=0,at=document.getElementById("spinner");at&&setTimeout((()=>at.style.display="none"),3e3);const nt=f((([t,e])=>e.smoothstep(t.x,t.y).smoothstep(0,1).smoothstep(0,1)),{edge:"vec2",value:"float",return:"float"});var ht=f((([t,e,s,i])=>{var r=t.y,a=t.z;return r=r.add(a.sub(e.z).div(i)),nt(s,r)}),{pos:"vec3",pivot:"vec3",rangeY:"vec2",slope:"float",return:"float"}),ot=f((([t,e])=>nt(e,t.x)),{pos:"vec3",rangeX:"vec2",return:"float"}),lt=f((([t,e,s,i])=>{var r=t.x,a=t.y,n=a.sub(e.y).div(4,r.sign());return nt(s,r.add(n)).mul(S(a.smoothstep(i.x,v(i.x,i.y,.2)),a.smoothstep(i.y,v(i.y,i.x,.2)))).pow(2)}),{pos:"vec3",pivot:"vec3",rangeX:"vec2",rangeY:"vec2",return:"float"}),ct=f((([t,e,s,i,r])=>{var a=t.x,n=t.y,h=t.z,o=z(a.mul(2),n,h.min(0)).sub(z(0,e.y,0)).length().smoothstep(0,E(.13).div(E(r).add(1))).pow(10),l=n.sub(a.abs().mul(.2));return l=l.add(P(r.equal(1),h.abs().mul(.5),h.mul(1/6))),o.mul(a.smoothstep(s.x,s.y),nt(i,l).pow(2))}),{pos:"vec3",pivot:"vec3",rangeX:"vec2",rangeY:"vec2",grown:"float",return:"float"});class dt{constructor(e){this.pivot=new t(...e),this.angle=new t,this.matrix=M(A()),this.isRight=!1}mirror(){return this.isRight=!0,this.pivot.x*=-1,this.rangeX&&(this.rangeX.value.x*=-1,this.rangeX.value.y*=-1),this}}class wt extends dt{constructor(t,e,s=0){super(t),this.rangeY=L(...e),this.slope=Math.tan((90-s)*Math.PI/180)}locus(){return ht(k,this.pivot,this.rangeY,this.slope)}}class mt extends dt{constructor(t,e){super(t),this.rangeX=L(...e)}locus(){return ot(k,this.rangeX)}}class pt extends mt{constructor(t,e,s){super(t,e),this.rangeY=L(...s)}locus(){return rt++,at&&rt>=12*K.length&&(at.style.display="none"),lt(k,this.pivot,this.rangeX,this.rangeY)}}class gt extends pt{constructor(t,e,s,i=0){super(t,e,s),this.grown=i}locus(){return ct(k,this.pivot,this.rangeX,this.rangeY,this.grown)}}class _t{constructor(t){this.head=new wt(...t.head),this.chest=new wt(...t.chest),this.waist=new wt(...t.waist),this.torso=new wt(...t.torso),this.l_knee=new wt(...t.knee),this.r_knee=new wt(...t.knee).mirror(),this.l_ankle=new wt(...t.ankle),this.r_ankle=new wt(...t.ankle).mirror(),this.l_shin=new wt(...t.shin),this.r_shin=new wt(...t.shin).mirror(),this.l_thigh=new wt(...t.thigh),this.r_thigh=new wt(...t.thigh).mirror(),this.l_foot=new wt(...t.foot),this.r_foot=new wt(...t.foot).mirror(),this.l_leg=new gt(...t.leg),this.r_leg=new gt(...t.leg).mirror(),this.l_elbow=new mt(...t.elbow),this.r_elbow=new mt(...t.elbow).mirror(),this.l_forearm=new mt(...t.forearm),this.r_forearm=new mt(...t.forearm).mirror(),this.l_wrist=new mt(...t.wrist),this.r_wrist=new mt(...t.wrist).mirror(),this.l_arm=new pt(...t.arm),this.r_arm=new pt(...t.arm).mirror()}}const ut=import.meta.url.replace("/src/body.js","/assets/models/");var ft=new w,vt=new w,bt=new t;function yt(t,e,s){Object.defineProperty(t,e,{get:()=>t.angle[s]/(2*Math.PI/360),set(e){t.angle[s]=e*(2*Math.PI/360)}})}class xt extends g{constructor(t,e,s,i="xyz"){super(),this.model=t,this.parent=e,this.pivot=s.pivot,this.angle=s.angle,this.matrix=s.matrix,this.isRight=s.isRight,this.position.copy(s.pivot),yt(this,"bend",i[0]),yt(this,"raise",i[0]),yt(this,"tilt",i[2]),yt(this,"straddle",i[2]),yt(this,"foreward",i[0]),yt(this,"turn",i[1])}attach(t){t.parent&&(t=t.clone());var e=new g,s=new g;e.add(s),s.add(t),e.matrixAutoUpdate=!1,e.joint=this,this.model.children[0].add(e),this.model.accessories.push(e)}}var kt=new m,St=new p,zt=1;class Et extends g{constructor(s,i,r){super(),this.uid=zt,zt+=.3+2*Math.random(),this.castShadow=!0,this.receiveShadow=!0,this.accessories=[],this.space={};var a,n=new o(s.scene.children[0].geometry),h=function(s){var i=new t,r=(new e).setFromObject(s,!0);return r.getCenter(i),s.position.sub(i),r.max.y-r.min.y}(n);this.space=new _t(i),this.torso=new xt(this,null,this.space.torso),this.waist=new xt(this,this.torso,this.space.waist),this.chest=new xt(this,this.waist,this.space.chest),this.head=new xt(this,this.chest,this.space.head),this.l_leg=new xt(this,this.torso,this.space.l_leg),this.l_thigh=new xt(this,this.l_leg,this.space.l_thigh),this.l_knee=new xt(this,this.l_thigh,this.space.l_knee),this.l_shin=new xt(this,this.l_knee,this.space.l_shin),this.l_ankle=new xt(this,this.l_shin,this.space.l_ankle),this.l_foot=new xt(this,this.l_ankle,this.space.l_foot),this.r_leg=new xt(this,this.torso,this.space.r_leg),this.r_thigh=new xt(this,this.r_leg,this.space.r_thigh),this.r_knee=new xt(this,this.r_thigh,this.space.r_knee),this.r_shin=new xt(this,this.r_knee,this.space.r_shin),this.r_ankle=new xt(this,this.r_shin,this.space.r_ankle),this.r_foot=new xt(this,this.r_ankle,this.space.r_foot),this.l_arm=new xt(this,this.chest,this.space.l_arm,"yxz"),this.l_elbow=new xt(this,this.l_arm,this.space.l_elbow,"yxz"),this.l_forearm=new xt(this,this.l_elbow,this.space.l_forearm,"zxy"),this.l_wrist=new xt(this,this.l_forearm,this.space.l_wrist,"zxy"),this.r_arm=new xt(this,this.chest,this.space.r_arm,"yxz"),this.r_elbow=new xt(this,this.r_arm,this.space.r_elbow,"yxz"),this.r_forearm=new xt(this,this.r_elbow,this.space.r_forearm,"zxy"),this.r_wrist=new xt(this,this.r_forearm,this.space.r_wrist,"zxy"),n.material=new _({positionNode:(a={space:this.space},a.vertex=k,a.fn=X,I(a)),normalNode:Y({space:this.space}),colorNode:z(.99,.65,.49),metalness:0,roughness:.6}),this.height=r??h,n.scale.setScalar(this.height/h),n.position.y=0,n.castShadow=!0,n.receiveShadow=!0,this.model=n,this.add(n),K.push(this),T&&T.add(this),this.l_arm.straddle=this.r_arm.straddle=65,this.l_elbow.bend=this.r_elbow.bend=20}update(){function t(t,e,s,i){St.set(e*t.angle.x,s*t.angle.y,i*t.angle.z,"YZX"),kt.makeRotationFromEuler(St);var r=kt.elements;t.matrix.value.set(r[0],r[4],r[8],r[1],r[5],r[9],r[2],r[6],r[10])}for(var e of(t(this.head,-1,-1,1),t(this.chest,-1,-1,1),t(this.waist,-1,-1,1),t(this.torso,-1,-1,1),t(this.l_elbow,0,1,0),t(this.r_elbow,0,-1,0),t(this.l_wrist,0,1,1),t(this.r_wrist,0,-1,-1),t(this.space.l_forearm,-1,0,0),t(this.space.r_forearm,-1,0,0),t(this.l_arm,-1,1,1),t(this.r_arm,-1,-1,-1),t(this.l_knee,-1,0,0),t(this.r_knee,-1,0,0),t(this.l_ankle,-1,0,-1),t(this.r_ankle,-1,0,1),t(this.space.l_shin,0,-1,0),t(this.space.r_shin,0,1,0),t(this.l_foot,-1,0,0),t(this.r_foot,-1,0,0),t(this.space.l_thigh,0,-1,0),t(this.space.r_thigh,0,1,0),t(this.l_leg,1,0,-1),t(this.r_leg,1,0,1),this.accessories)){var s=e.joint;for(vt.identity(),bt.copy(s.pivot);s;s=s.parent)ft.copy(s.matrix.value).transpose(),vt.premultiply(ft),bt.sub(s.pivot).applyMatrix3(ft).add(s.pivot);e.matrix.setFromMatrix3(vt),e.matrix.setPosition(bt)}}}class Pt extends Et{static URL="man.glb";static SPACE={head:[[0,1.566,-.066],[1.495,1.647],30],chest:[[0,1.177,-.014],[.777,1.658],0,[.072,.538]],waist:[[0,1.014,-.016],[.547,1.498]],torso:[[0,1.014,-.016],[-3,-2]],leg:[[.074,.97,-.034],[-.004,.004],[1.229,.782]],thigh:[[.07,-.009,-.034],[1.247,.242]],knee:[[.09,.504,-.041],[.603,.382],20],ankle:[[.074,.082,-.002],[.165,.008],-10],shin:[[.092,.36,-.052],[.762,-.027]],foot:[[0,.026,.022],[.19,-.342],120],elbow:[[.427,1.453,-.072],[.413,.467]],forearm:[[.305,1.453,-.068],[.083,.879]],wrist:[[.673,1.462,-.072],[.635,.722]],arm:[[.153,1.408,-.072],[.054,.269],[1.067,1.606]]};constructor(t){super(Rt,Pt.SPACE,t),this.url=ut+Pt.URL,this.l_leg.straddle=this.r_leg.straddle=5,this.l_ankle.tilt=this.r_ankle.tilt=-5,this.l_ankle.bend=this.r_ankle.bend=3}}class Lt extends Et{static URL="woman.glb";static SPACE={head:[[.001,1.471,-.049],[1.395,1.551],30],chest:[[.001,1.114,-.012],[.737,1.568],0,[.069,.509]],waist:[[.001,.961,-.014],[.589,1.417]],torso:[[.001,.961,-.014],[-1.696,-1.694]],leg:[[.071,.92,-.031],[-.002,.005],[1.163,.742]],thigh:[[.076,-.003,-.031],[1.18,.233]],knee:[[.086,.48,-.037],[.573,.365],20],shin:[[.088,.337,-.047],[.724,-.059]],ankle:[[.076,.083,-.005],[.161,.014],-10],foot:[[.001,.031,.022],[.184,-.316],120],elbow:[[.404,1.375,-.066],[.39,.441]],forearm:[[.289,1.375,-.063],[.093,.805]],wrist:[[.608,1.375,-.056],[.581,.644]],arm:[[.137,1.338,-.066],[.052,.233],[1.011,1.519]]};constructor(t){super(Ct,Lt.SPACE,t),this.url=ut+Lt.URL,this.l_leg.straddle=this.r_leg.straddle=-2.9,this.l_ankle.tilt=this.r_ankle.tilt=2.9,this.l_ankle.bend=this.r_ankle.bend=3}}class Mt extends Et{static URL="child.glb";static SPACE={head:[[0,1.149,-.058],[1.091,1.209],30],chest:[[0,.865,-.013],[.566,1.236],0,[.054,.406]],waist:[[0,.717,-.024],[.385,1.13]],torso:[[0,.717,-.024],[-1.354,-1.353]],leg:[[.054,.704,-.027],[-.001,.001],[.845,.581],1],thigh:[[.062,-0,-.021],[.946,.189]],knee:[[.068,.389,-.031],[.468,.299],20],shin:[[.069,.272,-.048],[.581,-.045]],ankle:[[.073,.065,-.033],[.109,.044],-10],foot:[[0,.027,-.006],[.112,-.271],120],elbow:[[.337,1.072,-.09],[.311,.369]],forearm:[[.23,1.074,-.094],[.073,.642]],wrist:[[.538,1.084,-.091],[.519,.553]],arm:[[.108,1.072,-.068],[.041,.185],[.811,1.217]]};constructor(t){super(Ut,Mt.SPACE,t),this.url=ut+Mt.URL,this.l_ankle.bend=this.r_ankle.bend=3}}var At=new u,[Rt,Ct,Ut]=await Promise.all([At.loadAsync(ut+Pt.URL),At.loadAsync(ut+Lt.URL),At.loadAsync(ut+Mt.URL)]);console.log("\n%c⋮⋮⋮ Disfigure\n%chttps://boytchev.github.io/disfigure/\n","color: navy","font-size:80%");export{Mt as Child,Pt as Man,Lt as Woman,Q as World,q as camera,D as cameraLight,N as chaotic,V as controls,K as everybody,G as ground,B as light,O as random,F as regular,W as renderer,T as scene,st as setAnimationLoop};
