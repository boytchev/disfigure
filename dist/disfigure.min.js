/*! disfigure v0.0.18 */
import{Vector3 as t,Box3 as s,WebGPURenderer as e,PCFSoftShadowMap as i,Scene as r,Color as a,PerspectiveCamera as h,DirectionalLight as n,Mesh as o,CircleGeometry as l,MeshLambertMaterial as d,CanvasTexture as m,Matrix3 as c,Matrix4 as w,Euler as p,Group as _,MeshPhysicalNodeMaterial as g}from"three";import{GLTFLoader as u}from"three/addons/loaders/GLTFLoader.js";import{Fn as f,mix as x,If as b,normalGeometry as v,transformNormalToView as y,positionGeometry as k,vec3 as S,float as z,min as X,uniform as E,mat3 as P}from"three/tsl";import{SimplexNoise as M}from"three/addons/math/SimplexNoise.js";import{OrbitControls as L}from"three/addons/controls/OrbitControls.js";import R from"three/addons/libs/stats.module.js";var Y=f((([t,s])=>{var e=t.sub(s.pivot).mul(s.matrix).add(s.pivot);return x(t,e,s.locus())})),A=f((([t,s])=>{var e=t.mul(s.matrix);return x(t,e,s.locus())}));function C(t){return t.vertex=v,t.fn=A,y(U(t))}var U=f((({fn:t,space:s,vertex:e})=>{var i=e.toVar();return b(s.l_arm.locus(),(()=>{i.assign(t(i,s.l_wrist)),i.assign(t(i,s.l_forearm)),i.assign(t(i,s.l_elbow)),i.assign(t(i,s.l_arm))})),b(s.r_arm.locus(),(()=>{i.assign(t(i,s.r_wrist)),i.assign(t(i,s.r_forearm)),i.assign(t(i,s.r_elbow)),i.assign(t(i,s.r_arm))})),b(s.l_leg.locus(),(()=>{i.assign(t(i,s.l_foot)),i.assign(t(i,s.l_ankle)),i.assign(t(i,s.l_shin)),i.assign(t(i,s.l_knee)),i.assign(t(i,s.l_thigh)),i.assign(t(i,s.l_leg))})),b(s.r_leg.locus(),(()=>{i.assign(t(i,s.r_foot)),i.assign(t(i,s.r_ankle)),i.assign(t(i,s.r_shin)),i.assign(t(i,s.r_knee)),i.assign(t(i,s.r_thigh)),i.assign(t(i,s.r_leg))})),i.assign(t(i,s.head)),i.assign(t(i,s.chest)),i.assign(t(i,s.waist)),i.assign(t(i,s.torso)),i}));var j=new M;function I(t,s=0,e=-1,i=1){return e+(i-e)*(j.noise(t,s)+1)/2}function F(t,s=0,e=-1,i=1){return e+(i-e)*(Math.sin(t+s)+1)/2}function H(t=-1,s=1){return t+(s-t)*Math.random()}var N,O,T,W,B,D,V,q,G,Z=[];class J{constructor(t){if((N=new e({antialias:!0})).setSize(innerWidth,innerHeight),N.shadowMap.enabled=t?.shadows??!0,N.shadowMap.type=i,document.body.appendChild(N.domElement),document.body.style.overflow="hidden",document.body.style.margin="0",(O=new r).background=new a("whitesmoke"),(T=new h(30,innerWidth/innerHeight)).position.set(0,1,4),T.lookAt(0,1,0),t?.stats&&(G=new R,document.body.appendChild(G.dom)),(t?.lights??1)&&((W=new n("white",1.5)).position.set(0,14,7),(t?.shadows??1)&&(W.shadow.mapSize.width=2048,W.shadow.mapSize.height=W.shadow.mapSize.width,W.shadow.camera.near=1,W.shadow.camera.far=50,W.shadow.camera.left=-5,W.shadow.camera.right=5,W.shadow.camera.top=5,W.shadow.camera.bottom=-5,W.shadow.normalBias=.01,W.autoUpdate=!1,W.castShadow=!0),O.add(W),(B=new n("white",1.5)).target=O,T.add(B),O.add(T)),(t?.controls??1)&&((D=new L(T,N.domElement)).enableDamping=!0,D.target.set(0,.8,0)),t?.ground??1){var s=document.createElement("CANVAS");s.width=128,s.height=128;var c=s.getContext("2d");c.fillStyle="white",c.filter="blur(10px)",c.beginPath(),c.arc(64,64,38,0,2*Math.PI),c.fill(),(V=new o(new l(50),new d({color:"antiquewhite",transparent:!0,map:new m(s)}))).receiveShadow=!0,V.rotation.x=-Math.PI/2,V.renderOrder=-1,O.add(V)}window.addEventListener("resize",(()=>{T.aspect=innerWidth/innerHeight,T.updateProjectionMatrix(),N.setSize(innerWidth,innerHeight)})),N.setAnimationLoop($)}}class K extends Event{#t;constructor(){super("animate")}get target(){return this.#t}set target(t){this.#t=t}}var Q=new K;function $(t){Q.time=t,window.dispatchEvent(Q),Z.forEach((t=>{t.update(),t.dispatchEvent(Q)})),q&&q(t),D&&D.update(),G&&G.update(),N.render(O,T)}function tt(t){q=t}var st=document.createElement("style");st.innerHTML="\n\t#spinner {position:fixed;left:49%;top:45%;animation:flash 1s 3;}\n\t#spinner::before {content:'Loading...'}\n\t@keyframes flash{to{opacity:0}}\n",document.head.appendChild(st);var et=0,it=document.getElementById("spinner");it&&setTimeout((()=>it.style.display="none"),3e3);const rt=f((([t,s,e])=>e.smoothstep(t,s).smoothstep(0,1).smoothstep(0,1)),{edgeFrom:"float",edgeTo:"float",value:"float",return:"float"});class at{constructor(s){this.pivot=new t(...s),this.angle=new t,this.matrix=E(P()),this.isRight=!1}mirror(){return this.isRight=!0,this.pivot.x*=-1,this.minX&&(this.minX*=-1),this.maxX&&(this.maxX*=-1),this}}class ht extends at{constructor(t,s,e=0,i=[0,0]){super(t),[this.minY,this.maxY]=s,[this.minX,this.maxX]=i,this.slope=Math.tan((90-e)*Math.PI/180)}locus(){var{x:t,y:s,z:e}=k;s=s.add(e.sub(this.pivot.z).div(this.slope));var i=rt(this.minY,this.maxY,s);return(this.minX||this.maxX)&&(i=i.max(rt(this.minX,this.maxX,t.abs().add(s.sub(this.pivot.y))))),i}}class nt extends at{constructor(t,s){super(t),[this.minX,this.maxX]=s}locus(){var t=k.x;return rt(this.minX,this.maxX,t)}}class ot extends nt{constructor(t,s,e){super(t,s),[this.minY,this.maxY]=e}locus(){et++,it&&et>=12*Z.length&&(it.style.display="none");var{x:t,y:s}=k,e=s.sub(this.pivot.y).div(4,t.sign());return rt(z(this.minX).sub(e),z(this.maxX).sub(e),t).mul(X(rt(this.minY,.8*this.minY+.2*this.maxY,s),rt(this.maxY,.8*this.maxY+.2*this.minY,s))).pow(2)}}class lt extends ot{constructor(t,s,e,i=0){super(t,s,e),this.grown=i}locus(){var{x:t,y:s,z:e}=k,i=S(t.mul(2),s,e.min(0)).sub(S(0,this.pivot.y,0)).length().smoothstep(0,.13/(this.grown+1)).pow(10),r=s.sub(t.abs().mul(.2));return r=0==this.grown?r.add(e.mul(1/6)):r.add(e.abs().mul(.5)),i.mul(t.smoothstep(this.minX,this.maxX),rt(this.minY,this.maxY,r).pow(2))}}class dt{constructor(t){this.head=new ht(...t.head),this.chest=new ht(...t.chest),this.waist=new ht(...t.waist),this.torso=new ht(...t.torso),this.l_knee=new ht(...t.knee),this.r_knee=new ht(...t.knee).mirror(),this.l_ankle=new ht(...t.ankle),this.r_ankle=new ht(...t.ankle).mirror(),this.l_shin=new ht(...t.shin),this.r_shin=new ht(...t.shin).mirror(),this.l_thigh=new ht(...t.thigh),this.r_thigh=new ht(...t.thigh).mirror(),this.l_foot=new ht(...t.foot),this.r_foot=new ht(...t.foot).mirror(),this.l_leg=new lt(...t.leg),this.r_leg=new lt(...t.leg).mirror(),this.l_elbow=new nt(...t.elbow),this.r_elbow=new nt(...t.elbow).mirror(),this.l_forearm=new nt(...t.forearm),this.r_forearm=new nt(...t.forearm).mirror(),this.l_wrist=new nt(...t.wrist),this.r_wrist=new nt(...t.wrist).mirror(),this.l_arm=new ot(...t.arm),this.r_arm=new ot(...t.arm).mirror()}}const mt=import.meta.url.replace("/src/body.js","/assets/models/");var ct=new c,wt=new c,pt=new t;function _t(t,s,e){Object.defineProperty(t,s,{get:()=>t.angle[e]/(2*Math.PI/360),set(s){t.angle[e]=s*(2*Math.PI/360)}})}class gt extends _{constructor(t,s,e,i="xyz"){super(),this.model=t,this.parent=s,this.pivot=e.pivot,this.angle=e.angle,this.matrix=e.matrix,this.isRight=e.isRight,this.position.copy(e.pivot),_t(this,"bend",i[0]),_t(this,"raise",i[0]),_t(this,"tilt",i[2]),_t(this,"straddle",i[2]),_t(this,"foreward",i[0]),_t(this,"turn",i[1])}attach(t){t.parent&&(t=t.clone());var s=new _,e=new _;s.add(e),e.add(t),e.rotation.y=this.isRight?Math.PI:0,s.matrixAutoUpdate=!1,s.joint=this,this.model.children[0].add(s),this.model.accessories.push(s)}}var ut=new w,ft=new p,xt=1;class bt extends _{constructor(e,i,r){super(),this.uid=xt,xt+=.3+2*Math.random(),this.castShadow=!0,this.receiveShadow=!0,this.accessories=[],this.space={};var a,h=new o(e.scene.children[0].geometry),n=function(e){var i=new t,r=(new s).setFromObject(e,!0);return r.getCenter(i),e.position.sub(i),r.max.y-r.min.y}(h);this.space=new dt(i),this.torso=new gt(this,null,this.space.torso),this.waist=new gt(this,this.torso,this.space.waist),this.chest=new gt(this,this.waist,this.space.chest),this.head=new gt(this,this.chest,this.space.head),this.l_leg=new gt(this,this.torso,this.space.l_leg),this.l_thigh=new gt(this,this.l_leg,this.space.l_thigh),this.l_knee=new gt(this,this.l_thigh,this.space.l_knee),this.l_shin=new gt(this,this.l_knee,this.space.l_shin),this.l_ankle=new gt(this,this.l_shin,this.space.l_ankle),this.l_foot=new gt(this,this.l_ankle,this.space.l_foot),this.r_leg=new gt(this,this.torso,this.space.r_leg),this.r_thigh=new gt(this,this.r_leg,this.space.r_thigh),this.r_knee=new gt(this,this.r_thigh,this.space.r_knee),this.r_shin=new gt(this,this.r_knee,this.space.r_shin),this.r_ankle=new gt(this,this.r_shin,this.space.r_ankle),this.r_foot=new gt(this,this.r_ankle,this.space.r_foot),this.l_arm=new gt(this,this.chest,this.space.l_arm,"yxz"),this.l_elbow=new gt(this,this.l_arm,this.space.l_elbow,"yxz"),this.l_forearm=new gt(this,this.l_elbow,this.space.l_forearm,"zxy"),this.l_wrist=new gt(this,this.l_forearm,this.space.l_wrist,"zxy"),this.r_arm=new gt(this,this.chest,this.space.r_arm,"yxz"),this.r_elbow=new gt(this,this.r_arm,this.space.r_elbow,"yxz"),this.r_forearm=new gt(this,this.r_elbow,this.space.r_forearm,"zxy"),this.r_wrist=new gt(this,this.r_forearm,this.space.r_wrist,"zxy"),h.material=new g({positionNode:(a={space:this.space},a.vertex=k,a.fn=Y,U(a)),normalNode:C({space:this.space}),colorNode:S(.99,.65,.49),metalness:0,roughness:.6}),this.height=r??n,h.scale.setScalar(this.height/n),h.position.y=0,h.castShadow=!0,h.receiveShadow=!0,this.model=h,this.add(h),Z.push(this),O&&O.add(this),this.l_arm.straddle=this.r_arm.straddle=65,this.l_elbow.bend=this.r_elbow.bend=20}update(){function t(t,s,e,i){ft.set(s*t.angle.x,e*t.angle.y,i*t.angle.z,"YZX"),ut.makeRotationFromEuler(ft);var r=ut.elements;t.matrix.value.set(r[0],r[4],r[8],r[1],r[5],r[9],r[2],r[6],r[10])}for(var s of(t(this.head,-1,-1,1),t(this.chest,-1,-1,1),t(this.waist,-1,-1,1),t(this.torso,-1,-1,1),t(this.l_elbow,0,1,0),t(this.r_elbow,0,-1,0),t(this.l_wrist,0,1,1),t(this.r_wrist,0,-1,-1),t(this.space.l_forearm,-1,0,0),t(this.space.r_forearm,-1,0,0),t(this.l_arm,-1,1,1),t(this.r_arm,-1,-1,-1),t(this.l_knee,-1,0,0),t(this.r_knee,-1,0,0),t(this.l_ankle,-1,0,-1),t(this.r_ankle,-1,0,1),t(this.space.l_shin,0,-1,0),t(this.space.r_shin,0,1,0),t(this.l_foot,-1,0,0),t(this.r_foot,-1,0,0),t(this.space.l_thigh,0,-1,0),t(this.space.r_thigh,0,1,0),t(this.l_leg,1,0,-1),t(this.r_leg,1,0,1),this.accessories)){var e=s.joint;for(wt.identity(),pt.copy(e.pivot);e;e=e.parent)ct.copy(e.matrix.value).transpose(),wt.premultiply(ct),pt.sub(e.pivot).applyMatrix3(ct).add(e.pivot);s.matrix.setFromMatrix3(wt),s.matrix.setPosition(pt)}}}class vt extends bt{static URL="man.glb";static SPACE={head:[[0,1.566,-.066],[1.495,1.647],30],chest:[[0,1.177,-.014],[.777,1.658],0,[.072,.538]],waist:[[0,1.014,-.016],[.547,1.498]],torso:[[0,1.014,-.016],[-3,-2]],leg:[[.074,.97,-.034],[-.004,.004],[1.229,.782]],thigh:[[.07,-.009,-.034],[1.247,.242]],knee:[[.09,.504,-.041],[.603,.382],20],ankle:[[.074,.082,-.002],[.165,.008],-10],shin:[[.092,.36,-.052],[.762,-.027]],foot:[[0,.026,.022],[.19,-.342],120],elbow:[[.427,1.453,-.072],[.413,.467]],forearm:[[.305,1.453,-.068],[.083,.879]],wrist:[[.673,1.462,-.072],[.635,.722]],arm:[[.153,1.408,-.072],[.054,.269],[1.067,1.606]]};constructor(t){super(zt,vt.SPACE,t),this.url=mt+vt.URL,this.l_leg.straddle=this.r_leg.straddle=5,this.l_ankle.tilt=this.r_ankle.tilt=-5,this.l_ankle.bend=this.r_ankle.bend=3}}class yt extends bt{static URL="woman.glb";static SPACE={head:[[.001,1.471,-.049],[1.395,1.551],30],chest:[[.001,1.114,-.012],[.737,1.568],0,[.069,.509]],waist:[[.001,.961,-.014],[.589,1.417]],torso:[[.001,.961,-.014],[-1.696,-1.694]],leg:[[.071,.92,-.031],[-.002,.005],[1.163,.742]],thigh:[[.076,-.003,-.031],[1.18,.233]],knee:[[.086,.48,-.037],[.573,.365],20],shin:[[.088,.337,-.047],[.724,-.059]],ankle:[[.076,.083,-.005],[.161,.014],-10],foot:[[.001,.031,.022],[.184,-.316],120],elbow:[[.404,1.375,-.066],[.39,.441]],forearm:[[.289,1.375,-.063],[.093,.805]],wrist:[[.608,1.375,-.056],[.581,.644]],arm:[[.137,1.338,-.066],[.052,.233],[1.011,1.519]]};constructor(t){super(Xt,yt.SPACE,t),this.url=mt+yt.URL,this.l_leg.straddle=this.r_leg.straddle=-2.9,this.l_ankle.tilt=this.r_ankle.tilt=2.9,this.l_ankle.bend=this.r_ankle.bend=3}}class kt extends bt{static URL="child.glb";static SPACE={head:[[0,1.149,-.058],[1.091,1.209],30],chest:[[0,.865,-.013],[.566,1.236],0,[.054,.406]],waist:[[0,.717,-.024],[.385,1.13]],torso:[[0,.717,-.024],[-1.354,-1.353]],leg:[[.054,.704,-.027],[-.001,.001],[.845,.581],1],thigh:[[.062,-0,-.021],[.946,.189]],knee:[[.068,.389,-.031],[.468,.299],20],shin:[[.069,.272,-.048],[.581,-.045]],ankle:[[.073,.065,-.033],[.109,.044],-10],foot:[[0,.027,-.006],[.112,-.271],120],elbow:[[.337,1.072,-.09],[.311,.369]],forearm:[[.23,1.074,-.094],[.073,.642]],wrist:[[.538,1.084,-.091],[.519,.553]],arm:[[.108,1.072,-.068],[.041,.185],[.811,1.217]]};constructor(t){super(Et,kt.SPACE,t),this.url=mt+kt.URL,this.l_ankle.bend=this.r_ankle.bend=3}}var St=new u,[zt,Xt,Et]=await Promise.all([St.loadAsync(mt+vt.URL),St.loadAsync(mt+yt.URL),St.loadAsync(mt+kt.URL)]);console.log("\n%c⋮⋮⋮ Disfigure\n%chttps://boytchev.github.io/disfigure/\n","color: navy","font-size:80%");export{kt as Child,vt as Man,yt as Woman,J as World,T as camera,B as cameraLight,I as chaotic,D as controls,Z as everybody,V as ground,W as light,H as random,F as regular,N as renderer,O as scene,tt as setAnimationLoop};
