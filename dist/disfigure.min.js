/*! disfigure v0.0.9 */
import{Mesh as t,MeshPhysicalNodeMaterial as e,Vector3 as i,Box3 as s}from"three";import{Fn as o,mat3 as a,mix as r,float as m,If as n,select as u,vec3 as d,positionGeometry as h,normalGeometry as l,transformNormalToView as p,uniform as c}from"three/tsl";const y=o((([t])=>{var e=t.cos().toVar(),i=t.sin().toVar();return a(1,0,0,0,e,i,0,i.negate(),e)})).setLayout({name:"matRotX",type:"mat3",inputs:[{name:"angle",type:"float"}]}),z=o((([t])=>{var e=t.cos().toVar(),i=t.sin().toVar();return a(e,0,i.negate(),0,1,0,i,0,e)})).setLayout({name:"matRotY",type:"mat3",inputs:[{name:"angle",type:"float"}]}),v=o((([t])=>{var e=t.cos().toVar(),i=t.sin().toVar();return a(e,i,0,i.negate(),e,0,0,0,1)})).setLayout({name:"matRotZ",type:"mat3",inputs:[{name:"angle",type:"float"}]}),f=o((([t])=>{var e=y(t.x),i=z(t.y),s=v(t.z);return i.mul(e).mul(s)})).setLayout({name:"matRotYXZ",type:"mat3",inputs:[{name:"angles",type:"vec3"}]}),g=o((([t])=>{var e=y(t.x),i=z(t.y),s=v(t.z);return i.mul(s).mul(e)})).setLayout({name:"matRotYZX",type:"mat3",inputs:[{name:"angles",type:"vec3"}]}),x=o((([t])=>{var e=y(t.x),i=z(t.y),s=v(t.z);return e.mul(i).mul(s)})).setLayout({name:"matRotXYZ",type:"mat3",inputs:[{name:"angles",type:"vec3"}]}),Y=o((([t])=>{var e=y(t.x),i=z(t.y),s=v(t.z);return e.mul(s).mul(i)})).setLayout({name:"matRotXZY",type:"mat3",inputs:[{name:"angles",type:"vec3"}]}),w=o((([t])=>{var e=y(t.x),i=z(t.y);return v(t.z).mul(e).mul(i)})).setLayout({name:"matRotZXY",type:"mat3",inputs:[{name:"angles",type:"vec3"}]}),L=o((([t])=>{var e=y(t.x),i=z(t.y);return v(t.z).mul(i).mul(e)})).setLayout({name:"matRotZYX",type:"mat3",inputs:[{name:"angles",type:"vec3"}]});function R(o,a,r,m,n){return function(e){var i=[];e.traverse((e=>{if(e.isMesh){var s=e.geometry.clone().applyMatrix4(e.matrixWorld),o=e.material.clone();i.push(new t(s,o))}})),e.clear(),e.position.set(0,0,0),e.rotation.set(0,0,0,"XYZ"),e.scale.set(1,1,1),e.add(...i)}(o),function(t,i,s,o){t.traverse((t=>{if(t.isMesh){var a=new e;Object.assign(a,t.material),a.metalness=.1,a.roughness=.6,o.colorNode&&(a.colorNode=o.colorNode()),o.positionNode&&(a.positionNode=o.positionNode({skeleton:i,posture:s})),o.normalNode&&(a.normalNode=o.normalNode({skeleton:i,posture:s})),o.emissiveNode&&(a.emissiveNode=o.emissiveNode({skeleton:i,posture:s})),t.material=a}}))}(o,a,r,n),function(t,e){var o=new i,a=(new s).setFromObject(t,!0);a.getCenter(o),t.position.sub(o),e.x=(a.max.x+a.min.x)/2,e.y=a.min.y,e.z=(a.max.z+a.min.z)/2,e.scale=Math.max(a.max.x-a.min.x,a.max.y-a.min.y,a.max.z-a.min.z)}(o,m),o}function X(t,e){var i=new XMLHttpRequest;i.onreadystatechange=function(){4==this.readyState&&200==this.status&&(document.getElementById(e).innerHTML=this.responseText.split("||")[0])},(t=t.split(".")).pop(),t.push("txt"),t=t.join("."),i.open("GET",t,!0),i.send()}class k{constructor(t,e,s){this.dims=t,this.pivot=new i(e[0],e[1],e[2]),this.mirrorPivot=new i(-e[0],e[1],e[2]),this.min=s[0],this.max=s[1]}encodeX(t){var e=Math.round(1e3*(t-this.dims.x)/this.dims.scale);return console.log(t.toFixed(4),"→",e,"→",this.decodeX(e).toFixed(4),"(",(this.decodeX(e)/t*100-100).toFixed(4)),e}decodeX(t){return this.dims.scale*t/1e3+this.dims.x}encodeY(t){var e=Math.round(1e3*(t-this.dims.y)/this.dims.scale);return console.log(t.toFixed(4),"→",e,"→",this.decodeY(e).toFixed(4),"(",(this.decodeY(e)/t*100-100).toFixed(4)),e}decodeY(t){return this.dims.scale*t/1e3+this.dims.y}encodeZ(t){var e=Math.round(1e3*(t-this.dims.z)/this.dims.scale);return console.log(t.toFixed(4),"→",e,"→",this.decodeZ(e).toFixed(4),"(",(this.decodeZ(e)/t*100-100).toFixed(4)),e}decodeZ(t){return this.dims.scale*t/1e3+this.dims.z}decode(){this.pivot.x=this.decodeX(this.pivot.x),this.pivot.y=this.decodeY(this.pivot.y),this.pivot.z=this.decodeZ(this.pivot.z),this.mirrorPivot.x=this.decodeX(this.mirrorPivot.x),this.mirrorPivot.y=this.decodeY(this.mirrorPivot.y),this.mirrorPivot.z=this.decodeZ(this.mirrorPivot.z)}}class P extends k{constructor(t,e,i){super(t,e,i),this.decode()}decode(){super.decode(),this.min=this.decodeY(this.min),this.max=this.decodeY(this.max)}fuzzy(){return h.y.smoothstep(this.min,this.max)}}class F extends P{constructor(t,e,i,s){super(t,e,i),this.slope=Math.tan((90-s)*Math.PI/180)}fuzzy(){return h.y.add(h.z.div(this.slope)).smoothstep(this.min,this.max)}}class b extends k{constructor(t,e,i){super(t,e,i),this.decode()}decode(){super.decode(),this.min=this.decodeX(this.min),this.max=this.decodeX(this.max)}fuzzy(){return h.x.smoothstep(this.min,this.max)}mirrorFuzzy(){return h.x.smoothstep(-this.min,-this.max)}}class M extends k{constructor(t,e,i,s){super(t,e,i),this.minY=s[0],this.maxY=s[1],this.decode()}decode(){super.decode(),this.min=this.decodeX(this.min),this.max=this.decodeX(this.max),this.minY=this.decodeY(this.minY),this.maxY=this.decodeY(this.maxY)}fuzzy(){var t=h.x.smoothstep(this.min,this.max),e=h.y.smoothstep(this.minY,this.maxY);return t.mul(e)}mirrorFuzzy(){var t=h.x.smoothstep(-this.min,-this.max),e=h.y.smoothstep(this.minY,this.maxY);return t.mul(e)}}class q extends k{constructor(t,e,i,s,o){super(t,e,i),this.topY=s,this.minX=o[0],this.maxX=o[1],this.decode()}decode(){super.decode(),this.min=this.decodeY(this.min),this.max=this.decodeY(this.max),this.topY=this.decodeY(this.topY),this.minX=this.decodeX(this.minX),this.maxX=this.decodeX(this.maxX)}fuzzy(){var t=h.x.toVar(),e=h.y;return e.step(this.topY).mul(t.smoothstep(this.minX,this.maxX)).mul(e.smoothstep(t.div(.7).add(this.min),t.div(7).add(this.max))).pow(2)}mirrorFuzzy(){var t=h.x,e=h.y;return e.step(this.topY).mul(t.smoothstep(-this.minX,-this.maxX)).mul(e.smoothstep(t.div(-.7).add(this.min),t.div(-7).add(this.max))).pow(2)}}var Z=o((([t,e,i,s])=>t.sub(e).mul(f(i.mul(s))).add(e))).setLayout({name:"jointRotate",type:"vec3",inputs:[{name:"pos",type:"vec3"},{name:"center",type:"vec3"},{name:"angle",type:"vec3"},{name:"amount",type:"float"}]}),V=o((([t,e,i,s])=>r(t,t.sub(e).mul(Y(i.mul(s))).mul(m(1).sub(s.mul(2*Math.PI).sub(Math.PI).cos().add(1).div(2).div(4).mul(i.z.cos().oneMinus()))).add(e),s.pow(.25)))).setLayout({name:"jointRotate2",type:"vec3",inputs:[{name:"pos",type:"vec3"},{name:"center",type:"vec3"},{name:"angle",type:"vec3"},{name:"amount",type:"float"}]});function N(t){return t.vertex=h,t.mode=m(1),j(t)}function T(t){return t.vertex=l,t.mode=m(0),p(j(t)).normalize()}var j=o((({skeleton:t,posture:e,mode:i,vertex:s})=>{var o=s.toVar(),a=t.arm.fuzzy().toVar();n(a.greaterThan(0),(()=>{o.assign(Z(o,i.mul(t.wrist.pivot),e.wristLeft,t.wrist.fuzzy())),o.assign(Z(o,i.mul(t.forearm.pivot),e.forearmLeft,t.forearm.fuzzy())),o.assign(Z(o,i.mul(t.elbow.pivot),e.elbowLeft,t.elbow.fuzzy())),o.assign(V(o,i.mul(t.arm.pivot),e.armLeft,a))}));var r=t.arm.mirrorFuzzy().toVar();n(r.greaterThan(0),(()=>{o.assign(Z(o,i.mul(t.wrist.mirrorPivot),e.wristRight,t.wrist.mirrorFuzzy())),o.assign(Z(o,i.mul(t.forearm.mirrorPivot),e.forearmRight,t.forearm.mirrorFuzzy())),o.assign(Z(o,i.mul(t.elbow.mirrorPivot),e.elbowRight,t.elbow.mirrorFuzzy())),o.assign(V(o,i.mul(t.arm.mirrorPivot),e.armRight,r))})),o.assign(Z(o,i.mul(t.head.pivot),e.head,t.head.fuzzy())),o.assign(Z(o,i.mul(t.chest.pivot),e.chest,t.chest.fuzzy())),o.assign(Z(o,i.mul(t.waist.pivot),e.waist,t.waist.fuzzy()));var m=t.hip.fuzzy().toVar();n(m.greaterThan(0),(()=>{o.assign(Z(o,i.mul(t.foot.pivot),e.footLeft,t.foot.fuzzy())),o.assign(Z(o,i.mul(t.ankle.pivot),e.ankleLeft,t.ankle.fuzzy())),o.assign(Z(o,i.mul(t.leg.pivot),e.legLeft,t.leg.fuzzy())),o.assign(Z(o,i.mul(t.knee.pivot),e.kneeLeft,t.knee.fuzzy())),o.assign(Z(o,i.mul(t.hip2.pivot),e.hip2Left,t.hip2.fuzzy())),o.assign(Z(o,i.mul(t.hip.pivot),e.hipLeft,m))}));var u=t.hip.mirrorFuzzy().toVar();return n(u.greaterThan(0),(()=>{o.assign(Z(o,i.mul(t.foot.mirrorPivot),e.footRight,t.foot.fuzzy())),o.assign(Z(o,i.mul(t.ankle.mirrorPivot),e.ankleRight,t.ankle.fuzzy())),o.assign(Z(o,i.mul(t.leg.mirrorPivot),e.legRight,t.leg.fuzzy())),o.assign(Z(o,i.mul(t.knee.mirrorPivot),e.kneeRight,t.knee.fuzzy())),o.assign(Z(o,i.mul(t.hip2.mirrorPivot),e.hip2Right,t.hip2.fuzzy())),o.assign(Z(o,i.mul(t.hip.mirrorPivot),e.hipRight,u))})),o})),I=o((({skeleton:t,posture:e})=>{var i=e.select,s=m(0).add(t.head.fuzzy().mul(u(i.equal(1),1,0))).add(t.chest.fuzzy().mul(u(i.equal(2),1,0))).add(t.waist.fuzzy().mul(u(i.equal(3),1,0))).add(t.hip.fuzzy().mul(u(i.equal(11),1,0))).add(t.leg.fuzzy().mul(u(i.equal(12),1,0))).add(t.knee.fuzzy().mul(u(i.equal(13),1,0))).add(t.ankle.fuzzy().mul(u(i.equal(14),1,0))).add(t.foot.fuzzy().mul(u(i.equal(16),1,0))).add(t.hip2.fuzzy().mul(u(i.equal(15),1,0))).add(t.arm.fuzzy().mul(u(i.equal(21),1,0))).add(t.elbow.fuzzy().mul(u(i.equal(22),1,0))).add(t.forearm.fuzzy().mul(u(i.equal(23),1,0))).add(t.wrist.fuzzy().mul(u(i.equal(24),1,0))).clamp(0,1).negate().toVar();return n(s.lessThan(-.999),(()=>{s.assign(.2)})),d(0,s.div(2),s.div(1))})),E=o((()=>{var t=h,e=m(0).add(t.x.mul(72).cos().smoothstep(.9,1)).add(t.y.mul(74).cos().smoothstep(.9,1)).add(t.z.mul(74).add(t.y.mul(4.5).add(.5).cos().mul(1).add(2.5)).abs().smoothstep(.6,0)).smoothstep(.6,1).oneMinus().pow(.1);return d(e)}));function H(){return{head:c(d(0,0,0)),chest:c(d(0,0,0)),waist:c(d(0,0,0)),kneeLeft:c(d(0,0,0)),kneeRight:c(d(0,0,0)),ankleLeft:c(d(0,0,0)),ankleRight:c(d(0,0,0)),footLeft:c(d(0,0,0)),footRight:c(d(0,0,0)),hipLeft:c(d(0,0,0)),hip2Left:c(d(0,0,0)),hipRight:c(d(0,0,0)),hip2Right:c(d(0,0,0)),legLeft:c(d(0,0,0)),legRight:c(d(0,0,0)),elbowLeft:c(d(0,0,0)),elbowRight:c(d(0,0,0)),forearmLeft:c(d(0,0,0)),forearmRight:c(d(0,0,0)),wristLeft:c(d(0,0,0)),wristRight:c(d(0,0,0)),armLeft:c(d(0,0,0)),armRight:c(d(0,0,0))}}export{q as LocusT,b as LocusX,M as LocusXY,P as LocusY,F as LocusYZ,X as credits,x as matRotXYZ,Y as matRotXZY,f as matRotYXZ,g as matRotYZX,w as matRotZXY,L as matRotZYX,R as processModel,E as tslColorNode,I as tslEmissiveNode,T as tslNormalNode,N as tslPositionNode,H as tslPosture};
