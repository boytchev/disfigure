/*! disfigure v0.0.14 */
import*as t from"three";import{Vector3 as e,Box3 as s,MeshPhysicalNodeMaterial as i,WebGPURenderer as o,PCFSoftShadowMap as r,Scene as a,Color as h,PerspectiveCamera as n,DirectionalLight as l,Mesh as g,CircleGeometry as u,MeshLambertMaterial as m,CanvasTexture as f}from"three";import{GLTFLoader as L}from"three/addons/loaders/GLTFLoader.js";import{Fn as c,mix as d,If as p,uniform as w,mat3 as x,normalGeometry as R,transformNormalToView as k,positionGeometry as M,vec3 as b,float as Y,min as X}from"three/tsl";import{SimplexNoise as v}from"three/addons/math/SimplexNoise.js";import{OrbitControls as y}from"three/addons/controls/OrbitControls.js";import Z from"three/addons/libs/stats.module.js";var z=c((([t,e,s])=>{var i=t.sub(e.pivot).mul(s).add(e.pivot);return d(t,i,e.locus())})),j=c((([t,e,s])=>{var i=t.mul(s);return d(t,i,e.locus())}));function S(t){return t.vertex=M,t.fn=z,E(t)}function N(t){return t.vertex=R,t.fn=j,k(E(t)).xyz}var E=c((({fn:t,space:e,posture:s,vertex:i})=>{var o=i.toVar(),r=e.armLeft.locus().toVar();p(r.greaterThan(0),(()=>{o.assign(t(o,e.wristLeft,s.wristLeftMatrix)),o.assign(t(o,e.forearmLeft,s.forearmLeftMatrix)),o.assign(t(o,e.elbowLeft,s.elbowLeftMatrix)),o.assign(t(o,e.armLeft,s.armLeftMatrix))}));var a=e.armRight.locus().toVar();p(a.greaterThan(0),(()=>{o.assign(t(o,e.wristRight,s.wristRightMatrix)),o.assign(t(o,e.forearmRight,s.forearmRightMatrix)),o.assign(t(o,e.elbowRight,s.elbowRightMatrix)),o.assign(t(o,e.armRight,s.armRightMatrix))})),o.assign(t(o,e.head,s.headMatrix)),o.assign(t(o,e.chest,s.chestMatrix)),o.assign(t(o,e.waist,s.waistMatrix));var h=e.legLeft.locus().toVar();p(h.greaterThan(0),(()=>{o.assign(t(o,e.footLeft,s.footLeftMatrix)),o.assign(t(o,e.ankleLeft,s.ankleLeftMatrix)),o.assign(t(o,e.ankleLongLeft,s.ankleLongLeftMatrix)),o.assign(t(o,e.kneeLeft,s.kneeLeftMatrix)),o.assign(t(o,e.legLongLeft,s.legLongLeftMatrix)),o.assign(t(o,e.legLeft,s.legLeftMatrix))}));var n=e.legRight.locus().toVar();return p(n.greaterThan(0),(()=>{o.assign(t(o,e.footRight,s.footRightMatrix)),o.assign(t(o,e.ankleRight,s.ankleRightMatrix)),o.assign(t(o,e.ankleLongRight,s.ankleLongRightMatrix)),o.assign(t(o,e.kneeRight,s.kneeRightMatrix)),o.assign(t(o,e.legLongRight,s.legLongRightMatrix)),o.assign(t(o,e.legRight,s.legRightMatrix))})),o}));const P=c((([t,e,s])=>s.smoothstep(t,e).smoothstep(0,1).smoothstep(0,1)),{edgeFrom:"float",edgeTo:"float",value:"float",return:"float"});c((()=>b(1)));var T=new v;function A(t,e=0,s=-1,i=1){return s+(i-s)*(T.noise(t,e)+1)/2}function O(t,e=0,s=-1,i=1){return s+(i-s)*(Math.sin(t+e)+1)/2}function C(t,e,s=0){return e*t/1e3+s}function I(t,s){return new e(C(t[0],s.scale,s.x),C(t[1],s.scale,s.y),C(t[2],s.scale,s.z))}function V(t){var e=Object.assign(Object.create(t),t);return e.pivot=e.pivot.clone(),e.pivot.x*=-1,e}class F{constructor(t,e,s,i=0,o){this.pivot=I(e,t),this.minY=C(s[0],t.scale,t.y),this.maxY=C(s[1],t.scale,t.y),o&&(this.minX=C(o[0],t.scale,t.x),this.maxX=C(o[1],t.scale,t.x)),this.slope=Math.tan((90-i)*Math.PI/180)}mirror(){var t=V(this);return"minX"in t&&(t.minX*=-1,t.maxX*=-1),t}locus(t=M){var e=t.x,s=t.y,i=t.z;0!=this.angle&&(s=s.add(i.sub(this.pivot.z).div(this.slope)));var o=P(this.minY,this.maxY,s);return"minX"in this&&(o=o.max(P(this.minX,this.maxX,e.abs().add(s.sub(this.pivot.y))))),o}}class H{constructor(t,e,s,i=0){this.pivot=I(e,t),this.minX=C(s[0],t.scale,t.x),this.maxX=C(s[1],t.scale,t.x),this.slope=Math.tan((90-i)*Math.PI/180)}mirror(){var t=V(this);return t.minX*=-1,t.maxX*=-1,t}locus(t=M){var e=t.x,s=t.z,i=Y(this.minX),o=Y(this.maxX);if(0!=this.angle){var r=s.sub(this.pivot.z).div(this.slope).max(.01).mul(e.sign());i=i.sub(r),o=o.add(r)}return P(i,o,e)}}class W extends H{constructor(t,e,s,i){super(t,e,s),this.minY=C(i[0],t.scale,t.y),this.maxY=C(i[1],t.scale,t.y)}locus(t=M){var e=t.x,s=t.y,i=t.y.sub(this.pivot.y).div(4,e.sign()),o=.8;return Y(1).mul(P(Y(this.minX).sub(i),Y(this.maxX).sub(i),e)).mul(X(P(this.minY,this.minY*o+(1-o)*this.maxY,s),P(this.maxY,this.maxY*o+(1-o)*this.minY,s))).pow(2)}}class _ extends W{constructor(t,e,s,i,o=0){super(t,e,s,i),this.grown=o}locus(t=M){var e=t.x,s=t.z;if(0==this.grown)var i=t.y.sub(e.abs().mul(.2)).add(s.mul(1/6)),o=b(t.x.mul(2),t.y,t.z.min(0)).sub(b(0,this.pivot.y,0)).length().smoothstep(0,.13).pow(10);else i=t.y.sub(e.abs().mul(.2)).add(s.abs().mul(.5)),o=b(t.x.mul(2),t.y,t.z.min(0)).sub(b(0,this.pivot.y,0)).length().smoothstep(0,.065).pow(10);return Y(o).mul(e.smoothstep(this.minX,this.maxX),P(this.minY,this.maxY,i).pow(2))}}class G{constructor(t,e){const s={LocusT:_,LocusX:H,LocusXY:W,LocusY:F};var i={};for(var o in e)if("_"!=o){var r=s[e[o][0]];i[o]=new r(t,...e[o].slice(1))}this._=e._,this.head=i.head,this.chest=i.chest,this.waist=i.waist,this.kneeLeft=i?.kneeLeft??i.knee,this.kneeRight=i?.kneeRight??i.knee.mirror(),this.ankleLeft=i?.ankleLeft??i.ankle,this.ankleRight=i?.ankleRight??i.ankle.mirror(),this.ankleLongLeft=i?.ankleLongLeft??i.ankleLong,this.ankleLongRight=i?.ankleLongRight??i.ankleLong.mirror(),this.legLongLeft=i?.legLongLeft??i.legLong,this.legLongRight=i?.legLongRight??i.legLong.mirror(),this.footLeft=i?.footLeft??i.foot,this.footRight=i?.footRight??i.foot.mirror(),this.legLeft=i?.legLeft??i.leg,this.legRight=i?.legRight??i.leg.mirror(),this.elbowLeft=i?.elbowLeft??i.elbow,this.elbowRight=i?.elbowRight??i.elbow.mirror(),this.forearmLeft=i?.forearmLeft??i.forearm,this.forearmRight=i?.forearmRight??i.forearm.mirror(),this.wristLeft=i?.wristLeft??i.wrist,this.wristRight=i?.wristRight??i.wrist.mirror(),this.armLeft=i?.armLeft??i.arm,this.armRight=i?.armRight??i.arm.mirror()}}var U,q,B,D,J,K,Q,$,tt=[];class et{constructor(t){if((U=new o({antialias:!0})).setSize(innerWidth,innerHeight),U.shadowMap.enabled=t?.shadows??!0,U.shadowMap.type=r,document.body.appendChild(U.domElement),document.body.style.overflow="hidden",document.body.style.margin="0",(q=new a).background=new h("whitesmoke"),(B=new n(30,innerWidth/innerHeight)).position.set(0,1,4),B.lookAt(0,1,0),t?.stats&&($=new Z,document.body.appendChild($.dom)),(t?.lights??1)&&((D=new l("white",1.5)).decay=0,D.position.set(0,14,7),(t?.shadows??1)&&(D.shadow.mapSize.width=2048,D.shadow.mapSize.height=D.shadow.mapSize.width,D.shadow.camera.near=1,D.shadow.camera.far=50,D.shadow.camera.left=-5,D.shadow.camera.right=5,D.shadow.camera.top=5,D.shadow.camera.bottom=-5,D.shadow.normalBias=.01,D.autoUpdate=!1,D.castShadow=!0),q.add(D),(J=new l("white",1.5)).decay=0,J.target=q,B.add(J),q.add(B)),(t?.controls??1)&&((K=new y(B,U.domElement)).enableDamping=!0,K.target.set(0,.8,0)),t?.ground??1){var e=document.createElement("CANVAS");e.width=128,e.height=128;var s=e.getContext("2d");s.fillStyle="white",s.filter="blur(10px)",s.beginPath(),s.arc(64,64,37.5,0,2*Math.PI),s.fill();var i=new g(new u(50),new m({color:"antiquewhite",transparent:!0,map:new f(e)}));i.receiveShadow=!0,i.rotation.x=-Math.PI/2,i.renderOrder=-1,q.add(i)}window.addEventListener("resize",(()=>{B.aspect=innerWidth/innerHeight,B.updateProjectionMatrix(),U.setSize(innerWidth,innerHeight)})),U.setAnimationLoop(ot)}}class st extends Event{#t;constructor(){super("animate")}get target(){return this.#t}set target(t){this.#t=t}}var it=new st("animate");function ot(t){it.time=t,window.dispatchEvent(it),tt.forEach((t=>{t.update(),t.dispatchEvent(it)})),Q&&Q(t),K&&K.update(),$&&$.update(),U.render(q,B)}function rt(t){Q=t}var at="man.glb",ht={head:["LocusY",[0,878,-37],[838,923],30],chest:["LocusY",[0,661,-8],[438,929],0,[40,300]],waist:["LocusY",[0,570,-9],[310,840]],leg:["LocusT",[41,546,-19],[-2,2],[690,441]],legLong:["LocusY",[39,0,-19],[700,140]],knee:["LocusY",[50,286,-23],[341,218],20],ankle:["LocusY",[41,51,-1],[97,10],-10],ankleLong:["LocusY",[51,206,-29],[430,-10]],foot:["LocusY",[0,20,12],[111,-185],120],elbow:["LocusX",[238,815,-40],[230,260],0],forearm:["LocusX",[170,815,-38],[46,490]],wrist:["LocusX",[375,820,-40],[354,402]],arm:["LocusXY",[85,790,-40],[30,150],[600,900]]},nt="woman.glb",lt={head:["LocusY",[0,872,-30],[827,919],30],chest:["LocusY",[0,661,-8],[438,929],0,[40,300]],waist:["LocusY",[0,570,-9],[350,840]],leg:["LocusT",[41,546,-19],[-2,2],[690,441]],legLong:["LocusY",[44,0,-19],[700,140]],knee:["LocusY",[50,286,-23],[341,218],20],ankle:["LocusY",[44,51,-4],[97,10],-10],ankleLong:["LocusY",[51,201,-29],[430,-33]],foot:["LocusY",[0,20,12],[111,-185],120],elbow:["LocusX",[238,815,-40],[230,260],0],forearm:["LocusX",[170,815,-38],[54,475]],wrist:["LocusX",[359,815,-34],[343,380]],arm:["LocusXY",[80,793,-40],[30,137],[600,900]]},gt="child.glb",ut={head:["LocusY",[0,850,-32],[807,894],30],chest:["LocusY",[0,640,1],[419,914],0,[40,300]],waist:["LocusY",[0,530,-7],[285,836]],leg:["LocusT",[40,521,-9],[-1,1],[625,430],1],legLong:["LocusY",[46,0,-5],[700,140]],knee:["LocusY",[50,288,-12],[346,221],20],ankle:["LocusY",[54,48,-14],[81,33],-10],ankleLong:["LocusY",[51,201,-25],[430,-33]],foot:["LocusY",[0,20,6],[83,-200],120],elbow:["LocusX",[249,793,-56],[230,273],0],forearm:["LocusX",[170,794,-59],[54,475]],wrist:["LocusX",[398,802,-57],[384,409]],arm:["LocusXY",[80,793,-40],[30,137],[600,900]]};const mt="/assets/models/";console.time("Preload");var ft=new L,[Lt,ct,dt]=await Promise.all([ft.loadAsync(mt+at),ft.loadAsync(mt+nt),ft.loadAsync(mt+gt)]);function pt(t){return t*(2*Math.PI/360)}function wt(t){return t/(2*Math.PI/360)}console.timeEnd("Preload");class xt{constructor(t,e,s,i,o,r="x",a="y",h="z"){this.model=t,this.pivot=e.pivot,this.jointX=s,this.jointY=i??s,this.jointZ=o??s,this.nameX=r,this.nameY=a,this.nameZ=h}get bend(){return wt(this.jointX[this.nameX])}set bend(t){this.jointX[this.nameX]=pt(t)}get raise(){return wt(this.jointX[this.nameX])}set raise(t){this.jointX[this.nameX]=pt(t)}get turn(){return wt(this.jointY[this.nameY])}set turn(t){this.jointY[this.nameY]=pt(t)}get tilt(){return wt(this.jointZ[this.nameZ])}set tilt(t){this.jointZ[this.nameZ]=pt(t)}get straddle(){return wt(this.jointZ[this.nameZ])}set straddle(t){this.jointZ[this.nameZ]=pt(t)}get foreward(){return wt(this.jointX[this.nameX])}set foreward(t){this.jointX[this.nameX]=pt(t)}attach(t){t.matrixAutoUpdate=!1,this.model.add(t)}}var Rt=new t.Matrix4,kt=new t.Euler,Mt=1;class bt extends t.Group{constructor(o,r,a){super(),this.uid=Mt,Mt+=.3+2*Math.random(),this.castShadow=!0,this.receiveShadow=!0,this.dims={},this.space={};var h=new t.Mesh(o.scene.children[0].geometry);!function(t,i){var o=new e,r=(new s).setFromObject(t,!0);r.getCenter(o),t.position.sub(o),i.x=(r.max.x+r.min.x)/2,i.y=r.min.y,i.z=(r.max.z+r.min.z)/2,i.scale=Math.max(r.max.x-r.min.x,r.max.y-r.min.y,r.max.z-r.min.z),i.height=r.max.y-r.min.y}(h,this.dims),this.space=new G(this.dims,r),this.posture={head:new e,chest:new e,waist:new e,headMatrix:w(x()),chestMatrix:w(x()),waistMatrix:w(x()),kneeLeft:new e,kneeRight:new e,ankleLeft:new e,ankleRight:new e,footLeft:new e,footRight:new e,legLeft:new e,legLongLeft:new e,legRight:new e,legLongRight:new e,ankleLongLeft:new e,ankleLongRight:new e,kneeLeftMatrix:w(x()),kneeRightMatrix:w(x()),ankleLeftMatrix:w(x()),ankleRightMatrix:w(x()),footLeftMatrix:w(x()),footRightMatrix:w(x()),legLeftMatrix:w(x()),legLongLeftMatrix:w(x()),legRightMatrix:w(x()),legLongRightMatrix:w(x()),ankleLongLeftMatrix:w(x()),ankleLongRightMatrix:w(x()),elbowLeft:new e,elbowRight:new e,forearmLeft:new e,forearmRight:new e,wristLeft:new e,wristRight:new e,armLeft:new e,armRight:new e,armLeftMatrix:w(x()),armRightMatrix:w(x()),elbowLeftMatrix:w(x()),elbowRightMatrix:w(x()),forearmLeftMatrix:w(x()),forearmRightMatrix:w(x()),wristLeftMatrix:w(x()),wristRightMatrix:w(x())},this.head=new xt(this,this.space.head,this.posture.head),this.chest=new xt(this,this.space.chest,this.posture.chest),this.waist=new xt(this,this.space.waist,this.posture.waist),this.legLeft=new xt(this,this.space.legLeft,this.posture.legLeft,this.posture.legLongLeft),this.kneeLeft=new xt(this,this.space.kneeLeft,this.posture.kneeLeft),this.ankleLeft=new xt(this,this.space.ankleLeft,this.posture.ankleLeft,this.posture.ankleLongLeft),this.footLeft=new xt(this,this.space.footLeft,this.posture.footLeft),this.legRight=new xt(this,this.space.legRight,this.posture.legRight,this.posture.legLongRight),this.kneeRight=new xt(this,this.space.kneeRight,this.posture.kneeRight),this.ankleRight=new xt(this,this.space.ankleRight,this.posture.ankleRight,this.posture.ankleLongRight),this.footRight=new xt(this,this.space.footRight,this.posture.footRight),this.armLeft=new xt(this,this.space.armLeft,this.posture.armLeft,this.posture.armLeft,this.posture.armLeft,"y","x","z"),this.elbowLeft=new xt(this,this.space.elbowLeft,this.posture.elbowLeft,null,null,"y"),this.wristLeft=new xt(this,this.space.wristLeft,this.posture.wristLeft,this.posture.forearmLeft,this.posture.wristLeft,"z","x","y"),this.armRight=new xt(this,this.space.armRight,this.posture.armRight,this.posture.armRight,this.posture.armRight,"y","x","z"),this.elbowRight=new xt(this,this.space.elbowRight,this.posture.elbowRight,null,null,"y"),this.wristRight=new xt(this,this.space.wristRight,this.posture.wristRight,this.posture.forearmRight,this.posture.wristRight,"z","x","y"),function(t,e,s,o,r){t.traverse((t=>{if(t.isMesh){var a=new i;Object.assign(a,t.material),Object.assign(a,r),o.colorNode&&(a.colorNode=o.colorNode()),o.positionNode&&(a.positionNode=o.positionNode({space:e,posture:s})),o.normalNode&&(a.normalNode=o.normalNode({space:e,posture:s})),t.material=a,t.castShadow=!0,t.receiveShadow=!0}}))}(h,this.space,this.posture,{positionNode:S,normalNode:N,colorNode:c((()=>b(254/255,209/255,185/255).pow(2.2)))},{metalness:0,roughness:.6}),h.position.y=-this.dims.y/2,a&&h.scale.setScalar(a/this.dims.height),h.castShadow=!0,h.receiveShadow=!0,this.model=h,this.add(h),tt.push(this),q&&q.add(this)}update(){function t(t,e,s,i,o,r){kt.set(s*e.x,i*e.y,o*e.z,r),Rt.makeRotationFromEuler(kt);var a=Rt.elements;t.value.set(a[0],a[4],a[8],a[1],a[5],a[9],a[2],a[6],a[10])}t(this.posture.headMatrix,this.posture.head,-1,-1,1,"YZX"),t(this.posture.chestMatrix,this.posture.chest,-1,-1,1,"YZX"),t(this.posture.waistMatrix,this.posture.waist,-1,1,1,"YZX"),t(this.posture.elbowLeftMatrix,this.posture.elbowLeft,0,1,0,"YZX"),t(this.posture.elbowRightMatrix,this.posture.elbowRight,0,-1,0,"YZX"),t(this.posture.wristLeftMatrix,this.posture.wristLeft,0,1,1,"YZX"),t(this.posture.wristRightMatrix,this.posture.wristRight,0,-1,-1,"YZX"),t(this.posture.forearmLeftMatrix,this.posture.forearmLeft,-1,0,0,"YZX"),t(this.posture.forearmRightMatrix,this.posture.forearmRight,-1,0,0,"YZX"),t(this.posture.armLeftMatrix,this.posture.armLeft,-1,1,1,"XZY"),t(this.posture.armRightMatrix,this.posture.armRight,-1,-1,-1,"XZY"),t(this.posture.kneeLeftMatrix,this.posture.kneeLeft,-1,0,0,"YZX"),t(this.posture.kneeRightMatrix,this.posture.kneeRight,-1,0,0,"YZX"),t(this.posture.ankleLeftMatrix,this.posture.ankleLeft,-1,0,-1,"YZX"),t(this.posture.ankleRightMatrix,this.posture.ankleRight,-1,0,1,"YZX"),t(this.posture.ankleLongLeftMatrix,this.posture.ankleLongLeft,0,-1,0,"YZX"),t(this.posture.ankleLongRightMatrix,this.posture.ankleLongRight,0,1,0,"YZX"),t(this.posture.footLeftMatrix,this.posture.footLeft,-1,0,0,"YZX"),t(this.posture.footRightMatrix,this.posture.footRight,-1,0,0,"YZX"),t(this.posture.legLongLeftMatrix,this.posture.legLongLeft,0,-1,0,"YZX"),t(this.posture.legLongRightMatrix,this.posture.legLongRight,0,1,0,"YZX"),t(this.posture.legLeftMatrix,this.posture.legLeft,1,0,-1,"YZX"),t(this.posture.legRightMatrix,this.posture.legRight,1,0,1,"YZX")}}class Yt extends bt{constructor(t){super(Lt,ht,t),this.url=mt+at,this.legLeft.straddle=5,this.legRight.straddle=5,this.ankleLeft.tilt=-5,this.ankleRight.tilt=-5,this.ankleLeft.bend=3,this.ankleRight.bend=3,this.position.y=-.005,this.armLeft.straddle=65,this.armRight.straddle=65,this.elbowLeft.bend=20,this.elbowRight.bend=20}}class Xt extends bt{constructor(t){super(ct,lt,t),this.url=mt+nt,this.legLeft.straddle=-2.9,this.legRight.straddle=-2.9,this.ankleLeft.tilt=2.9,this.ankleRight.tilt=2.9,this.ankleLeft.bend=3,this.ankleRight.bend=3,this.position.y=-.005,this.armLeft.straddle=65,this.armRight.straddle=65,this.elbowLeft.bend=20,this.elbowRight.bend=20}}class vt extends bt{constructor(t){super(dt,ut,t),this.url=mt+gt,this.ankleLeft.bend=3,this.ankleRight.bend=3,this.position.y=-.005,this.armLeft.straddle=65,this.armRight.straddle=65,this.elbowLeft.bend=20,this.elbowRight.bend=20}}export{vt as Child,Yt as Man,Xt as Woman,et as World,B as camera,J as cameraLight,A as chaotic,K as controls,tt as everybody,D as light,O as regular,U as renderer,q as scene,rt as setAnimationLoop};
