/*! disfigure v0.0.17 */
import{Vector3 as s,Box3 as t,WebGPURenderer as e,PCFSoftShadowMap as i,Scene as a,Color as r,PerspectiveCamera as o,DirectionalLight as n,Mesh as h,CircleGeometry as l,MeshLambertMaterial as c,CanvasTexture as d,Matrix3 as m,Matrix4 as u,Euler as p,Group as w,MeshPhysicalNodeMaterial as _}from"three";import{GLTFLoader as g}from"three/addons/loaders/GLTFLoader.js";import{Fn as b,mix as v,If as x,normalGeometry as k,transformNormalToView as L,positionGeometry as f,float as y,min as Y,vec3 as X,uniform as z,mat3 as S}from"three/tsl";import{SimplexNoise as P}from"three/addons/math/SimplexNoise.js";import{OrbitControls as A}from"three/addons/controls/OrbitControls.js";import E from"three/addons/libs/stats.module.js";var M=b((([s,t])=>{var e=s.sub(t.pivot).mul(t.matrix).add(t.pivot);return v(s,e,t.locus())})),j=b((([s,t])=>{var e=s.mul(t.matrix);return v(s,e,t.locus())}));function C(s){return s.vertex=k,s.fn=j,L(R(s))}var R=b((({fn:s,space:t,vertex:e})=>{var i=e.toVar();return x(t.l_arm.locus(),(()=>{i.assign(s(i,t.l_wrist)),i.assign(s(i,t.l_wrist2)),i.assign(s(i,t.l_elbow)),i.assign(s(i,t.l_arm))})),x(t.r_arm.locus(),(()=>{i.assign(s(i,t.r_wrist)),i.assign(s(i,t.r_wrist2)),i.assign(s(i,t.r_elbow)),i.assign(s(i,t.r_arm))})),x(t.l_leg.locus(),(()=>{i.assign(s(i,t.l_foot)),i.assign(s(i,t.l_ankle)),i.assign(s(i,t.l_ankle2)),i.assign(s(i,t.l_knee)),i.assign(s(i,t.l_leg2)),i.assign(s(i,t.l_leg))})),x(t.r_leg.locus(),(()=>{i.assign(s(i,t.r_foot)),i.assign(s(i,t.r_ankle)),i.assign(s(i,t.r_ankle2)),i.assign(s(i,t.r_knee)),i.assign(s(i,t.r_leg2)),i.assign(s(i,t.r_leg))})),i.assign(s(i,t.head)),i.assign(s(i,t.chest)),i.assign(s(i,t.waist)),i.assign(s(i,t.torso)),i}));const U=b((([s,t,e])=>e.smoothstep(s,t).smoothstep(0,1).smoothstep(0,1)),{edgeFrom:"float",edgeTo:"float",value:"float",return:"float"});var I=new P;function O(s,t=0,e=-1,i=1){return e+(i-e)*(I.noise(s,t)+1)/2}function T(s,t=0,e=-1,i=1){return e+(i-e)*(Math.sin(s+t)+1)/2}function F(t){var e=Object.assign(Object.create(t),t);return e.pivot=e.pivot.clone(),e.pivot.x*=-1,e.angle=new s,e.matrix=z(S()),e}class N{constructor(t){this.pivot=new s(...t),this.angle=new s,this.matrix=z(S())}}class H extends N{constructor(s,t,e=0,i){super(s),this.minY=t[0],this.maxY=t[1],i&&(this.minX=i[0],this.maxX=i[1]),this.slope=Math.tan((90-e)*Math.PI/180)}mirror(){var s=F(this);return"minX"in s&&(s.minX*=-1,s.maxX*=-1),s}locus(s=f){var t=s.x,e=s.y,i=s.z;0!=this.angle&&(e=e.add(i.sub(this.pivot.z).div(this.slope)));var a=U(this.minY,this.maxY,e);return"minX"in this&&(a=a.max(U(this.minX,this.maxX,t.abs().add(e.sub(this.pivot.y))))),a}}class W extends N{constructor(s,t){super(s),this.minX=t[0],this.maxX=t[1]}mirror(){var s=F(this);return s.minX*=-1,s.maxX*=-1,s}locus(s=f){var t=s.x;return U(this.minX,this.maxX,t)}}class D extends W{constructor(s,t,e){super(s,t),this.minY=e[0],this.maxY=e[1]}locus(s=f){var t=s.x,e=s.y,i=s.y.sub(this.pivot.y).div(4,t.sign()),a=.8;return y(1).mul(U(y(this.minX).sub(i),y(this.maxX).sub(i),t)).mul(Y(U(this.minY,this.minY*a+(1-a)*this.maxY,e),U(this.maxY,this.maxY*a+(1-a)*this.minY,e))).pow(2)}}class V extends D{constructor(s,t,e,i=0){super(s,t,e),this.grown=i}locus(s=f){var t=s.x,e=s.z;if(0==this.grown)var i=s.y.sub(t.abs().mul(.2)).add(e.mul(1/6)),a=X(s.x.mul(2),s.y,s.z.min(0)).sub(X(0,this.pivot.y,0)).length().smoothstep(0,.13).pow(10);else i=s.y.sub(t.abs().mul(.2)).add(e.abs().mul(.5)),a=X(s.x.mul(2),s.y,s.z.min(0)).sub(X(0,this.pivot.y,0)).length().smoothstep(0,.065).pow(10);return y(a).mul(t.smoothstep(this.minX,this.maxX),U(this.minY,this.maxY,i).pow(2))}}class q{constructor(s){const t={LocusT:V,LocusX:W,LocusXY:D,LocusY:H};var e={};for(var i in s){var a=t[s[i][0]];e[i]=new a(...s[i].slice(1))}this.head=e.head,this.chest=e.chest,this.waist=e.waist,this.torso=e.torso,this.l_knee=e.knee,this.r_knee=e.knee.mirror(),this.l_ankle=e.ankle,this.r_ankle=e.ankle.mirror(),this.l_ankle2=e.ankle2,this.r_ankle2=e.ankle2.mirror(),this.l_leg2=e.leg2,this.r_leg2=e.leg2.mirror(),this.l_foot=e.foot,this.r_foot=e.foot.mirror(),this.l_leg=e.leg,this.r_leg=e.leg.mirror(),this.l_elbow=e.elbow,this.r_elbow=e.elbow.mirror(),this.l_wrist2=e.wrist2,this.r_wrist2=e.wrist2.mirror(),this.l_wrist=e.wrist,this.r_wrist=e.wrist.mirror(),this.l_arm=e.arm,this.r_arm=e.arm.mirror()}}var B,G,Z,J,K,Q,$,ss,ts=[];class es{constructor(s){if((B=new e({antialias:!0})).setSize(innerWidth,innerHeight),B.shadowMap.enabled=s?.shadows??!0,B.shadowMap.type=i,document.body.appendChild(B.domElement),document.body.style.overflow="hidden",document.body.style.margin="0",(G=new a).background=new r("whitesmoke"),(Z=new o(30,innerWidth/innerHeight)).position.set(0,1,4),Z.lookAt(0,1,0),s?.stats&&(ss=new E,document.body.appendChild(ss.dom)),(s?.lights??1)&&((J=new n("white",1.5)).decay=0,J.position.set(0,14,7),(s?.shadows??1)&&(J.shadow.mapSize.width=2048,J.shadow.mapSize.height=J.shadow.mapSize.width,J.shadow.camera.near=1,J.shadow.camera.far=50,J.shadow.camera.left=-5,J.shadow.camera.right=5,J.shadow.camera.top=5,J.shadow.camera.bottom=-5,J.shadow.normalBias=.01,J.autoUpdate=!1,J.castShadow=!0),G.add(J),(K=new n("white",1.5)).decay=0,K.target=G,Z.add(K),G.add(Z)),(s?.controls??1)&&((Q=new A(Z,B.domElement)).enableDamping=!0,Q.target.set(0,.8,0)),s?.ground??1){var t=document.createElement("CANVAS");t.width=128,t.height=128;var m=t.getContext("2d");m.fillStyle="white",m.filter="blur(10px)",m.beginPath(),m.arc(64,64,38,0,2*Math.PI),m.fill();var u=new h(new l(50),new c({color:"antiquewhite",transparent:!0,map:new d(t)}));u.receiveShadow=!0,u.rotation.x=-Math.PI/2,u.renderOrder=-1,G.add(u)}window.addEventListener("resize",(()=>{Z.aspect=innerWidth/innerHeight,Z.updateProjectionMatrix(),B.setSize(innerWidth,innerHeight)})),B.setAnimationLoop(rs)}}class is extends Event{#s;constructor(){super("animate")}get target(){return this.#s}set target(s){this.#s=s}}var as=new is("animate");function rs(s){as.time=s,window.dispatchEvent(as),ts.forEach((s=>{s.update(),s.dispatchEvent(as)})),$&&$(s),Q&&Q.update(),ss&&ss.update(),B.render(G,Z)}function os(s){$=s}const ns=import.meta.url.replace("/src/body.js","/assets/models/");var hs=new m,ls=new m,cs=new s;function ds(s,t,e,i="angle"){Object.defineProperty(s,t,{get:()=>s[i][e]/(2*Math.PI/360),set(t){s[i][e]=t*(2*Math.PI/360)}})}class ms extends w{constructor(s,t,e,i=e,a="xyz"){super(),this.model=s,this.parent=t,this.pivot=e.pivot,this.angle=e.angle,this.matrix=e.matrix,this.angleAux=i.angle,this.nameY=a[1],this.position.copy(e.pivot),ds(this,"bend",a[0]),ds(this,"raise",a[0]),ds(this,"tilt",a[2]),ds(this,"straddle",a[2]),ds(this,"foreward",a[0]),ds(this,"turn",a[1],"angleAux")}attach(s){s.parent&&(s=s.clone());var t=new w,e=new w;t.add(e),e.add(s),e.rotation.z=this.isRight?Math.PI:0,s.position.y*=this.isRight?-1:1,t.matrixAutoUpdate=!1,t.joint=this,this.model.children[0].add(t),this.model.accessories.push(t)}}var us=new u,ps=new p,ws=1;class _s extends w{constructor(e,i,a){super(),this.uid=ws,ws+=.3+2*Math.random(),this.castShadow=!0,this.receiveShadow=!0,this.accessories=[],this.space={};var r,o=new h(e.scene.children[0].geometry),n=function(e){var i=new s,a=(new t).setFromObject(e,!0);return a.getCenter(i),e.position.sub(i),a.max.y-a.min.y}(o);this.space=new q(i),this.torso=new ms(this,null,this.space.torso),this.waist=new ms(this,this.torso,this.space.waist),this.chest=new ms(this,this.waist,this.space.chest),this.head=new ms(this,this.chest,this.space.head),this.l_leg=new ms(this,this.waist,this.space.l_leg,this.space.l_leg2),this.l_knee=new ms(this,this.l_leg,this.space.l_knee),this.l_ankle=new ms(this,this.l_knee,this.space.l_ankle,this.space.l_ankle2),this.l_foot=new ms(this,this.l_ankle,this.space.l_foot),this.r_leg=new ms(this,this.waist,this.space.r_leg,this.space.r_leg2),this.r_knee=new ms(this,this.r_leg,this.space.r_knee),this.r_ankle=new ms(this,this.r_knee,this.space.r_ankle,this.space.r_ankle2),this.r_foot=new ms(this,this.r_ankle,this.space.r_foot),this.l_arm=new ms(this,this.chest,this.space.l_arm,this.space.l_arm,"yxz"),this.l_elbow=new ms(this,this.l_arm,this.space.l_elbow,this.space.l_elbow,"yxz"),this.l_wrist=new ms(this,this.l_elbow,this.space.l_wrist,this.space.l_wrist2,"zxy"),this.r_arm=new ms(this,this.chest,this.space.r_arm,this.space.r_arm,"yxz"),this.r_elbow=new ms(this,this.r_arm,this.space.r_elbow,this.space.r_elbow,"yxz"),this.r_wrist=new ms(this,this.r_elbow,this.space.r_wrist,this.space.r_wrist2,"zxy"),o.material=new _({positionNode:(r={space:this.space},r.vertex=f,r.fn=M,R(r)),normalNode:C({space:this.space}),colorNode:X(254/255,209/255,185/255).pow(2.2),metalness:0,roughness:.6}),this.height=a??n,o.scale.setScalar(this.height/n),o.castShadow=!0,o.receiveShadow=!0,this.model=o,this.add(o),ts.push(this),G&&G.add(this),this.l_arm.straddle=this.r_arm.straddle=65,this.l_elbow.bend=this.r_elbow.bend=20}update(){function s(s,t,e,i){ps.set(t*s.angle.x,e*s.angle.y,i*s.angle.z,"YZX"),us.makeRotationFromEuler(ps);var a=us.elements;s.matrix.value.set(a[0],a[4],a[8],a[1],a[5],a[9],a[2],a[6],a[10])}for(var t of(s(this.space.head,-1,-1,1),s(this.space.chest,-1,-1,1),s(this.space.waist,-1,1,1),s(this.space.torso,-1,-1,1),s(this.space.l_elbow,0,1,0),s(this.space.r_elbow,0,-1,0),s(this.space.l_wrist,0,1,1),s(this.space.r_wrist,0,-1,-1),s(this.space.l_wrist2,-1,0,0),s(this.space.r_wrist2,-1,0,0),s(this.space.l_arm,-1,1,1),s(this.space.r_arm,-1,-1,-1),s(this.space.l_knee,-1,0,0),s(this.space.r_knee,-1,0,0),s(this.space.l_ankle,-1,0,-1),s(this.space.r_ankle,-1,0,1),s(this.space.l_ankle2,0,-1,0),s(this.space.r_ankle2,0,1,0),s(this.space.l_foot,-1,0,0),s(this.space.r_foot,-1,0,0),s(this.space.l_leg2,0,-1,0),s(this.space.r_leg2,0,1,0),s(this.space.l_leg,1,0,-1),s(this.space.r_leg,1,0,1),this.accessories)){var e=t.joint;for(ls.identity(),cs.copy(e.pivot);e;e=e.parent)hs.copy(e.matrix.value).transpose(),ls.premultiply(hs),cs.sub(e.pivot).applyMatrix3(hs).add(e.pivot);t.matrix.setFromMatrix3(ls),t.matrix.setPosition(cs)}}}class gs extends _s{static URL="man.glb";static SPACE={head:["LocusY",[0,1.566,-.066],[1.495,1.647],30],chest:["LocusY",[0,1.177,-.014],[.777,1.658],0,[.072,.538]],waist:["LocusY",[0,1.014,-.016],[.547,1.498]],torso:["LocusY",[0,1.014,-.016],[-3,-2]],leg:["LocusT",[.074,.97,-.034],[-.004,.004],[1.229,.782]],leg2:["LocusY",[.07,-.009,-.034],[1.247,.242]],knee:["LocusY",[.09,.504,-.041],[.603,.382],20],ankle:["LocusY",[.074,.082,-.002],[.165,.008],-10],ankle2:["LocusY",[.092,.36,-.052],[.762,-.027]],foot:["LocusY",[0,.026,.022],[.19,-.342],120],elbow:["LocusX",[.427,1.453,-.072],[.413,.467]],wrist2:["LocusX",[.305,1.453,-.068],[.083,.879]],wrist:["LocusX",[.673,1.462,-.072],[.635,.722]],arm:["LocusXY",[.153,1.408,-.072],[.054,.269],[1.067,1.606]]};constructor(s){super(ks,gs.SPACE,s),this.url=ns+gs.URL,this.position.y=this.height/2-.015,this.l_leg.straddle=this.r_leg.straddle=5,this.l_ankle.tilt=this.r_ankle.tilt=-5,this.l_ankle.bend=this.r_ankle.bend=3}}class bs extends _s{static URL="woman.glb";static SPACE={head:["LocusY",[.001,1.471,-.049],[1.395,1.551],30],chest:["LocusY",[.001,1.114,-.012],[.737,1.568],0,[.069,.509]],waist:["LocusY",[.001,.961,-.014],[.589,1.417]],torso:["LocusY",[.001,.961,-.014],[-1.696,-1.694]],leg:["LocusT",[.071,.92,-.031],[-.002,.005],[1.163,.742]],leg2:["LocusY",[.076,-.003,-.031],[1.18,.233]],knee:["LocusY",[.086,.48,-.037],[.573,.365],20],ankle:["LocusY",[.076,.083,-.005],[.161,.014],-10],ankle2:["LocusY",[.088,.337,-.047],[.724,-.059]],foot:["LocusY",[.001,.031,.022],[.184,-.316],120],elbow:["LocusX",[.404,1.375,-.066],[.39,.441]],wrist2:["LocusX",[.289,1.375,-.063],[.093,.805]],wrist:["LocusX",[.608,1.375,-.056],[.581,.644]],arm:["LocusXY",[.137,1.338,-.066],[.052,.233],[1.011,1.519]]};constructor(s){super(Ls,bs.SPACE,s),this.url=ns+bs.URL,this.position.y=this.height/2-.005,this.l_leg.straddle=this.r_leg.straddle=-2.9,this.l_ankle.tilt=this.r_ankle.tilt=2.9,this.l_ankle.bend=this.r_ankle.bend=3}}class vs extends _s{static URL="child.glb";static SPACE={head:["LocusY",[0,1.149,-.058],[1.091,1.209],30],chest:["LocusY",[0,.865,-.013],[.566,1.236],0,[.054,.406]],waist:["LocusY",[0,.717,-.024],[.385,1.13]],torso:["LocusY",[0,.717,-.024],[-1.354,-1.353]],leg:["LocusT",[.054,.704,-.027],[-.001,.001],[.845,.581],1],leg2:["LocusY",[.062,-0,-.021],[.946,.189]],knee:["LocusY",[.068,.389,-.031],[.468,.299],20],ankle:["LocusY",[.073,.065,-.033],[.109,.044],-10],ankle2:["LocusY",[.069,.272,-.048],[.581,-.045]],foot:["LocusY",[0,.027,-.006],[.112,-.271],120],elbow:["LocusX",[.337,1.072,-.09],[.311,.369]],wrist2:["LocusX",[.23,1.074,-.094],[.073,.642]],wrist:["LocusX",[.538,1.084,-.091],[.519,.553]],arm:["LocusXY",[.108,1.072,-.068],[.041,.185],[.811,1.217]]};constructor(s){super(fs,vs.SPACE,s),this.url=ns+vs.URL,this.position.y=this.height/2-.005,this.l_ankle.bend=this.r_ankle.bend=3}}var xs=new g,[ks,Ls,fs]=await Promise.all([xs.loadAsync(ns+gs.URL),xs.loadAsync(ns+bs.URL),xs.loadAsync(ns+vs.URL)]);console.log("\n%c⋮⋮⋮ Disfigure\n%chttps://boytchev.github.io/disfigure/\n","color: navy","font-size:60%");export{vs as Child,gs as Man,bs as Woman,es as World,Z as camera,K as cameraLight,O as chaotic,Q as controls,ts as everybody,J as light,T as regular,B as renderer,G as scene,os as setAnimationLoop};
