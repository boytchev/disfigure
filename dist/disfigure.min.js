/*! disfigure v0.0.17 */
import{Vector3 as s,Box3 as t,WebGPURenderer as e,PCFSoftShadowMap as i,Scene as a,Color as r,PerspectiveCamera as n,DirectionalLight as h,Mesh as o,CircleGeometry as l,MeshLambertMaterial as c,CanvasTexture as w,Matrix3 as d,Matrix4 as m,Euler as p,Group as _,MeshPhysicalNodeMaterial as g}from"three";import{GLTFLoader as u}from"three/addons/loaders/GLTFLoader.js";import{Fn as b,mix as x,If as k,normalGeometry as v,transformNormalToView as f,positionGeometry as y,vec3 as S,float as z,min as X,uniform as P,mat3 as A}from"three/tsl";import{SimplexNoise as E}from"three/addons/math/SimplexNoise.js";import{OrbitControls as M}from"three/addons/controls/OrbitControls.js";import Y from"three/addons/libs/stats.module.js";var L=b((([s,t])=>{var e=s.sub(t.pivot).mul(t.matrix).add(t.pivot);return x(s,e,t.locus())})),C=b((([s,t])=>{var e=s.mul(t.matrix);return x(s,e,t.locus())}));function R(s){return s.vertex=v,s.fn=C,f(U(s))}var U=b((({fn:s,space:t,vertex:e})=>{var i=e.toVar();return k(t.l_arm.locus(),(()=>{i.assign(s(i,t.l_wrist)),i.assign(s(i,t.l_wrist2)),i.assign(s(i,t.l_elbow)),i.assign(s(i,t.l_arm))})),k(t.r_arm.locus(),(()=>{i.assign(s(i,t.r_wrist)),i.assign(s(i,t.r_wrist2)),i.assign(s(i,t.r_elbow)),i.assign(s(i,t.r_arm))})),k(t.l_leg.locus(),(()=>{i.assign(s(i,t.l_foot)),i.assign(s(i,t.l_ankle)),i.assign(s(i,t.l_ankle2)),i.assign(s(i,t.l_knee)),i.assign(s(i,t.l_leg2)),i.assign(s(i,t.l_leg))})),k(t.r_leg.locus(),(()=>{i.assign(s(i,t.r_foot)),i.assign(s(i,t.r_ankle)),i.assign(s(i,t.r_ankle2)),i.assign(s(i,t.r_knee)),i.assign(s(i,t.r_leg2)),i.assign(s(i,t.r_leg))})),i.assign(s(i,t.head)),i.assign(s(i,t.chest)),i.assign(s(i,t.waist)),i.assign(s(i,t.torso)),i}));var j=new E;function I(s,t=0,e=-1,i=1){return e+(i-e)*(j.noise(s,t)+1)/2}function N(s,t=0,e=-1,i=1){return e+(i-e)*(Math.sin(s+t)+1)/2}function F(s=-1,t=1){return s+(t-s)*Math.random()}const H=b((([s,t,e])=>e.smoothstep(s,t).smoothstep(0,1).smoothstep(0,1)));class O{constructor(t){this.pivot=new s(...t),this.angle=new s,this.matrix=P(A())}mirror(){return this.pivot.x*=-1,this.minX&&(this.minX*=-1),this.maxX&&(this.maxX*=-1),this}}class W extends O{constructor(s,t,e=0,i){super(s),[this.minY,this.maxY]=t,i&&([this.minX,this.maxX]=i),this.slope=Math.tan((90-e)*Math.PI/180)}locus(){var{x:s,y:t,z:e}=y;0!=this.angle&&(t=t.add(e.sub(this.pivot.z).div(this.slope)));var i=H(this.minY,this.maxY,t);return"minX"in this&&(i=i.max(H(this.minX,this.maxX,s.abs().add(t.sub(this.pivot.y))))),i}}class D extends O{constructor(s,t){super(s),[this.minX,this.maxX]=t}locus(){var s=y.x;return H(this.minX,this.maxX,s)}}class V extends D{constructor(s,t,e){super(s,t),[this.minY,this.maxY]=e}locus(){var{x:s,y:t}=y,e=t.sub(this.pivot.y).div(4,s.sign());return H(z(this.minX).sub(e),z(this.maxX).sub(e),s).mul(X(H(this.minY,.8*this.minY+.2*this.maxY,t),H(this.maxY,.8*this.maxY+.2*this.minY,t))).pow(2)}}class q extends V{constructor(s,t,e,i=0){super(s,t,e),this.grown=i}locus(){var{x:s,y:t,z:e}=y,i=S(s.mul(2),t,e.min(0)).sub(S(0,this.pivot.y,0)).length().smoothstep(0,.13/(this.grown+1)).pow(10),a=t.sub(s.abs().mul(.2));return a=0==this.grown?a.add(e.abs().mul(1/6)):a.add(e.abs().mul(.5)),i.mul(s.smoothstep(this.minX,this.maxX),H(this.minY,this.maxY,a).pow(2))}}class B{constructor(s){this.head=new W(...s.head),this.chest=new W(...s.chest),this.waist=new W(...s.waist),this.torso=new W(...s.torso),this.l_knee=new W(...s.knee),this.r_knee=new W(...s.knee).mirror(),this.l_ankle=new W(...s.ankle),this.r_ankle=new W(...s.ankle).mirror(),this.l_ankle2=new W(...s.ankle2),this.r_ankle2=new W(...s.ankle2).mirror(),this.l_leg2=new W(...s.leg2),this.r_leg2=new W(...s.leg2).mirror(),this.l_foot=new W(...s.foot),this.r_foot=new W(...s.foot).mirror(),this.l_leg=new q(...s.leg),this.r_leg=new q(...s.leg).mirror(),this.l_elbow=new D(...s.elbow),this.r_elbow=new D(...s.elbow).mirror(),this.l_wrist2=new D(...s.wrist2),this.r_wrist2=new D(...s.wrist2).mirror(),this.l_wrist=new D(...s.wrist),this.r_wrist=new D(...s.wrist).mirror(),this.l_arm=new V(...s.arm),this.r_arm=new V(...s.arm).mirror()}}var G,T,Z,J,K,Q,$,ss,ts,es=[];class is{constructor(s){if((G=new e({antialias:!0})).setSize(innerWidth,innerHeight),G.shadowMap.enabled=s?.shadows??!0,G.shadowMap.type=i,document.body.appendChild(G.domElement),document.body.style.overflow="hidden",document.body.style.margin="0",(T=new a).background=new r("whitesmoke"),(Z=new n(30,innerWidth/innerHeight)).position.set(0,1,4),Z.lookAt(0,1,0),s?.stats&&(ts=new Y,document.body.appendChild(ts.dom)),(s?.lights??1)&&((J=new h("white",1.5)).position.set(0,14,7),(s?.shadows??1)&&(J.shadow.mapSize.width=2048,J.shadow.mapSize.height=J.shadow.mapSize.width,J.shadow.camera.near=1,J.shadow.camera.far=50,J.shadow.camera.left=-5,J.shadow.camera.right=5,J.shadow.camera.top=5,J.shadow.camera.bottom=-5,J.shadow.normalBias=.01,J.autoUpdate=!1,J.castShadow=!0),T.add(J),(K=new h("white",1.5)).target=T,Z.add(K),T.add(Z)),(s?.controls??1)&&((Q=new M(Z,G.domElement)).enableDamping=!0,Q.target.set(0,.8,0)),s?.ground??1){var t=document.createElement("CANVAS");t.width=128,t.height=128;var d=t.getContext("2d");d.fillStyle="white",d.filter="blur(10px)",d.beginPath(),d.arc(64,64,38,0,2*Math.PI),d.fill(),($=new o(new l(50),new c({color:"antiquewhite",transparent:!0,map:new w(t)}))).receiveShadow=!0,$.rotation.x=-Math.PI/2,$.renderOrder=-1,T.add($)}window.addEventListener("resize",(()=>{Z.aspect=innerWidth/innerHeight,Z.updateProjectionMatrix(),G.setSize(innerWidth,innerHeight)})),G.setAnimationLoop(ns)}}class as extends Event{#s;constructor(){super("animate")}get target(){return this.#s}set target(s){this.#s=s}}var rs=new as;function ns(s){rs.time=s,window.dispatchEvent(rs),es.forEach((s=>{s.update(),s.dispatchEvent(rs)})),ss&&ss(s),Q&&Q.update(),ts&&ts.update(),G.render(T,Z)}function hs(s){ss=s}const os=import.meta.url.replace("/src/body.js","/assets/models/");var ls=new d,cs=new d,ws=new s;function ds(s,t,e,i="angle"){Object.defineProperty(s,t,{get:()=>s[i][e]/(2*Math.PI/360),set(t){s[i][e]=t*(2*Math.PI/360)}})}class ms extends _{constructor(s,t,e,i=e,a="xyz"){super(),this.model=s,this.parent=t,this.pivot=e.pivot,this.angle=e.angle,this.matrix=e.matrix,this.angleAux=i.angle,this.position.copy(e.pivot),ds(this,"bend",a[0]),ds(this,"raise",a[0]),ds(this,"tilt",a[2]),ds(this,"straddle",a[2]),ds(this,"foreward",a[0]),ds(this,"turn",a[1],"angleAux")}attach(s){s.parent&&(s=s.clone());var t=new _,e=new _;t.add(e),e.add(s),e.rotation.z=this.isRight?Math.PI:0,s.position.y*=this.isRight?-1:1,t.matrixAutoUpdate=!1,t.joint=this,this.model.children[0].add(t),this.model.accessories.push(t)}}var ps=new m,_s=new p,gs=1;class us extends _{constructor(e,i,a){super(),this.uid=gs,gs+=.3+2*Math.random(),this.castShadow=!0,this.receiveShadow=!0,this.accessories=[],this.space={};var r,n=new o(e.scene.children[0].geometry),h=function(e){var i=new s,a=(new t).setFromObject(e,!0);return a.getCenter(i),e.position.sub(i),a.max.y-a.min.y}(n);this.space=new B(i),this.torso=new ms(this,null,this.space.torso),this.waist=new ms(this,this.torso,this.space.waist),this.chest=new ms(this,this.waist,this.space.chest),this.head=new ms(this,this.chest,this.space.head),this.l_leg=new ms(this,this.torso,this.space.l_leg,this.space.l_leg2),this.l_knee=new ms(this,this.l_leg,this.space.l_knee),this.l_ankle=new ms(this,this.l_knee,this.space.l_ankle,this.space.l_ankle2),this.l_foot=new ms(this,this.l_ankle,this.space.l_foot),this.r_leg=new ms(this,this.torso,this.space.r_leg,this.space.r_leg2),this.r_knee=new ms(this,this.r_leg,this.space.r_knee),this.r_ankle=new ms(this,this.r_knee,this.space.r_ankle,this.space.r_ankle2),this.r_foot=new ms(this,this.r_ankle,this.space.r_foot),this.l_arm=new ms(this,this.chest,this.space.l_arm,this.space.l_arm,"yxz"),this.l_elbow=new ms(this,this.l_arm,this.space.l_elbow,this.space.l_elbow,"yxz"),this.l_wrist=new ms(this,this.l_elbow,this.space.l_wrist,this.space.l_wrist2,"zxy"),this.r_arm=new ms(this,this.chest,this.space.r_arm,this.space.r_arm,"yxz"),this.r_elbow=new ms(this,this.r_arm,this.space.r_elbow,this.space.r_elbow,"yxz"),this.r_wrist=new ms(this,this.r_elbow,this.space.r_wrist,this.space.r_wrist2,"zxy"),n.material=new g({positionNode:(r={space:this.space},r.vertex=y,r.fn=L,U(r)),normalNode:R({space:this.space}),colorNode:S(254/255,209/255,185/255).pow(2.2),metalness:0,roughness:.6}),this.height=a??h,n.scale.setScalar(this.height/h),n.position.y=0,n.castShadow=!0,n.receiveShadow=!0,this.model=n,this.add(n),es.push(this),T&&T.add(this),this.l_arm.straddle=this.r_arm.straddle=65,this.l_elbow.bend=this.r_elbow.bend=20}update(){function s(s,t,e,i){_s.set(t*s.angle.x,e*s.angle.y,i*s.angle.z,"YZX"),ps.makeRotationFromEuler(_s);var a=ps.elements;s.matrix.value.set(a[0],a[4],a[8],a[1],a[5],a[9],a[2],a[6],a[10])}for(var t of(s(this.space.head,-1,-1,1),s(this.space.chest,-1,-1,1),s(this.space.waist,-1,1,1),s(this.space.torso,-1,-1,1),s(this.space.l_elbow,0,1,0),s(this.space.r_elbow,0,-1,0),s(this.space.l_wrist,0,1,1),s(this.space.r_wrist,0,-1,-1),s(this.space.l_wrist2,-1,0,0),s(this.space.r_wrist2,-1,0,0),s(this.space.l_arm,-1,1,1),s(this.space.r_arm,-1,-1,-1),s(this.space.l_knee,-1,0,0),s(this.space.r_knee,-1,0,0),s(this.space.l_ankle,-1,0,-1),s(this.space.r_ankle,-1,0,1),s(this.space.l_ankle2,0,-1,0),s(this.space.r_ankle2,0,1,0),s(this.space.l_foot,-1,0,0),s(this.space.r_foot,-1,0,0),s(this.space.l_leg2,0,-1,0),s(this.space.r_leg2,0,1,0),s(this.space.l_leg,1,0,-1),s(this.space.r_leg,1,0,1),this.accessories)){var e=t.joint;for(cs.identity(),ws.copy(e.pivot);e;e=e.parent)ls.copy(e.matrix.value).transpose(),cs.premultiply(ls),ws.sub(e.pivot).applyMatrix3(ls).add(e.pivot);t.matrix.setFromMatrix3(cs),t.matrix.setPosition(ws)}}}class bs extends us{static URL="man.glb";static SPACE={head:[[0,1.566,-.066],[1.495,1.647],30],chest:[[0,1.177,-.014],[.777,1.658],0,[.072,.538]],waist:[[0,1.014,-.016],[.547,1.498]],torso:[[0,1.014,-.016],[-3,-2]],leg:[[.074,.97,-.034],[-.004,.004],[1.229,.782]],leg2:[[.07,-.009,-.034],[1.247,.242]],knee:[[.09,.504,-.041],[.603,.382],20],ankle:[[.074,.082,-.002],[.165,.008],-10],ankle2:[[.092,.36,-.052],[.762,-.027]],foot:[[0,.026,.022],[.19,-.342],120],elbow:[[.427,1.453,-.072],[.413,.467]],wrist2:[[.305,1.453,-.068],[.083,.879]],wrist:[[.673,1.462,-.072],[.635,.722]],arm:[[.153,1.408,-.072],[.054,.269],[1.067,1.606]]};constructor(s){super(fs,bs.SPACE,s),this.url=os+bs.URL,this.l_leg.straddle=this.r_leg.straddle=5,this.l_ankle.tilt=this.r_ankle.tilt=-5,this.l_ankle.bend=this.r_ankle.bend=3}}class xs extends us{static URL="woman.glb";static SPACE={head:[[.001,1.471,-.049],[1.395,1.551],30],chest:[[.001,1.114,-.012],[.737,1.568],0,[.069,.509]],waist:[[.001,.961,-.014],[.589,1.417]],torso:[[.001,.961,-.014],[-1.696,-1.694]],leg:[[.071,.92,-.031],[-.002,.005],[1.163,.742]],leg2:[[.076,-.003,-.031],[1.18,.233]],knee:[[.086,.48,-.037],[.573,.365],20],ankle:[[.076,.083,-.005],[.161,.014],-10],ankle2:[[.088,.337,-.047],[.724,-.059]],foot:[[.001,.031,.022],[.184,-.316],120],elbow:[[.404,1.375,-.066],[.39,.441]],wrist2:[[.289,1.375,-.063],[.093,.805]],wrist:[[.608,1.375,-.056],[.581,.644]],arm:[[.137,1.338,-.066],[.052,.233],[1.011,1.519]]};constructor(s){super(ys,xs.SPACE,s),this.url=os+xs.URL,this.l_leg.straddle=this.r_leg.straddle=-2.9,this.l_ankle.tilt=this.r_ankle.tilt=2.9,this.l_ankle.bend=this.r_ankle.bend=3}}class ks extends us{static URL="child.glb";static SPACE={head:[[0,1.149,-.058],[1.091,1.209],30],chest:[[0,.865,-.013],[.566,1.236],0,[.054,.406]],waist:[[0,.717,-.024],[.385,1.13]],torso:[[0,.717,-.024],[-1.354,-1.353]],leg:[[.054,.704,-.027],[-.001,.001],[.845,.581],1],leg2:[[.062,-0,-.021],[.946,.189]],knee:[[.068,.389,-.031],[.468,.299],20],ankle:[[.073,.065,-.033],[.109,.044],-10],ankle2:[[.069,.272,-.048],[.581,-.045]],foot:[[0,.027,-.006],[.112,-.271],120],elbow:[[.337,1.072,-.09],[.311,.369]],wrist2:[[.23,1.074,-.094],[.073,.642]],wrist:[[.538,1.084,-.091],[.519,.553]],arm:[[.108,1.072,-.068],[.041,.185],[.811,1.217]]};constructor(s){super(Ss,ks.SPACE,s),this.url=os+ks.URL,this.l_ankle.bend=this.r_ankle.bend=3}}var vs=new u,[fs,ys,Ss]=await Promise.all([vs.loadAsync(os+bs.URL),vs.loadAsync(os+xs.URL),vs.loadAsync(os+ks.URL)]);console.log("\n%c⋮⋮⋮ Disfigure\n%chttps://boytchev.github.io/disfigure/\n","color: navy","font-size:80%");export{ks as Child,bs as Man,xs as Woman,is as World,Z as camera,K as cameraLight,I as chaotic,Q as controls,es as everybody,$ as ground,J as light,F as random,N as regular,G as renderer,T as scene,hs as setAnimationLoop};
