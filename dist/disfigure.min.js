/*! disfigure v0.0.7 */
import*as e from"three";import{Mesh as t,MeshPhysicalNodeMaterial as a,Vector3 as o,Box3 as s}from"three";import{Fn as i,mat3 as n,uniform as r,mix as l,float as u,If as m,select as d,vec3 as h,positionGeometry as p,normalGeometry as v,transformNormalToView as f}from"three/tsl";import*as c from"three/addons/libs/lil-gui.module.min.js";import{OrbitControls as g}from"three/addons/controls/OrbitControls.js";const y=i((([e])=>{var t=e.cos().toVar(),a=e.sin().toVar();return n(1,0,0,0,t,a,0,a.negate(),t)})).setLayout({name:"matRotX",type:"mat3",inputs:[{name:"angle",type:"float"}]}),z=i((([e])=>{var t=e.cos().toVar(),a=e.sin().toVar();return n(t,0,a.negate(),0,1,0,a,0,t)})).setLayout({name:"matRotY",type:"mat3",inputs:[{name:"angle",type:"float"}]}),x=i((([e])=>{var t=e.cos().toVar(),a=e.sin().toVar();return n(t,a,0,a.negate(),t,0,0,0,1)})).setLayout({name:"matRotZ",type:"mat3",inputs:[{name:"angle",type:"float"}]}),L=i((([e])=>{var t=y(e.x),a=z(e.y),o=x(e.z);return a.mul(t).mul(o)})).setLayout({name:"matRotYXZ",type:"mat3",inputs:[{name:"angles",type:"vec3"}]}),R=i((([e])=>{var t=y(e.x),a=z(e.y),o=x(e.z);return a.mul(o).mul(t)})).setLayout({name:"matRotYZX",type:"mat3",inputs:[{name:"angles",type:"vec3"}]}),w=i((([e])=>{var t=y(e.x),a=z(e.y),o=x(e.z);return t.mul(a).mul(o)})).setLayout({name:"matRotXYZ",type:"mat3",inputs:[{name:"angles",type:"vec3"}]}),b=i((([e])=>{var t=y(e.x),a=z(e.y),o=x(e.z);return t.mul(o).mul(a)})).setLayout({name:"matRotXZY",type:"mat3",inputs:[{name:"angles",type:"vec3"}]}),k=i((([e])=>{var t=y(e.x),a=z(e.y);return x(e.z).mul(t).mul(a)})).setLayout({name:"matRotZXY",type:"mat3",inputs:[{name:"angles",type:"vec3"}]}),M=i((([e])=>{var t=y(e.x),a=z(e.y);return x(e.z).mul(a).mul(t)})).setLayout({name:"matRotZYX",type:"mat3",inputs:[{name:"angles",type:"vec3"}]});function F(e,i,n,r){return function(e){var a=[];e.traverse((e=>{if(e.isMesh){var o=e.geometry.clone().applyMatrix4(e.matrixWorld),s=e.material.clone();a.push(new t(o,s))}})),e.clear(),e.position.set(0,0,0),e.rotation.set(0,0,0,"XYZ"),e.scale.set(1,1,1),e.add(...a)}(e),function(e,t,o,s){e.traverse((e=>{if(e.isMesh){var i=new a;Object.assign(i,e.material),i.metalness=.1,i.roughness=.6,s.colorNode&&(i.colorNode=s.colorNode()),s.positionNode&&(i.positionNode=s.positionNode({skeleton:t,posture:o})),s.normalNode&&(i.normalNode=s.normalNode({skeleton:t,posture:o})),s.emissiveNode&&(i.emissiveNode=s.emissiveNode({skeleton:t,posture:o})),e.material=i}}))}(e,i,n,r),function(e){var t=new o;(new s).setFromObject(e,!0).getCenter(t),e.position.sub(t)}(e),e}function P(e,t){var a=new XMLHttpRequest;a.onreadystatechange=function(){4==this.readyState&&200==this.status&&(document.getElementById(t).innerHTML=this.responseText.split("||")[0])},(e=e.split(".")).pop(),e.push("txt"),e=e.join("."),a.open("GET",e,!0),a.send()}var B=new e.Scene;B.background=new e.Color("whitesmoke");var E=new e.PerspectiveCamera(30,innerWidth/innerHeight);E.position.set(-2,1,3.5),E.lookAt(B.position);var A=new e.WebGPURenderer({antialias:!0});A.outputColorSpace=e.LinearSRGBColorSpace,A.setSize(innerWidth,innerHeight),document.body.appendChild(A.domElement),window.addEventListener("resize",(()=>{E.aspect=innerWidth/innerHeight,E.updateProjectionMatrix(),A.setSize(innerWidth,innerHeight)}));var N=new g(E,A.domElement);N.enableDamping=!0,N.dampingFactor=.05;var q=new e.AmbientLight("white",1);B.add(q);var I=new e.DirectionalLight("white",2);I.position.set(0,0,1),B.add(I);var T,Y=new e.AxesHelper,H={animate:!1},S={isolated:!1,randomize:function(t=e.MathUtils.randInt(Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER)){function a(t=-1,a=1){return e.MathUtils.seededRandom()*(a-t)+t}e.MathUtils.seededRandom(t),C.rotation.y+=a()-.2,G.waist.value.set(a()/4-.2,a()/2,a()/2.5),G.chest.value.set(a()/3,0,a()/3),G.head.value.set(a()/2,a()/2,a()/3),G.kneeLeft.value.set(-(a()+1)/1.5,0,0),G.kneeRight.value.set(-(a()+1)/1.5,0,0),G.footLeft.value.set(.5*a()+.15,0,0),G.footRight.value.set(.5*a()+.15,0,0),G.ankleLeft.value.set(a()/2,0,a()/4),G.ankleRight.value.set(a()/2,0,a()/4),G.legLeft.value.set(0,a()-.25,0),G.legRight.value.set(0,a()+.25,0),G.hipLeft.value.set(a()/1+.25,0,-(a()+1)/4),G.hip2Left.value.set(0,a(),0),G.hipRight.value.set(a()/1+.25,0,(a()+1)/4),G.hip2Right.value.set(0,a(),0),G.elbowLeft.value.set(0,a()+1,0),G.elbowRight.value.set(0,-(a()+1),0),G.forearmLeft.value.set(.5*(1.5*a()+1),0,0),G.forearmRight.value.set(.5*(1.5*a()+1),0,0),G.wristLeft.value.set(0,.5*a()+.1,.7*a()),G.wristRight.value.set(0,.5*a()+.1,-.7*a()),G.armLeft.value.set(.7*(a()/1.5-.15),0,.7*a()),G.armRight.value.set(.7*(a()/1.5-.15),0,.7*a()),j()}},G={},V={},C=new e.Group;function W(e,t,a){V=e,(G=t).select=r(0,"int"),G.isolated=r(0,"int"),C=a,(T=new c.GUI).domElement.style.marginRight=0;var o=T.addFolder("DEBUG");function s(e,t,a=""){return`<div class="padded ${a}">${e} &nbsp; <span class="icon">${t}</span></div>`}return o.close(),o.add(G.select,"value",{Nothing:0,Head:1,Chest:2,Waist:3,Hip:11,Hip2:15,Leg:12,Knee:13,Ankle:14,Foot:16,Arm:21,Elbow:22,Forearm:23,Wrist:24}).name("Show").onChange(X),o.add(S,"isolated",!1).name("Isolated").onChange((()=>{G.isolated.value=S.isolated?1:0})),o.add(H,"animate",!1).name("Animate"),o.add(S,"randomize").name("Randomize"),(o=T.addFolder("TORSO")).add(G.head.value,"x",-.7,.5).name(s("Head","&#x2195;")),o.add(G.head.value,"z",-.5,.5).name(s("","&#x21B6;")),o.add(G.head.value,"y",-1,1).name(s("","&#x2194;")),o.add(G.chest.value,"x",-.7,.4).name(s("Chest","&#x2195;","border")),o.add(G.chest.value,"z",-.5,.5).name(s("","&#x21B6;")),o.add(G.waist.value,"x",-1,.6).name(s("Waist","&#x2195;","border")),o.add(G.waist.value,"z",-.5,.5).name(s("","&#x21B6;")),o.add(G.waist.value,"y",-1,1).name(s("","&#x2194;")),(o=T.addFolder("LEFT LEG").close()).add(G.hipLeft.value,"x",-.6,2.7).name(s("Leg","&#x2195;")),o.add(G.hipLeft.value,"z",-2.4,.2).name(s("","&#x21BA;")),o.add(G.hip2Left.value,"y",-1.4,1.4).name(s("","&#x2194;")),o.add(G.kneeLeft.value,"x",-2.6,0).name(s("Knee","&#x2195;","border")),o.add(G.ankleLeft.value,"x",-1,.7).name(s("Ankle","&#x2195;","border")),o.add(G.legLeft.value,"y",-3,3).name(s("","&#x2194;")),o.add(G.ankleLeft.value,"z",-.5,.5).name(s("","&#x21BA;")),o.add(G.footLeft.value,"x",-.3,.6).name(s("Foot","&#x2195;","border")),(o=T.addFolder("RIGHT LEG").close()).add(G.hipRight.value,"x",-.6,2.7).name(s("Leg","&#x2195;")),o.add(G.hipRight.value,"z",-.2,2.4).name(s("","&#x21BB;")),o.add(G.hip2Right.value,"y",-1.4,1.4).name(s("","&#x2194;")),o.add(G.kneeRight.value,"x",-2.6,0).name(s("Knee","&#x2195;","border")),o.add(G.ankleRight.value,"x",-1,.7).name(s("Ankle","&#x2195;","border")),o.add(G.legRight.value,"y",-3,3).name(s("","&#x2194;")),o.add(G.ankleRight.value,"z",-.5,.5).name(s("","&#x21BB;")),o.add(G.footRight.value,"x",-.3,.6).name(s("Foot","&#x2195;","border")),(o=T.addFolder("LEFT ARM").close()).add(G.armLeft.value,"z",-1.5,1.7).name(s("Arm","&#x2195;")),o.add(G.armLeft.value,"y",-.5,2).name(s("","&#x2194;")),o.add(G.armLeft.value,"x",-.5,.5).name(s("","&#x21BB;")),o.add(G.elbowLeft.value,"y",0,2.7).name(s("Elbow","&#x2195;","border")),o.add(G.wristLeft.value,"z",-1.4,1.4).name(s("Wrist","&#x2195;","border")),o.add(G.wristLeft.value,"y",-.6,.4).name(s("","&#x2194;")),o.add(G.forearmLeft.value,"x",-1.5,3).name(s("","&#x21BB;")),(o=T.addFolder("RIGHT ARM").close()).add(G.armRight.value,"z",-1.5,1.7).name(s("Arm","&#x2195;")),o.add(G.armRight.value,"y",-2,.5).name(s("","&#x2194;")),o.add(G.armRight.value,"x",-.5,.5).name(s("","&#x21BB;")),o.add(G.elbowRight.value,"y",-2.7,0).name(s("Elbow","&#x2195;","border")),o.add(G.wristRight.value,"z",-1.4,1.4).name(s("Wrist","&#x2195;","border")),o.add(G.wristRight.value,"y",-.4,.6).name(s("","&#x2194;")),o.add(G.forearmRight.value,"x",-1.5,3).name(s("","&#x21BB;")),T}function X(e){switch(C.add(Y),e){case 1:Y.position.copy(V.head.pivot);break;case 2:Y.position.copy(V.chest.pivot);break;case 3:Y.position.copy(V.waist.pivot);break;case 11:Y.position.copy(V.hipLeftPos);break;case 15:Y.position.copy(V.hip2.pivot);break;case 12:Y.position.copy(V.leg.pivot);break;case 13:Y.position.copy(V.knee.pivot);break;case 14:Y.position.copy(V.ankle.pivot);break;case 16:Y.position.copy(V.foot.pivot);break;case 21:Y.position.copy(V.arm.pivot);break;case 22:Y.position.copy(V.elbow.pivot);break;case 23:Y.position.copy(V.forearm.pivot);break;case 24:Y.position.copy(V.wrist.pivot);break;default:C.remove(Y)}}function j(){for(var e of T.controllersRecursive())e.updateDisplay()}A.setAnimationLoop((function(e){var t;H.animate&&(t=e/1e3,G.waist.value.set(Math.sin(t)/4-.2,Math.cos(1.2*t)/2,Math.sin(3*t)/2.5),G.chest.value.set(Math.cos(3*t)/3,0,Math.cos(3*t*1.5)/3),G.head.value.set(Math.cos(3*t)/2,Math.sin(1.2*t*2)/2,Math.cos(3*t*1.5)/3),G.kneeLeft.value.set(-(Math.cos(3*t)+1)/1.5,0,0),G.kneeRight.value.set(-(Math.sin(2.4*t)+1)/1.5,0,0),G.footLeft.value.set(.5*Math.cos(1.7*t)+.15,0,0),G.footRight.value.set(.5*Math.sin(1.9*t)+.15,0,0),G.ankleLeft.value.set(Math.cos(3*t)/2,0*Math.cos(2.8*t)/2,Math.cos(2.2*t)/4),G.ankleRight.value.set(Math.sin(3.2*t)/2,0*Math.cos(2.3*t)/2,Math.sin(2.1*t)/4),G.legLeft.value.set(0,Math.cos(2.8*t)-.25,0),G.legRight.value.set(0,Math.cos(2.3*t)+.25,0),G.hipLeft.value.set(Math.cos(3*t)/1+.25,0,-(Math.cos(2.2*t)+1)/4),G.hip2Left.value.set(0,Math.cos(2.8*t),0),G.hipRight.value.set(Math.sin(2.2*t)/1+.25,0,(Math.sin(2.6*t)+1)/4),G.hip2Right.value.set(0,Math.sin(3.2*t),0),G.elbowLeft.value.set(0,Math.cos(2*t-1)+1,0),G.elbowRight.value.set(0,-(Math.sin(1.8*t)+1),0),G.forearmLeft.value.set(.5*(1.5*Math.cos(3.6*t-1)+1),0,0),G.forearmRight.value.set(.5*(1.5*Math.sin(1.8*t*3+1)+1),0,0),G.wristLeft.value.set(0,.5*Math.cos(3.6*t-1)+.1,.7*Math.cos(2.6*t+1)),G.wristRight.value.set(0,.5*Math.cos(3.6*t-1)+.1,-.7*Math.cos(2.6*t+1)),G.armLeft.value.set(.7*(Math.cos(3*t)/1.5-.15),0,.7*Math.cos(2.2*t)),G.armRight.value.set(.7*(Math.sin(2.4*t)/1.5-.15),0,.7*Math.sin(2.7*t)),j()),N.update(),I.position.copy(E.position),A.render(B,E)}));class Z{constructor(e,t,a,s,i){this.pivot=new o(e,t,a),this.mirrorPivot=new o(-e,t,a),this.min=s,this.max=i}}class U extends Z{fuzzy(){return p.y.smoothstep(this.min,this.max)}}class O extends Z{constructor(e,t,a,o,s,i){super(e,t,a,o,s),this.slope=Math.tan((90-i)*Math.PI/180)}fuzzy(){return p.y.add(p.z.div(this.slope)).smoothstep(this.min,this.max)}}class D extends Z{fuzzy(){return p.x.smoothstep(this.min,this.max)}mirrorFuzzy(){return p.x.smoothstep(-this.min,-this.max)}}class _ extends Z{constructor(e,t,a,o,s,i,n){super(e,t,a,o,s),this.minY=i,this.maxY=n}fuzzy(){var e=p.x.smoothstep(this.min,this.max),t=p.y.smoothstep(this.minY,this.maxY);return e.mul(t)}mirrorFuzzy(){var e=p.x.smoothstep(-this.min,-this.max),t=p.y.smoothstep(this.minY,this.maxY);return e.mul(t)}}function K({hipLeftSpan:e}){var t=p.x,a=p.y;return a.sub(t.mul(2)).smoothstep(e.z,u(e.w).sub(t.mul(1.6))).mul(a.smoothstep(e.x,e.y)).mul(t.smoothstep(-.01,.01))}var $=i((([e,t,a,o])=>e.sub(t).mul(L(a.mul(o))).add(t))).setLayout({name:"jointRotate",type:"vec3",inputs:[{name:"pos",type:"vec3"},{name:"center",type:"vec3"},{name:"angle",type:"vec3"},{name:"amount",type:"float"}]}),J=i((([e,t,a,o])=>l(e,e.sub(t).mul(b(a.mul(o))).mul(u(1).sub(o.mul(2*Math.PI).sub(Math.PI).cos().add(1).div(2).div(4).mul(a.z.cos().oneMinus()))).add(t),o.pow(.25)))).setLayout({name:"jointRotate2",type:"vec3",inputs:[{name:"pos",type:"vec3"},{name:"center",type:"vec3"},{name:"angle",type:"vec3"},{name:"amount",type:"float"}]});function Q(e){return e.vertex=p,e.mode=u(1),te(e)}function ee(e){return e.vertex=v,e.mode=u(0),f(te(e)).normalize()}var te=i((({skeleton:e,posture:t,mode:a,vertex:o})=>{var s=o.toVar(),i=e.arm.fuzzy().toVar();m(i.greaterThan(0),(()=>{s.assign($(s,a.mul(e.wrist.pivot),t.wristLeft,e.wrist.fuzzy())),s.assign($(s,a.mul(e.forearm.pivot),t.forearmLeft,e.forearm.fuzzy())),s.assign($(s,a.mul(e.elbow.pivot),t.elbowLeft,e.elbow.fuzzy())),s.assign(J(s,a.mul(e.arm.pivot),t.armLeft,i))}));var n=e.arm.mirrorFuzzy().toVar();m(n.greaterThan(0),(()=>{s.assign($(s,a.mul(e.wrist.mirrorPivot),t.wristRight,e.wrist.mirrorFuzzy())),s.assign($(s,a.mul(e.forearm.mirrorPivot),t.forearmRight,e.forearm.mirrorFuzzy())),s.assign($(s,a.mul(e.elbow.mirrorPivot),t.elbowRight,e.elbow.mirrorFuzzy())),s.assign(J(s,a.mul(e.arm.mirrorPivot),t.armRight,n))})),s.assign($(s,a.mul(e.head.pivot),t.head,e.head.fuzzy())),s.assign($(s,a.mul(e.chest.pivot),t.chest,e.chest.fuzzy())),s.assign($(s,a.mul(e.waist.pivot),t.waist,e.waist.fuzzy()));var r=K(e).toVar();m(r.greaterThan(0),(()=>{s.assign($(s,a.mul(e.foot.pivot),t.footLeft,e.foot.fuzzy())),s.assign($(s,a.mul(e.ankle.pivot),t.ankleLeft,e.ankle.fuzzy())),s.assign($(s,a.mul(e.leg.pivot),t.legLeft,e.leg.fuzzy())),s.assign($(s,a.mul(e.knee.pivot),t.kneeLeft,e.knee.fuzzy())),s.assign($(s,a.mul(e.hip2.pivot),t.hip2Left,e.hip2.fuzzy())),s.assign($(s,a.mul(e.hipLeftPos),t.hipLeft,r))}));var l=function({hipRightSpan:e}){var t=p.x,a=p.y;return a.add(t.mul(2)).smoothstep(e.z,u(e.w).add(t.mul(1.6))).mul(a.smoothstep(e.x,e.y)).mul(t.smoothstep(.01,-.01))}(e).toVar();return m(l.greaterThan(0),(()=>{s.assign($(s,a.mul(e.foot.mirrorPivot),t.footRight,e.ankle.fuzzy())),s.assign($(s,a.mul(e.ankle.mirrorPivot),t.ankleRight,e.ankle.fuzzy())),s.assign($(s,a.mul(e.leg.mirrorPivot),t.legRight,e.leg.fuzzy())),s.assign($(s,a.mul(e.knee.mirrorPivot),t.kneeRight,e.knee.fuzzy())),s.assign($(s,a.mul(e.hip2.mirrorPivot),t.hip2Right,e.hip2.fuzzy())),s.assign($(s,a.mul(e.hipRightPos),t.hipRight,l))})),s})),ae=i((({skeleton:e,posture:t})=>{var a=t.select,o=u(0).add(e.head.fuzzy().mul(d(a.equal(1),1,0))).add(e.chest.fuzzy().mul(d(a.equal(2),1,0))).add(e.waist.fuzzy().mul(d(a.equal(3),1,0))).add(K(e).mul(d(a.equal(11),1,0))).add(e.leg.fuzzy().mul(d(a.equal(12),1,0))).add(e.knee.fuzzy().mul(d(a.equal(13),1,0))).add(e.ankle.fuzzy().mul(d(a.equal(14),1,0))).add(e.foot.fuzzy().mul(d(a.equal(16),1,0))).add(e.hip2.fuzzy().mul(d(a.equal(15),1,0))).add(e.arm.fuzzy().mul(d(a.equal(21),1,0))).add(e.elbow.fuzzy().mul(d(a.equal(22),1,0))).add(e.forearm.fuzzy().mul(d(a.equal(23),1,0))).add(e.wrist.fuzzy().mul(d(a.equal(24),1,0))).toVar();return o.assign(d(t.isolated,o.smoothstep(0,1).mul(2*Math.PI).sub(Math.PI).cos().add(1).div(2).pow(1/4).mul(1.1).negate(),o.clamp(0,1).pow(.75).negate())),h(0,o.div(2),o.div(1))})),oe=i((()=>{var e=p,t=u(0).add(e.x.mul(72).cos().smoothstep(.9,1)).add(e.y.mul(74).cos().smoothstep(.9,1)).add(e.z.mul(74).add(e.y.mul(4.5).add(.5).cos().mul(1).add(2.5)).abs().smoothstep(.6,0)).smoothstep(.6,1).oneMinus().pow(.1);return h(t)}));function se(){return{head:r(h(0,0,0)),chest:r(h(0,0,0)),waist:r(h(0,0,0)),kneeLeft:r(h(0,0,0)),kneeRight:r(h(0,0,0)),ankleLeft:r(h(0,0,0)),ankleRight:r(h(0,0,0)),footLeft:r(h(0,0,0)),footRight:r(h(0,0,0)),hipLeft:r(h(0,0,0)),hip2Left:r(h(0,0,0)),hipRight:r(h(0,0,0)),hip2Right:r(h(0,0,0)),legLeft:r(h(0,0,0)),legRight:r(h(0,0,0)),elbowLeft:r(h(0,0,0)),elbowRight:r(h(0,0,0)),forearmLeft:r(h(0,0,0)),forearmRight:r(h(0,0,0)),wristLeft:r(h(0,0,0)),wristRight:r(h(0,0,0)),armLeft:r(h(0,0,0)),armRight:r(h(0,0,0))}}export{D as LocusX,_ as LocusXY,U as LocusY,O as LocusYZ,W as createGui,P as credits,w as matRotXYZ,b as matRotXZY,L as matRotYXZ,R as matRotYZX,k as matRotZXY,M as matRotZYX,F as processModel,B as scene,oe as tslColorNode,ae as tslEmissiveNode,ee as tslNormalNode,Q as tslPositionNode,se as tslPosture};
