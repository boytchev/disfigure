/*! disfigure v0.0.19 */
import{Color as t,WebGPURenderer as e,PCFSoftShadowMap as s,Scene as r,PerspectiveCamera as i,DirectionalLight as a,Mesh as o,CircleGeometry as n,MeshLambertMaterial as h,CanvasTexture as l,Vector3 as d,Matrix3 as c,Matrix4 as m,Vector4 as u,Euler as p,PlaneGeometry as _,MeshPhysicalNodeMaterial as w,MathUtils as g,Group as f}from"three";import{GLTFLoader as v}from"three/addons/loaders/GLTFLoader.js";import{Fn as b,mix as y,If as x,transformNormalToView as k,normalGeometry as z,positionGeometry as S,mat3 as E,float as P,vec3 as M,min as A,select as T,vec2 as I,uniform as H}from"three/tsl";import{SimplexNoise as L}from"three/addons/math/SimplexNoise.js";import{OrbitControls as R}from"three/addons/controls/OrbitControls.js";import X from"three/addons/libs/stats.module.js";var Y=new L;function C(t,e=0,s=-1,r=1){return s+(r-s)*(Y.noise(t,e)+1)/2}function U(t,e=0,s=-1,r=1){return s+(r-s)*(Math.sin(t+e)+1)/2}function j(t=-1,e=1){return t+(e-t)*Math.random()}var N=b((([t,e,s,r])=>{var i=t.sub(e).mul(s).add(e);return y(t,i,r)})),G=b((([t,e,s,r])=>{var i=t.mul(s);return y(t,i,r)}));function O(t){return k(B(t,G,z))}var B=b((([t,e,s])=>{s=s.toVar();var r=t.space;function i(i){for(var a of i)s.assign(e(s,r[a].pivot,t[a].matrix,r[a].locus()))}return x(r.l_arm.locus(),(()=>{i(["l_wrist","l_forearm","l_elbow","l_arm"])})),x(r.r_arm.locus(),(()=>{i(["r_wrist","r_forearm","r_elbow","r_arm"])})),x(r.l_leg.locus(),(()=>{i(["l_foot","l_ankle","l_shin","l_knee","l_thigh","l_leg"])})),x(r.r_leg.locus(),(()=>{i(["r_foot","r_ankle","r_shin","r_knee","r_thigh","r_leg"])})),i(["head","chest","waist","torso"]),s})),W=b((({color:t,roughness:e,metalness:s})=>E(t,e,s,0,0,0,0)),{color:"vec3",roughness:"float",metalness:"float",return:"mat3"}),V=b((({value:t,from:e,to:s})=>t.greaterThanEqual(e).and(t.lessThanEqual(s))),{value:"float",from:"float",to:"float",return:"float"}),q=b((([t,e,s])=>E(y(t[0],e[0],s),y(t[1],e[1],s),0,0,0)),{matA:"mat3",matB:"mat3",k:"float",return:"mat3"}),F=new t;function Z(t){return F.set(t),M(...F)}function D(t){return W(Z(t),.2,.3)}function J(t){return W(Z(t).mul(3),1,1)}var K,Q,$,tt,et,st,rt,it,at,ot=b((({matA:t,matB:e,width:s=P(.1),balance:r=P(0),blur:i=P(.1)})=>{var a=S.y.div(s,1/Math.PI);return a=a.cos().add(0).smoothstep(r.sub(i),r.add(i)),q(t,e,a)})),nt=b((([t,e,s])=>{var r=S.x.div(s,1/Math.PI);return q(t,e,r.cos().step(0))}),{matA:"mat3",matB:"mat3",width:"float",return:"mat3"}),ht=b((([t,e,s,r,i])=>{var a=S.x.sub(s),o=S.z.sub(r).atan(a).mul(i);return q(t,e,o.cos().step(0))}),{matA:"mat3",matB:"mat3",x:"float",z:"float",width:"float",return:"mat3"}),lt=b((({from:t,to:e,angleX:s=P(0),angleZ:r=P(0)})=>{var i=S.toVar();return i.y.addAssign(i.x.mul(s.radians().tan())),i.y.addAssign(i.z.mul(r.radians().tan())),V(i.y,t,e)})),dt=b((([t,e])=>V(S.x.abs(),t,e)),{from:"float",to:"float",return:"float"}),ct=b((([t,e,s=P(0)])=>{var r=S.toVar();return r.z.addAssign(r.y.mul(s.radians().tan())),V(r.z,t,e)}),{from:"float",to:"float",angleY:"float",return:"float"}),mt=b((([t,e])=>V(S.x,t,e)),{from:"float",to:"float",return:"float"}),ut=b((([t,e,s,r,i])=>{var a=S.x.mul(P(Math.PI).div(r)).cos(),o=s.mix(a,a.acos().mul(-2/Math.PI).sub(1)).mul(i,.5);return V(S.y.add(o),t,e)}),{from:"float",to:"float",sharpness:"float",width:"float",height:"float",return:"float"}),pt=b((([t])=>{var e=E(t[0]);for(let s=1;s<t.length;s+=2)x(t[s],(()=>{e.assign(t[s+1])}));return e})),_t=[];class wt{constructor(d){if((K=new e({antialias:!0,forceWebGL:!0})).setSize(innerWidth,innerHeight),K.shadowMap.enabled=d?.shadows??!0,K.shadowMap.type=s,document.body.appendChild(K.domElement),document.body.style.overflow="hidden",document.body.style.margin="0",(Q=new r).background=new t("whitesmoke"),($=new i(30,innerWidth/innerHeight)).position.set(0,1.5,4),d?.stats&&(at=new X,document.body.appendChild(at.dom)),(d?.lights??1)&&((tt=new a("white",1.5)).position.set(0,14,7),(d?.shadows??1)&&(tt.shadow.mapSize.width=2048,tt.shadow.mapSize.height=tt.shadow.mapSize.width,tt.shadow.camera.near=1,tt.shadow.camera.far=50,tt.shadow.camera.left=-5,tt.shadow.camera.right=5,tt.shadow.camera.top=5,tt.shadow.camera.bottom=-5,tt.shadow.normalBias=.01,tt.autoUpdate=!1,tt.castShadow=!0),Q.add(tt),(et=new a("white",1.5)).target=Q,$.add(et),Q.add($)),(d?.controls??1)&&((st=new R($,K.domElement)).enableDamping=!0,st.target.set(0,.9,0)),d?.ground??1){var c=document.createElement("CANVAS");c.width=128,c.height=128;var m=c.getContext("2d");m.fillStyle="white",m.filter="blur(10px)",m.beginPath(),m.arc(64,64,38,0,2*Math.PI),m.fill(),(rt=new o(new n(32),new h({color:"antiquewhite",transparent:!0,map:new l(c)}))).receiveShadow=!0,rt.rotation.x=-Math.PI/2,rt.renderOrder=-1,Q.add(rt)}window.addEventListener("resize",(()=>{$.aspect=innerWidth/innerHeight,$.updateProjectionMatrix(),K.setSize(innerWidth,innerHeight)})),K.setAnimationLoop(vt)}}class gt extends Event{#t;constructor(){super("animate")}get target(){return this.#t}set target(t){this.#t=t}}var ft=new gt;function vt(t){try{ft.time=t,window.dispatchEvent(ft),_t.forEach((t=>{t.update(),t.dispatchEvent(ft)})),it&&it(t),st&&st.update(),at&&at.update(),K.render(Q,$)}catch(t){throw K.setAnimationLoop(null),t}}function bt(t){it=t}console.time("TSL");var yt=0,xt=document.getElementById("spinner");xt&&setTimeout((()=>xt.style.display="none"),1e4);const kt=b((([t,e])=>e.smoothstep(t.x,t.y).smoothstep(0,1).smoothstep(0,1)),{edge:"vec2",value:"float",return:"float"});var zt=b((([t,e,s,r])=>{var i=t.y,a=t.z;return i=i.add(a.sub(e.z).div(r)),kt(s,i)}),{pos:"vec3",pivot:"vec3",rangeY:"vec2",slope:"float",return:"float"}),St=b((([t,e])=>kt(e,t.x)),{pos:"vec3",rangeX:"vec2",return:"float"}),Et=b((([t,e,s,r])=>{var i=t.x,a=t.y,o=a.sub(e.y).div(4,i.sign());return kt(s,i.add(o)).mul(A(a.smoothstep(r.x,y(r.x,r.y,.2)),a.smoothstep(r.y,y(r.y,r.x,.2)))).pow(2)}),{pos:"vec3",pivot:"vec3",rangeX:"vec2",rangeY:"vec2",return:"float"}),Pt=b((([t,e,s,r,i])=>{var a=t.x,o=t.y,n=t.z,h=M(a.mul(2),o,n.min(0)).sub(M(0,e.y,0)).length().smoothstep(0,P(.13).div(P(i).add(1))).pow(10),l=o.sub(a.abs().mul(.2));return l=l.add(T(i.equal(1),n.abs().mul(.5),n.mul(1/6))),h.mul(a.smoothstep(s.x,s.y),kt(r,l).pow(2))}),{pos:"vec3",pivot:"vec3",rangeX:"vec2",rangeY:"vec2",grown:"float",return:"float"});class Mt{constructor(t){this.pivot=new d(...t),this.isRight=!1}mirror(){return this.isRight=!0,this.pivot.x*=-1,this.rangeX&&(this.rangeX.value.x*=-1,this.rangeX.value.y*=-1),this}}class At extends Mt{constructor(t,e,s=0){super(t),this.rangeY=I(...e),this.slope=Math.tan((90-s)*Math.PI/180)}locus(){return zt(S,this.pivot,this.rangeY,this.slope)}}class Tt extends Mt{constructor(t,e){super(t),this.rangeX=I(...e)}locus(){return St(S,this.rangeX)}}class It extends Tt{constructor(t,e,s){super(t,e),this.rangeY=I(...s)}locus(){return yt++,xt&&yt>=12*_t.length&&(console.timeLog("TSL",yt),xt.style.display="none"),Et(S,this.pivot,this.rangeX,this.rangeY)}}class Ht extends It{constructor(t,e,s,r=0){super(t,e,s),this.grown=r}locus(){return Pt(S,this.pivot,this.rangeX,this.rangeY,this.grown)}}class Lt{constructor(t){var e={head:At,chest:At,waist:At,torso:At},s={knee:At,ankle:At,shin:At,thigh:At,foot:At,leg:Ht,elbow:Tt,forearm:Tt,wrist:Tt,arm:It};for(var r in e)this[r]=new e[r](...t[r]);for(var r in s)this["l_"+r]=new s[r](...t[r]),this["r_"+r]=new s[r](...t[r]).mirror()}}var Rt=new v;const Xt=import.meta.url.replace("/src/body.js","/assets/models/");var Yt=new c,Ct=new c,Ut=new m,jt=new d,Nt=new u,Gt=t=>180*t/Math.PI,Ot=t=>t/180*Math.PI,Bt=t=>Math.round(100*t)/100;function Wt(t,e,s){Object.defineProperty(t,e,{get:()=>Gt(t.angle[s]),set(e){t.angle[s]=Ot(e)}})}class Vt{constructor(t,e,s,r="xyz"){this.model=t,this.parent=e,this.space=s,this.angle=new d,this.matrix=H(new c),Wt(this,"bend",r[0]),Wt(this,"raise",r[0]),Wt(this,"tilt",r[2]),Wt(this,"straddle",r[2]),Wt(this,"foreward",r[0]),Wt(this,"turn",r[1])}attach(t,e,s,r){t.parent&&(t=t.clone()),void 0!==e&&t.position.set(e,s,r);var i=new f;i.add(t),i.matrixAutoUpdate=!1,i.joint=this,this.model.add(i),this.model.accessories.push(i)}point(t,e,s){var r=this;for(Ct.identity(),jt.set(t,e,s),jt.add(r.space.pivot);r;r=r.parent)Yt.copy(r.matrix.value).transpose(),Ct.premultiply(Yt),jt.sub(r.space.pivot).applyMatrix3(Yt).add(r.space.pivot);return Ut.setFromMatrix3(Ct),Ut.setPosition(jt),Nt.set(0,0,0,1),Nt.applyMatrix4(Ut),jt.set(Nt.x,Nt.y,Nt.z),jt}lockTo(t,e,s,r,i,a){this.model.position.set(0,0,0),jt=this.point(t,e,s),this.model.position.sub(jt),jt.set(r,i,a),this.model.position.add(jt)}}var qt=new m,Ft=new p,Zt=new _,Dt=1;class Jt extends o{static POSTURE_PARTS=["torso","waist","chest","head","l_leg","l_thigh","l_knee","l_shin","l_ankle","l_foot","r_leg","r_thigh","r_knee","r_shin","r_ankle","r_foot","l_arm","l_elbow","l_forearm","l_wrist","r_arm","r_elbow","r_forearm","r_wrist"];constructor(t,e,s,r){var i;super(Zt),this.url=t,this.uid=Dt,Dt+=1+10*Math.random(),this.castShadow=!0,this.receiveShadow=!0,this.accessories=[],this.height=s??r,this.scale.setScalar(this.height/r),Rt.load(this.url,(t=>{this.geometry=t.scene.children[0].geometry})),this.space=new Lt(e),this.torso=new Vt(this,null,this.space.torso),this.waist=new Vt(this,this.torso,this.space.waist),this.chest=new Vt(this,this.waist,this.space.chest),this.head=new Vt(this,this.chest,this.space.head),this.l_leg=new Vt(this,this.torso,this.space.l_leg),this.l_thigh=new Vt(this,this.l_leg,this.space.l_thigh),this.l_knee=new Vt(this,this.l_thigh,this.space.l_knee),this.l_shin=new Vt(this,this.l_knee,this.space.l_shin),this.l_ankle=new Vt(this,this.l_shin,this.space.l_ankle),this.l_foot=new Vt(this,this.l_ankle,this.space.l_foot),this.r_leg=new Vt(this,this.torso,this.space.r_leg),this.r_thigh=new Vt(this,this.r_leg,this.space.r_thigh),this.r_knee=new Vt(this,this.r_thigh,this.space.r_knee),this.r_shin=new Vt(this,this.r_knee,this.space.r_shin),this.r_ankle=new Vt(this,this.r_shin,this.space.r_ankle),this.r_foot=new Vt(this,this.r_ankle,this.space.r_foot),this.l_arm=new Vt(this,this.chest,this.space.l_arm,"yxz"),this.l_elbow=new Vt(this,this.l_arm,this.space.l_elbow,"yxz"),this.l_forearm=new Vt(this,this.l_elbow,this.space.l_forearm,"zxy"),this.l_wrist=new Vt(this,this.l_forearm,this.space.l_wrist,"zxy"),this.r_arm=new Vt(this,this.chest,this.space.r_arm,"yxz"),this.r_elbow=new Vt(this,this.r_arm,this.space.r_elbow,"yxz"),this.r_forearm=new Vt(this,this.r_elbow,this.space.r_forearm,"zxy"),this.r_wrist=new Vt(this,this.r_forearm,this.space.r_wrist,"zxy"),this.material=new w({positionNode:(i=this,B(i,N,S)),normalNode:O(this),colorNode:M(.99,.65,.49),metalness:0,roughness:.6}),this.position.y=0,this.castShadow=!0,this.receiveShadow=!0,_t.push(this),Q&&Q.add(this),this.l_arm.straddle=this.r_arm.straddle=65,this.l_elbow.bend=this.r_elbow.bend=20}update(){function t(t,e,r,i){Ft.set(e*t.angle.x,r*t.angle.y,i*t.angle.z,"YZX"),s(t)}function e(t,e,r,i){Ft.set(0,0,i*t.angle.z),Ft.reorder("YZX"),Ft.set(0,r*t.angle.y,Ft.z),Ft.reorder("XYZ"),Ft.set(Ft.x+e*t.angle.x,Ft.y,Ft.z),s(t)}function s(t){qt.makeRotationFromEuler(Ft);var e=qt.elements;t.matrix.value.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10])}for(var r of(t(this.torso,-1,-1,1),t(this.head,-1,-1,1),t(this.chest,-1,-1,1),t(this.waist,-1,-1,1),t(this.l_elbow,0,1,0),t(this.r_elbow,0,-1,0),t(this.l_wrist,0,1,1),t(this.r_wrist,0,-1,-1),t(this.l_forearm,-1,0,0),t(this.r_forearm,-1,0,0),e(this.l_arm,-1,1,1),e(this.r_arm,-1,-1,-1),t(this.l_knee,-1,0,1),t(this.r_knee,-1,0,-1),t(this.l_ankle,-1,0,-1),t(this.r_ankle,-1,0,1),t(this.l_shin,0,-1,0),t(this.r_shin,0,1,0),t(this.l_foot,-1,0,0),t(this.r_foot,-1,0,0),t(this.l_thigh,0,-1,0),t(this.r_thigh,0,1,0),e(this.l_leg,1,-1,-1),e(this.r_leg,1,1,1),this.accessories)){var i=r.joint;for(Ct.identity(),jt.copy(i.space.pivot);i;i=i.parent)Yt.copy(i.matrix.value).transpose(),Ct.premultiply(Yt),jt.sub(i.space.pivot).applyMatrix3(Yt).add(i.space.pivot);r.matrix.setFromMatrix3(Ct),r.matrix.setPosition(jt)}}get posture(){var t=[];for(var e of Jt.POSTURE_PARTS)t.push(...this[e].angle);var s=[...this.position],r=[...this.rotation];return{version:8,position:s.map((t=>Bt(t))),rotation:r,angles:t.map((t=>Bt(Gt(t))))}}get postureString(){return JSON.stringify(this.posture)}set posture(t){8!=t.version&&console.error("Incompatible posture version");var e=0,s=t.angles.map((t=>Ot(t)));for(var r of(this.position.set(...t.position),this.rotation.set(...t.rotation),Jt.POSTURE_PARTS))this[r].angle.set(s[e],s[e+1],s[e+2]),e+=3;this.update(),this.updateMatrixWorld(!0)}blend(t,e,s){function r(t,e){for(var r=[],i=0;i<t.length;i++)r[i]=g.lerp(t[i],e[i],s);return r}var i=new p(...t.rotation),a=new p(...e.rotation);i.reorder(a._order);var o={version:t.version,position:r(t.position,e.position),rotation:new p(...r([i._x,i._y,i._z],[a._x,a._y,a._z])),angles:r(t.angles,e.angles)};this.posture=o}dress(t){var e=pt(t).toVar();this.material.colorNode=e[0].xyz,this.material.roughnessNode=e[1].x,this.material.metalnessNode=e[1].y}}class Kt extends Jt{static URL="man.glb";static HEIGHT=1.795;static SPACE={head:[[0,1.566,-.066],[1.495,1.647],30],chest:[[0,1.177,-.014],[.777,1.658],0,[.072,.538]],waist:[[0,1.014,-.016],[.547,1.498]],torso:[[0,1.014,-.016],[-3,-2]],leg:[[.074,.97,-.034],[-.004,.004],[1.229,.782]],thigh:[[.07,-.009,-.034],[1.247,.242]],knee:[[.09,.504,-.041],[.603,.382],20],ankle:[[.074,.082,-.002],[.165,.008],-10],shin:[[.092,.36,-.052],[.762,-.027]],foot:[[0,.026,.022],[.19,-.342],120],elbow:[[.427,1.453,-.072],[.413,.467]],forearm:[[.55,1.453,-.068],[.083,.879]],wrist:[[.673,1.462,-.072],[.635,.722]],arm:[[.153,1.408,-.072],[.054,.269],[1.067,1.616]]};constructor(t){super(Xt+Kt.URL,Kt.SPACE,t,Kt.HEIGHT),this.l_leg.straddle=this.r_leg.straddle=5,this.l_ankle.tilt=this.r_ankle.tilt=-5,this.l_ankle.bend=this.r_ankle.bend=3}}class Qt extends Jt{static URL="woman.glb";static HEIGHT=1.691;static SPACE={head:[[.001,1.471,-.049],[1.395,1.551],30],chest:[[.001,1.114,-.012],[.737,1.568],0,[.069,.509]],waist:[[.001,.961,-.014],[.589,1.417]],torso:[[.001,.961,-.014],[-1.696,-1.694]],leg:[[.071,.92,-.031],[-.002,.005],[1.163,.742]],thigh:[[.076,-.003,-.031],[1.18,.233]],knee:[[.086,.48,-.037],[.573,.365],20],shin:[[.088,.337,-.047],[.724,-.059]],ankle:[[.076,.083,-.005],[.161,.014],-10],foot:[[.001,.031,.022],[.184,-.316],120],elbow:[[.404,1.375,-.066],[.39,.441]],forearm:[[.506,1.375,-.063],[.093,.805]],wrist:[[.608,1.375,-.056],[.581,.644]],arm:[[.137,1.338,-.066],[.052,.233],[1.011,1.519]]};constructor(t){super(Xt+Qt.URL,Qt.SPACE,t,Qt.HEIGHT),this.l_leg.straddle=this.r_leg.straddle=-2.9,this.l_ankle.tilt=this.r_ankle.tilt=2.9,this.l_ankle.bend=this.r_ankle.bend=3}}class $t extends Jt{static URL="child.glb";static HEIGHT=1.352;static SPACE={head:[[0,1.149,-.058],[1.091,1.209],30],chest:[[0,.865,-.013],[.566,1.236],0,[.054,.406]],waist:[[0,.717,-.024],[.385,1.13]],torso:[[0,.717,-.024],[-1.354,-1.353]],leg:[[.054,.704,-.027],[-.001,.001],[.845,.581],1],thigh:[[.062,-0,-.021],[.946,.189]],knee:[[.068,.389,-.031],[.468,.299],20],shin:[[.069,.272,-.048],[.581,-.045]],ankle:[[.073,.065,-.033],[.109,.044],-10],foot:[[0,.027,-.006],[.112,-.271],120],elbow:[[.337,1.072,-.09],[.311,.369]],forearm:[[.438,1.074,-.094],[.073,.642]],wrist:[[.538,1.084,-.091],[.519,.553]],arm:[[.108,1.072,-.068],[.041,.185],[.811,1.217]]};constructor(t){super(Xt+$t.URL,$t.SPACE,t,$t.HEIGHT),this.l_ankle.bend=this.r_ankle.bend=3}}console.log("\n%c⋮⋮⋮ Disfigure\n%chttps://boytchev.github.io/disfigure/\n","color: navy","font-size:80%");export{$t as Child,Kt as Man,Qt as Woman,wt as World,lt as band,ut as bandWave,ot as bands,$ as camera,et as cameraLight,C as chaotic,st as controls,_t as everybody,rt as ground,D as latex,tt as light,j as random,U as regular,K as renderer,Q as scene,bt as setAnimationLoop,ct as slice,dt as strip,mt as stripSingle,nt as stripes,ht as stripesAround,J as velour};
