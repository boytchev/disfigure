/*! disfigure v0.0.9 */
import{positionGeometry as t,Fn as e,mat3 as a,mix as s,float as i,If as o,select as r,vec3 as l,normalGeometry as m,transformNormalToView as n,uniform as u}from"three/tsl";import{Vector3 as h,Mesh as p,Box3 as c,MeshPhysicalNodeMaterial as g}from"three";function f(t,e,a){return e*t/1e3+a}function d(t,e){return new h(f(t[0],e.scale,e.x),f(t[1],e.scale,e.y),f(t[2],e.scale,e.z))}function v(t){var e=Object.assign(Object.create(t),t);return e.pivot=e.pivot.clone(),e.pivot.x*=-1,e}class L{constructor(t,e,a,s=0){this.pivot=d(e,t),this.minY=f(a[0],t.scale,t.y),this.maxY=f(a[1],t.scale,t.y),this.slope=Math.tan((90-s)*Math.PI/180)}mirror(){return v(this)}locus(){var e=t.y;return 0!=this.angle&&(e=e.add(t.z.div(this.slope))),e.smoothstep(this.minY,this.maxY)}}class R{constructor(t,e,a){this.pivot=d(e,t),this.minX=f(a[0],t.scale,t.x),this.maxX=f(a[1],t.scale,t.x)}mirror(){var t=v(this);return t.minX*=-1,t.maxX*=-1,t}locus(){return t.x.smoothstep(this.minX,this.maxX)}}class y extends R{constructor(t,e,a,s){super(t,e,a),this.minY=f(s[0],t.scale,t.y),this.maxY=f(s[1],t.scale,t.y)}locus(){var e=t.x.smoothstep(this.minX,this.maxX),a=t.y.smoothstep(this.minY,this.maxY);return e.mul(a)}}class w extends y{constructor(t,e,a,s,i){super(t,e,a,s),this.topY=f(i,t.scale,t.y)}locus(){var e=t.x.toVar(),a=t.y;return a.step(this.topY).mul(e.smoothstep(this.minX,this.maxX)).mul(a.smoothstep(e.abs().div(.7).add(this.minY),e.abs().div(7).add(this.maxY))).pow(2)}}class x{constructor(t,e){for(var a in e){var s=e[a].shift();e[a]=new s(t,...e[a])}this.head=e.head,this.chest=e.chest,this.waist=e.waist,this.kneeLeft=e?.kneeLeft??e.knee,this.kneeRight=e?.kneeRight??e.knee.mirror(),this.ankleLeft=e?.ankleLeft??e.ankle,this.ankleRight=e?.ankleRight??e.ankle.mirror(),this.legLeft=e?.legLeft??e.leg,this.legRight=e?.legRight??e.leg.mirror(),this.hip2Left=e?.hip2Left??e.hip2,this.hip2Right=e?.hip2Right??e.hip2.mirror(),this.footLeft=e?.footLeft??e.foot,this.footRight=e?.footRight??e.foot.mirror(),this.hipLeft=e?.hipLeft??e.hip,this.hipRight=e?.hipRight??e.hip.mirror(),this.elbowLeft=e?.elbowLeft??e.elbow,this.elbowRight=e?.elbowRight??e.elbow.mirror(),this.forearmLeft=e?.forearmLeft??e.forearm,this.forearmRight=e?.forearmRight??e.forearm.mirror(),this.wristLeft=e?.wristLeft??e.wrist,this.wristRight=e?.wristRight??e.wrist.mirror(),this.armLeft=e?.armLeft??e.arm,this.armRight=e?.armRight??e.arm.mirror()}}const b=e((([t])=>{var e=t.cos().toVar(),s=t.sin().toVar();return a(1,0,0,0,e,s,0,s.negate(),e)})).setLayout({name:"matRotX",type:"mat3",inputs:[{name:"angle",type:"float"}]}),k=e((([t])=>{var e=t.cos().toVar(),s=t.sin().toVar();return a(e,0,s.negate(),0,1,0,s,0,e)})).setLayout({name:"matRotY",type:"mat3",inputs:[{name:"angle",type:"float"}]}),q=e((([t])=>{var e=t.cos().toVar(),s=t.sin().toVar();return a(e,s,0,s.negate(),e,0,0,0,1)})).setLayout({name:"matRotZ",type:"mat3",inputs:[{name:"angle",type:"float"}]}),Y=e((([t])=>{var e=b(t.x),a=k(t.y),s=q(t.z);return a.mul(e).mul(s)})).setLayout({name:"matRotYXZ",type:"mat3",inputs:[{name:"angles",type:"vec3"}]}),X=e((([t])=>{var e=b(t.x),a=k(t.y),s=q(t.z);return a.mul(s).mul(e)})).setLayout({name:"matRotYZX",type:"mat3",inputs:[{name:"angles",type:"vec3"}]}),z=e((([t])=>{var e=b(t.x),a=k(t.y),s=q(t.z);return e.mul(a).mul(s)})).setLayout({name:"matRotXYZ",type:"mat3",inputs:[{name:"angles",type:"vec3"}]}),V=e((([t])=>{var e=b(t.x),a=k(t.y),s=q(t.z);return e.mul(s).mul(a)})).setLayout({name:"matRotXZY",type:"mat3",inputs:[{name:"angles",type:"vec3"}]}),N=e((([t])=>{var e=b(t.x),a=k(t.y);return q(t.z).mul(e).mul(a)})).setLayout({name:"matRotZXY",type:"mat3",inputs:[{name:"angles",type:"vec3"}]}),M=e((([t])=>{var e=b(t.x),a=k(t.y);return q(t.z).mul(a).mul(e)})).setLayout({name:"matRotZYX",type:"mat3",inputs:[{name:"angles",type:"vec3"}]});function Z(t,e,a,s,i={}){var o={};return function(t){var e=[];t.traverse((t=>{if(t.isMesh){var a=t.geometry.clone().applyMatrix4(t.matrixWorld),s=t.material.clone();if(t.isSkinnedMesh){t.pose();for(var i=a.getAttribute("position"),o=a.getAttribute("normal"),r=new h,l=0;l<i.count;l++)r.fromBufferAttribute(i,l),t.applyBoneTransform(l,r),i.setXYZ(l,...r),r.fromBufferAttribute(o,l),t.applyBoneTransform(l,r),o.setXYZ(l,...r)}var m=new p(a,s);m.frustumCulled=!1,e.push(m)}})),t.clear(),t.position.set(0,0,0),t.rotation.set(0,0,0,"XYZ"),t.scale.set(1,1,1),t.add(...e)}(t),function(t,e){var a=new h,s=(new c).setFromObject(t,!0);s.getCenter(a),t.position.sub(a),e.x=(s.max.x+s.min.x)/2,e.y=s.min.y,e.z=(s.max.z+s.min.z)/2,e.scale=Math.max(s.max.x-s.min.x,s.max.y-s.min.y,s.max.z-s.min.z)}(t,o),function(t,e,a,s,i){t.traverse((t=>{if(t.isMesh){var o=new g;Object.assign(o,t.material),Object.assign(o,i),s.colorNode&&(o.colorNode=s.colorNode()),s.positionNode&&(o.positionNode=s.positionNode({space:e,posture:a})),s.normalNode&&(o.normalNode=s.normalNode({space:e,posture:a})),s.emissiveNode&&(o.emissiveNode=s.emissiveNode({space:e,posture:a})),t.material=o}}))}(t,e=new x(o,e),a,s,i),{model:t,dims:o,space:e}}var T=e((([t,e,a,s])=>t.sub(e).mul(Y(a.mul(s))).add(e))).setLayout({name:"jointRotate",type:"vec3",inputs:[{name:"pos",type:"vec3"},{name:"center",type:"vec3"},{name:"angle",type:"vec3"},{name:"amount",type:"float"}]}),j=e((([t,e,a,o])=>s(t,t.sub(e).mul(V(a.mul(o))).mul(i(1).sub(o.mul(2*Math.PI).sub(Math.PI).cos().add(1).div(2).div(4).mul(a.z.cos().oneMinus()))).add(e),o.pow(.25)))).setLayout({name:"jointRotate2",type:"vec3",inputs:[{name:"pos",type:"vec3"},{name:"center",type:"vec3"},{name:"angle",type:"vec3"},{name:"amount",type:"float"}]});function O(e){return e.vertex=t,e.mode=i(1),B(e)}function A(t){return t.vertex=m,t.mode=i(0),n(B(t)).normalize()}var B=e((({space:t,posture:e,mode:a,vertex:s})=>{var i=s.toVar(),r=t.armLeft.locus().toVar();o(r.greaterThan(0),(()=>{i.assign(T(i,a.mul(t.wristLeft.pivot),e.wristLeft,t.wristLeft.locus())),i.assign(T(i,a.mul(t.forearmLeft.pivot),e.forearmLeft,t.forearmLeft.locus())),i.assign(T(i,a.mul(t.elbowLeft.pivot),e.elbowLeft,t.elbowLeft.locus())),i.assign(j(i,a.mul(t.armLeft.pivot),e.armLeft,r))}));var l=t.armRight.locus().toVar();o(l.greaterThan(0),(()=>{i.assign(T(i,a.mul(t.wristRight.pivot),e.wristRight,t.wristRight.locus())),i.assign(T(i,a.mul(t.forearmRight.pivot),e.forearmRight,t.forearmRight.locus())),i.assign(T(i,a.mul(t.elbowRight.pivot),e.elbowRight,t.elbowRight.locus())),i.assign(j(i,a.mul(t.armRight.pivot),e.armRight,l))})),i.assign(T(i,a.mul(t.head.pivot),e.head,t.head.locus())),i.assign(T(i,a.mul(t.chest.pivot),e.chest,t.chest.locus())),i.assign(T(i,a.mul(t.waist.pivot),e.waist,t.waist.locus()));var m=t.hipLeft.locus().toVar();o(m.greaterThan(0),(()=>{i.assign(T(i,a.mul(t.footLeft.pivot),e.footLeft,t.footLeft.locus())),i.assign(T(i,a.mul(t.ankleLeft.pivot),e.ankleLeft,t.ankleLeft.locus())),i.assign(T(i,a.mul(t.legLeft.pivot),e.legLeft,t.legLeft.locus())),i.assign(T(i,a.mul(t.kneeLeft.pivot),e.kneeLeft,t.kneeLeft.locus())),i.assign(T(i,a.mul(t.hip2Left.pivot),e.hip2Left,t.hip2Left.locus())),i.assign(T(i,a.mul(t.hipLeft.pivot),e.hipLeft,m))}));var n=t.hipRight.locus().toVar();return o(n.greaterThan(0),(()=>{i.assign(T(i,a.mul(t.footRight.pivot),e.footRight,t.footRight.locus())),i.assign(T(i,a.mul(t.ankleRight.pivot),e.ankleRight,t.ankleRight.locus())),i.assign(T(i,a.mul(t.legRight.pivot),e.legRight,t.legRight.locus())),i.assign(T(i,a.mul(t.kneeRight.pivot),e.kneeRight,t.kneeRight.locus())),i.assign(T(i,a.mul(t.hip2Right.pivot),e.hip2Right,t.hip2Right.locus())),i.assign(T(i,a.mul(t.hipRight.pivot),e.hipRight,n))})),i})),I=e((({space:t,posture:e})=>{var a=e.select,s=i(0).add(t.head.locus().mul(r(a.equal(1),1,0))).add(t.chest.locus().mul(r(a.equal(2),1,0))).add(t.waist.locus().mul(r(a.equal(3),1,0))).add(t.hipLeft.locus().mul(r(a.equal(11),1,0))).add(t.hipRight.locus().mul(r(a.equal(11),1,0))).add(t.legLeft.locus().mul(r(a.equal(12),1,0))).add(t.legRight.locus().mul(r(a.equal(12),1,0))).add(t.kneeLeft.locus().mul(r(a.equal(13),1,0))).add(t.kneeRight.locus().mul(r(a.equal(13),1,0))).add(t.ankleLeft.locus().mul(r(a.equal(14),1,0))).add(t.ankleRight.locus().mul(r(a.equal(14),1,0))).add(t.footLeft.locus().mul(r(a.equal(16),1,0))).add(t.footRight.locus().mul(r(a.equal(16),1,0))).add(t.hip2Left.locus().mul(r(a.equal(15),1,0))).add(t.hip2Right.locus().mul(r(a.equal(15),1,0))).add(t.armLeft.locus().mul(r(a.equal(21),1,0))).add(t.armRight.locus().mul(r(a.equal(21),1,0))).add(t.elbowLeft.locus().mul(r(a.equal(22),1,0))).add(t.elbowRight.locus().mul(r(a.equal(22),1,0))).add(t.forearmLeft.locus().mul(r(a.equal(23),1,0))).add(t.forearmRight.locus().mul(r(a.equal(23),1,0))).add(t.wristLeft.locus().mul(r(a.equal(24),1,0))).add(t.wristRight.locus().mul(r(a.equal(24),1,0))).clamp(0,1).negate().toVar(),m=l(i(-1).sub(s),s.div(2),s.div(.5)).toVar();return o(s.lessThan(-.99),(()=>{m.assign(l(0,0,0))})),o(s.greaterThan(-.01),(()=>{m.assign(l(0,0,0))})),m})),P=e((()=>{var e=t,a=i(0).add(e.x.mul(72).cos().smoothstep(.9,1)).add(e.y.mul(74).cos().smoothstep(.9,1)).add(e.z.mul(74).add(e.y.mul(4.5).add(.5).cos().mul(1).add(2.5)).abs().smoothstep(.6,0)).smoothstep(.6,1).oneMinus().pow(.1);return l(a)}));function C(){return{head:u(l(0,0,0)),chest:u(l(0,0,0)),waist:u(l(0,0,0)),kneeLeft:u(l(0,0,0)),kneeRight:u(l(0,0,0)),ankleLeft:u(l(0,0,0)),ankleRight:u(l(0,0,0)),footLeft:u(l(0,0,0)),footRight:u(l(0,0,0)),hipLeft:u(l(0,0,0)),hip2Left:u(l(0,0,0)),hipRight:u(l(0,0,0)),hip2Right:u(l(0,0,0)),legLeft:u(l(0,0,0)),legRight:u(l(0,0,0)),elbowLeft:u(l(0,0,0)),elbowRight:u(l(0,0,0)),forearmLeft:u(l(0,0,0)),forearmRight:u(l(0,0,0)),wristLeft:u(l(0,0,0)),wristRight:u(l(0,0,0)),armLeft:u(l(0,0,0)),armRight:u(l(0,0,0))}}export{w as LocusT,R as LocusX,y as LocusXY,L as LocusY,x as Space,z as matRotXYZ,V as matRotXZY,Y as matRotYXZ,X as matRotYZX,N as matRotZXY,M as matRotZYX,Z as processModel,P as tslColorNode,I as tslEmissiveNode,A as tslNormalNode,O as tslPositionNode,C as tslPosture};
