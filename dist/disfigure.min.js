/*! disfigure v0.0.12 */
import*as t from"three";import{Vector3 as e,Mesh as s,Group as o,Box3 as a,MeshPhysicalNodeMaterial as i}from"three";import{GLTFLoader as n}from"three/addons/loaders/GLTFLoader.js";import{Fn as r,mat3 as l,vec3 as u,If as h,uniform as m,normalGeometry as g,float as c,transformNormalToView as p,positionGeometry as L,min as d}from"three/tsl";import{SimplexNoise as f}from"three/addons/math/SimplexNoise.js";import{OrbitControls as v}from"three/addons/controls/OrbitControls.js";const w=r((([t])=>{var e=t.cos().toVar(),s=t.sin().toVar();return l(1,0,0,0,e,s,0,s.negate(),e)})).setLayout({name:"matRotX",type:"mat3",inputs:[{name:"angle",type:"float"}]}),y=r((([t])=>{var e=t.cos().toVar(),s=t.sin().toVar();return l(e,0,s.negate(),0,1,0,s,0,e)})).setLayout({name:"matRotY",type:"mat3",inputs:[{name:"angle",type:"float"}]}),R=r((([t])=>{var e=t.cos().toVar(),s=t.sin().toVar();return l(e,s,0,s.negate(),e,0,0,0,1)})).setLayout({name:"matRotZ",type:"mat3",inputs:[{name:"angle",type:"float"}]});r((([t])=>{var e=w(t.x),s=y(t.y),o=R(t.z);return s.mul(e).mul(o)})).setLayout({name:"matRotYXZ",type:"mat3",inputs:[{name:"angles",type:"vec3"}]});const x=r((([t])=>{var e=w(t.x),s=y(t.y),o=R(t.z);return s.mul(o).mul(e)})).setLayout({name:"matRotYZX",type:"mat3",inputs:[{name:"angles",type:"vec3"}]});r((([t])=>{var e=w(t.x),s=y(t.y),o=R(t.z);return e.mul(s).mul(o)})).setLayout({name:"matRotXYZ",type:"mat3",inputs:[{name:"angles",type:"vec3"}]});const b=r((([t])=>{var e=w(t.x),s=y(t.y),o=R(t.z);return e.mul(o).mul(s)})).setLayout({name:"matRotXZY",type:"mat3",inputs:[{name:"angles",type:"vec3"}]});r((([t])=>{var e=w(t.x),s=y(t.y);return R(t.z).mul(e).mul(s)})).setLayout({name:"matRotZXY",type:"mat3",inputs:[{name:"angles",type:"vec3"}]}),r((([t])=>{var e=w(t.x),s=y(t.y);return R(t.z).mul(s).mul(e)})).setLayout({name:"matRotZYX",type:"mat3",inputs:[{name:"angles",type:"vec3"}]});const k=r((([t,e,s])=>s.smoothstep(t,e).smoothstep(0,1).smoothstep(0,1))).setLayout({name:"smoother",type:"float",inputs:[{name:"edgeFrom",type:"float"},{name:"edgeTo",type:"float"},{name:"value",type:"float"}]});r((()=>u(1))),new f;var Y=r((([t,e,s,o])=>t.sub(e).mul(x(s.mul(o))).add(e))).setLayout({name:"jointRotate",type:"vec3",inputs:[{name:"pos",type:"vec3"},{name:"center",type:"vec3"},{name:"angle",type:"vec3"},{name:"amount",type:"float"}]}),X=r((([t,e,s,o])=>t.sub(e).mul(b(s.mul(o))).add(e).toVar())).setLayout({name:"jointRotate2",type:"vec3",inputs:[{name:"pos",type:"vec3"},{name:"center",type:"vec3"},{name:"angle",type:"vec3"},{name:"amount",type:"float"}]});function z(t){return t.vertex=L,t.mode=c(1),N(t)}function S(t){return t.vertex=g,t.mode=c(0),p(N(t)).xyz}var N=r((({space:t,posture:e,mode:s,vertex:o})=>{var a=o.toVar(),i=t.armLeft.locus().toVar();h(i.greaterThan(0),(()=>{a.assign(Y(a,s.mul(t.wristLeft.pivot),e.wristLeft,t.wristLeft.locus())),a.assign(Y(a,s.mul(t.forearmLeft.pivot),e.forearmLeft,t.forearmLeft.locus())),a.assign(Y(a,s.mul(t.elbowLeft.pivot),e.elbowLeft,t.elbowLeft.locus())),a.assign(X(a,s.mul(t.armLeft.pivot),e.armLeft,t.armLeft.locus()))}));var n=t.armRight.locus().toVar();h(n.greaterThan(0),(()=>{a.assign(Y(a,s.mul(t.wristRight.pivot),e.wristRight,t.wristRight.locus())),a.assign(Y(a,s.mul(t.forearmRight.pivot),e.forearmRight,t.forearmRight.locus())),a.assign(Y(a,s.mul(t.elbowRight.pivot),e.elbowRight,t.elbowRight.locus())),a.assign(X(a,s.mul(t.armRight.pivot),e.armRight,t.armRight.locus()))})),a.assign(Y(a,s.mul(t.head.pivot),e.head,t.head.locus())),a.assign(Y(a,s.mul(t.chest.pivot),e.chest,t.chest.locus())),a.assign(Y(a,s.mul(t.waist.pivot),e.waist,t.waist.locus()));var r=t.legLeft.locus().toVar();h(r.greaterThan(0),(()=>{a.assign(Y(a,s.mul(t.footLeft.pivot),e.footLeft,t.footLeft.locus())),a.assign(Y(a,s.mul(t.ankleLeft.pivot),e.ankleLeft,t.ankleLeft.locus())),a.assign(Y(a,s.mul(t.ankleLongLeft.pivot),e.ankleLongLeft,t.ankleLongLeft.locus())),a.assign(Y(a,s.mul(t.kneeLeft.pivot),e.kneeLeft,t.kneeLeft.locus())),a.assign(Y(a,s.mul(t.legLongLeft.pivot),e.legLongLeft,t.legLongLeft.locus())),a.assign(Y(a,s.mul(t.legLeft.pivot),e.legLeft,r))}));var l=t.legRight.locus().toVar();return h(l.greaterThan(0),(()=>{a.assign(Y(a,s.mul(t.footRight.pivot),e.footRight,t.footRight.locus())),a.assign(Y(a,s.mul(t.ankleRight.pivot),e.ankleRight,t.ankleRight.locus())),a.assign(Y(a,s.mul(t.ankleLongRight.pivot),e.ankleLongRight,t.ankleLongRight.locus())),a.assign(Y(a,s.mul(t.kneeRight.pivot),e.kneeRight,t.kneeRight.locus())),a.assign(Y(a,s.mul(t.legLongRight.pivot),e.legLongRight,t.legLongRight.locus())),a.assign(Y(a,s.mul(t.legRight.pivot),e.legRight,l))})),a}));function M(t,e,s=0){return e*t/1e3+s}function C(t,s){return new e(M(t[0],s.scale,s.x),M(t[1],s.scale,s.y),M(t[2],s.scale,s.z))}function P(t){var e=Object.assign(Object.create(t),t);return e.pivot=e.pivot.clone(),e.pivot.x*=-1,e}class T{constructor(t,e,s,o=0,a){this.pivot=C(e,t),this.minY=M(s[0],t.scale,t.y),this.maxY=M(s[1],t.scale,t.y),a&&(this.minX=M(a[0],t.scale,t.x),this.maxX=M(a[1],t.scale,t.x)),this.slope=Math.tan((90-o)*Math.PI/180)}mirror(){var t=P(this);return"minX"in t&&(t.minX*=-1,t.maxX*=-1),t}locus(t=L){var e=t.x,s=t.y,o=t.z;0!=this.angle&&(s=s.add(o.sub(this.pivot.z).div(this.slope)));var a=k(this.minY,this.maxY,s);return"minX"in this&&(a=a.max(k(this.minX,this.maxX,e.abs().add(s.sub(this.pivot.y))))),a}}class _{constructor(t,e,s,o=0){this.pivot=C(e,t),this.minX=M(s[0],t.scale,t.x),this.maxX=M(s[1],t.scale,t.x),this.slope=Math.tan((90-o)*Math.PI/180)}mirror(){var t=P(this);return t.minX*=-1,t.maxX*=-1,t}locus(t=L){var e=t.x,s=t.z,o=c(this.minX),a=c(this.maxX);if(0!=this.angle){var i=s.sub(this.pivot.z).div(this.slope).max(.01).mul(e.sign());o=o.sub(i),a=a.add(i)}return k(o,a,e)}}class j extends _{constructor(t,e,s,o){super(t,e,s),this.minY=M(o[0],t.scale,t.y),this.maxY=M(o[1],t.scale,t.y)}locus(t=L){var e=t.x,s=t.y,o=t.y.sub(this.pivot.y).div(4,e.sign()),a=.8;return c(1).mul(k(c(this.minX).sub(o),c(this.maxX).sub(o),e)).mul(d(k(this.minY,this.minY*a+(1-a)*this.maxY,s),k(this.maxY,this.maxY*a+(1-a)*this.minY,s))).pow(2)}}class E extends j{constructor(t,e,s,o,a=0){super(t,e,s,o),this.grown=a}locus(t=L){var e=t.x,s=t.z;if(0==this.grown)var o=t.y.sub(e.abs().mul(.2)).add(s.mul(1/6)),a=u(t.x.mul(2),t.y,t.z.min(0)).sub(u(0,this.pivot.y,0)).length().smoothstep(0,.13).pow(10);else o=t.y.sub(e.abs().mul(.2)).add(s.abs().mul(.5)),a=u(t.x.mul(2),t.y,t.z.min(0)).sub(u(0,this.pivot.y,0)).length().smoothstep(0,.065).pow(10);return c(a).mul(e.smoothstep(this.minX,this.maxX),k(this.minY,this.maxY,o).pow(2))}}class A{constructor(t,e){const s={LocusT:E,LocusX:_,LocusXY:j,LocusY:T};for(var o in e)if("_"!=o){var a=s[e[o].shift()];e[o]=new a(t,...e[o])}this._=e._,this.head=e.head,this.chest=e.chest,this.waist=e.waist,this.kneeLeft=e?.kneeLeft??e.knee,this.kneeRight=e?.kneeRight??e.knee.mirror(),this.ankleLeft=e?.ankleLeft??e.ankle,this.ankleRight=e?.ankleRight??e.ankle.mirror(),this.ankleLongLeft=e?.ankleLongLeft??e.ankleLong,this.ankleLongRight=e?.ankleLongRight??e.ankleLong.mirror(),this.legLongLeft=e?.legLongLeft??e.legLong,this.legLongRight=e?.legLongRight??e.legLong.mirror(),this.footLeft=e?.footLeft??e.foot,this.footRight=e?.footRight??e.foot.mirror(),this.legLeft=e?.legLeft??e.leg,this.legRight=e?.legRight??e.leg.mirror(),this.elbowLeft=e?.elbowLeft??e.elbow,this.elbowRight=e?.elbowRight??e.elbow.mirror(),this.forearmLeft=e?.forearmLeft??e.forearm,this.forearmRight=e?.forearmRight??e.forearm.mirror(),this.wristLeft=e?.wristLeft??e.wrist,this.wristRight=e?.wristRight??e.wrist.mirror(),this.armLeft=e?.armLeft??e.arm,this.armRight=e?.armRight??e.arm.mirror()}}var V=Object.freeze({__proto__:null,SPACE:{head:["LocusY",[0,878,-37],[838,923],30],chest:["LocusY",[0,661,-8],[438,929],0,[40,300]],waist:["LocusY",[0,570,-9],[310,840]],leg:["LocusT",[41,546,-19],[-2,2],[690,441]],legLong:["LocusY",[39,0,-19],[700,140]],knee:["LocusY",[50,286,-23],[341,218],20],ankle:["LocusY",[41,51,-1],[97,10],-10],ankleLong:["LocusY",[51,206,-29],[430,-10]],foot:["LocusY",[0,20,12],[111,-185],120],elbow:["LocusX",[238,815,-40],[230,260],0],forearm:["LocusX",[170,815,-38],[46,490]],wrist:["LocusX",[375,820,-40],[354,402]],arm:["LocusXY",[85,790,-40],[30,150],[600,900]]},URL:"man.glb"}),O=Object.freeze({__proto__:null,SPACE:{head:["LocusY",[0,872,-30],[827,919],30],chest:["LocusY",[0,661,-8],[438,929],0,[40,300]],waist:["LocusY",[0,570,-9],[350,840]],leg:["LocusT",[41,546,-19],[-2,2],[690,441]],legLong:["LocusY",[44,0,-19],[700,140]],knee:["LocusY",[50,286,-23],[341,218],20],ankle:["LocusY",[44,51,-4],[97,10],-10],ankleLong:["LocusY",[51,201,-29],[430,-33]],foot:["LocusY",[0,20,12],[111,-185],120],elbow:["LocusX",[238,815,-40],[230,260],0],forearm:["LocusX",[170,815,-38],[54,475]],wrist:["LocusX",[359,815,-34],[343,380]],arm:["LocusXY",[80,793,-40],[30,137],[600,900]]},URL:"woman.glb"}),Z=Object.freeze({__proto__:null,SPACE:{head:["LocusY",[0,850,-32],[807,894],30],chest:["LocusY",[0,640,1],[419,914],0,[40,300]],waist:["LocusY",[0,530,-7],[285,836]],leg:["LocusT",[40,521,-9],[-1,1],[625,430],1],legLong:["LocusY",[46,0,-5],[700,140]],knee:["LocusY",[50,288,-12],[346,221],20],ankle:["LocusY",[54,48,-14],[81,33],-10],ankleLong:["LocusY",[51,201,-25],[430,-33]],foot:["LocusY",[0,20,6],[83,-200],120],elbow:["LocusX",[249,793,-56],[230,273],0],forearm:["LocusX",[170,794,-59],[54,475]],wrist:["LocusX",[398,802,-57],[384,409]],arm:["LocusXY",[80,793,-40],[30,137],[600,900]]},URL:"child.glb"});const U=2*Math.PI;var W,B,I,F,G,H,D,q=new n,J=[];function K(t){return(t=(t=(t%360+360)%360)>180?t-360:t)*U/360}class Q extends t.Group{constructor(n){super(),this.castShadow=!0,this.receiveShadow=!0,this.dims={},this.posture=(n.SPACE,{head:m(u(0,0,0)),chest:m(u(0,0,0)),waist:m(u(0,0,0)),kneeLeft:m(u(0,0,0)),kneeRight:m(u(0,0,0)),ankleLeft:m(u(0,0,0)),ankleRight:m(u(0,0,0)),footLeft:m(u(0,0,0)),footRight:m(u(0,0,0)),legLeft:m(u(0,0,0)),legLongLeft:m(u(0,0,0)),legRight:m(u(0,0,0)),legLongRight:m(u(0,0,0)),ankleLongLeft:m(u(0,0,0)),ankleLongRight:m(u(0,0,0)),elbowLeft:m(u(0,0,0)),elbowRight:m(u(0,0,0)),forearmLeft:m(u(0,0,0)),forearmRight:m(u(0,0,0)),wristLeft:m(u(0,0,0)),wristRight:m(u(0,0,0)),armLeft:m(u(0,0,0)),armRight:m(u(0,0,0))}),q.load("../assets/models/"+n.URL,(r=>{var l=function(t){var a=[];t.traverse((t=>{if(t.isMesh){var o=t.geometry.clone().applyMatrix4(t.matrixWorld),i=t.material.clone();if(t.isSkinnedMesh){t.pose();for(var n=o.getAttribute("position"),r=o.getAttribute("normal"),l=new e,u=0;u<n.count;u++)l.fromBufferAttribute(n,u),t.applyBoneTransform(u,l),n.setXYZ(u,...l),l.fromBufferAttribute(r,u),t.applyBoneTransform(u,l),r.setXYZ(u,...l)}var h=new s(o,i);h.frustumCulled=!1,a.push(h)}}));var i=new o;return i.add(...a),i}(r.scene);!function(t,s){var o=new e,i=(new a).setFromObject(t,!0);i.getCenter(o),t.position.sub(o),s.x=(i.max.x+i.min.x)/2,s.y=i.min.y,s.z=(i.max.z+i.min.z)/2,s.scale=Math.max(i.max.x-i.min.x,i.max.y-i.min.y,i.max.z-i.min.z)}(l,this.dims),function(t,e,s,o,a){t.traverse((t=>{if(t.isMesh){var n=new i;Object.assign(n,t.material),Object.assign(n,a),o.colorNode&&(n.colorNode=o.colorNode()),o.positionNode&&(n.positionNode=o.positionNode({space:e,posture:s})),o.normalNode&&(n.normalNode=o.normalNode({space:e,posture:s})),o.emissiveNode&&(n.emissiveNode=o.emissiveNode({space:e,posture:s})),t.material=n,t.castShadow=!0,t.receiveShadow=!0}}))}(l,new A(this.dims,n.SPACE),this.posture,{positionNode:z,normalNode:S},{color:new t.Color(16699833),metalness:0,roughness:.6}),l.position.y=-this.dims.y/2,l.castShadow=!0,l.receiveShadow=!0,this.add(l),J.push(this)}))}head(t,e=0,s=0){this.posture.head.value.set(t,e,s)}get headNod(){return this.posture.head.value.x}set headNod(t){this.posture.head.value.x=K(t)}get headSpin(){return this.posture.head.value.y}set headSpin(t){this.posture.head.value.y=K(t)}get headTilt(){return this.posture.head.value.z}set headTilt(t){this.posture.head.value.z=K(t)}get waistNod(){return this.posture.waist.value.x}set waistNod(t){this.posture.waist.value.x=K(t)}get waistSpin(){return this.posture.waist.value.y}set waistSpin(t){this.posture.waist.value.y=K(t)}}class $ extends Q{constructor(){super(V),this.posture.legLeft.value.z=-.1,this.posture.legRight.value.z=.1,this.posture.ankleLeft.value.z=.1,this.posture.ankleRight.value.z=-.1}}class tt extends Q{constructor(){super(O),this.posture.legLeft.value.z=.05,this.posture.legRight.value.z=-.05}}class et extends Q{constructor(){super(Z)}}function st(e){if((W=new t.WebGPURenderer({antialias:!0})).setSize(innerWidth,innerHeight),W.shadowMap.enabled=!0,W.shadowMap.type=t.PCFSoftShadowMap,document.body.appendChild(W.domElement),document.body.style.overflow="hidden",document.body.style.margin="0",(B=new t.Scene).background=new t.Color("whitesmoke"),(I=new t.PerspectiveCamera(30,innerWidth/innerHeight)).position.set(0,1,4),I.lookAt(0,1,0),(e?.lights??1)&&((F=new t.DirectionalLight("white",2)).decay=0,F.position.set(0,2,1).setLength(15),F.shadow.mapSize.width=2048,F.shadow.mapSize.height=F.shadow.mapSize.width,F.shadow.camera.near=1,F.shadow.camera.far=50,F.shadow.camera.left=-5,F.shadow.camera.right=5,F.shadow.camera.top=5,F.shadow.camera.bottom=-5,F.shadow.normalBias=.01,F.autoUpdate=!1,F.castShadow=!0,B.add(F),(G=new t.DirectionalLight("white",2)).decay=0,G.target=B,I.add(G),B.add(I)),(e?.controls??1)&&((H=new v(I,W.domElement)).enableDamping=!0,H.target.set(0,.8,0)),e?.ground??1){var s=document.createElement("CANVAS");s.width=128,s.height=128;var o=s.getContext("2d");o.fillStyle="white",o.filter="blur(10px)",o.beginPath(),o.arc(64,64,37.5,0,2*Math.PI),o.fill();var a=new t.Mesh(new t.CircleGeometry(50),new t.MeshLambertMaterial({color:"antiquewhite",transparent:!0,map:new t.CanvasTexture(s)}));a.receiveShadow=!0,a.rotation.x=-Math.PI/2,a.renderOrder=-1,B.add(a)}window.addEventListener("resize",(()=>{I.aspect=innerWidth/innerHeight,I.updateProjectionMatrix(),W.setSize(innerWidth,innerHeight)})),W.setAnimationLoop(at)}class ot extends Event{#t;constructor(t){super(t)}get target(){return this.#t}set target(t){this.#t=t}}function at(){var t=new Event("animate");window.dispatchEvent(t),t=new ot("animate"),J.forEach((e=>{t.target=e,e.dispatchEvent(t)})),D&&D(t.timeStamp),H&&H.update(),W.render(B,I)}function it(t){D=t}export{et as Child,$ as Man,tt as Woman,I as camera,G as cameraLight,H as controls,J as everybody,F as light,W as renderer,B as scene,it as setAnimationLoop,st as world};
