/*! disfigure v0.0.19 */
import{WebGPURenderer as t,PCFSoftShadowMap as e,Scene as s,Color as i,PerspectiveCamera as r,DirectionalLight as h,Mesh as a,CircleGeometry as n,MeshLambertMaterial as o,CanvasTexture as l,Vector3 as c,Matrix3 as d,Matrix4 as w,Euler as m,PlaneGeometry as _,MeshPhysicalNodeMaterial as p,Group as u}from"three";import{GLTFLoader as g}from"three/addons/loaders/GLTFLoader.js";import{Fn as f,mix as v,If as b,normalGeometry as x,transformNormalToView as y,positionGeometry as k,min as z,vec3 as S,float as E,select as H,vec2 as P,uniform as L}from"three/tsl";import{SimplexNoise as M}from"three/addons/math/SimplexNoise.js";import{OrbitControls as X}from"three/addons/controls/OrbitControls.js";import j from"three/addons/libs/stats.module.js";var I=new M;function A(t,e=0,s=-1,i=1){return s+(i-s)*(I.noise(t,e)+1)/2}function C(t,e=0,s=-1,i=1){return s+(i-s)*(Math.sin(t+e)+1)/2}function Y(t=-1,e=1){return t+(e-t)*Math.random()}var T=f((([t,e,s,i])=>{var r=t.sub(e).mul(s).add(e);return v(t,r,i)})),R=f((([t,e,s,i])=>{var r=t.mul(s);return v(t,r,i)}));function U(t){return t.vertex=x,t.fn=R,y(V(t))}var G,N,W,F,O,Z,q,B,D,V=f((({fn:t,space:e,joints:s,vertex:i})=>{var r=i.toVar();function h(i){for(var h of i)r.assign(t(r,e[h].pivot,s[h].matrix,e[h].locus()))}return b(e.l_arm.locus(),(()=>{h(["l_wrist","l_forearm","l_elbow","l_arm"])})),b(e.r_arm.locus(),(()=>{h(["r_wrist","r_forearm","r_elbow","r_arm"])})),b(e.l_leg.locus(),(()=>{h(["l_foot","l_ankle","l_shin","l_knee","l_thigh","l_leg"])})),b(e.r_leg.locus(),(()=>{h(["r_foot","r_ankle","r_shin","r_knee","r_thigh","r_leg"])})),h(["head","chest","waist","torso"]),r})),J=[];class K{constructor(c){if((G=new t({antialias:!0})).setSize(innerWidth,innerHeight),G.shadowMap.enabled=c?.shadows??!0,G.shadowMap.type=e,document.body.appendChild(G.domElement),document.body.style.overflow="hidden",document.body.style.margin="0",(N=new s).background=new i("whitesmoke"),(W=new r(30,innerWidth/innerHeight)).position.set(0,1.5,4),c?.stats&&(D=new j,document.body.appendChild(D.dom)),(c?.lights??1)&&((F=new h("white",1.5)).position.set(0,14,7),(c?.shadows??1)&&(F.shadow.mapSize.width=2048,F.shadow.mapSize.height=F.shadow.mapSize.width,F.shadow.camera.near=1,F.shadow.camera.far=50,F.shadow.camera.left=-5,F.shadow.camera.right=5,F.shadow.camera.top=5,F.shadow.camera.bottom=-5,F.shadow.normalBias=.01,F.autoUpdate=!1,F.castShadow=!0),N.add(F),(O=new h("white",1.5)).target=N,W.add(O),N.add(W)),(c?.controls??1)&&((Z=new X(W,G.domElement)).enableDamping=!0,Z.target.set(0,.9,0)),c?.ground??1){var d=document.createElement("CANVAS");d.width=128,d.height=128;var w=d.getContext("2d");w.fillStyle="white",w.filter="blur(10px)",w.beginPath(),w.arc(64,64,38,0,2*Math.PI),w.fill(),(q=new a(new n(32),new o({color:"antiquewhite",transparent:!0,map:new l(d)}))).receiveShadow=!0,q.rotation.x=-Math.PI/2,q.renderOrder=-1,N.add(q)}window.addEventListener("resize",(()=>{W.aspect=innerWidth/innerHeight,W.updateProjectionMatrix(),G.setSize(innerWidth,innerHeight)})),G.setAnimationLoop(tt)}}class Q extends Event{#t;constructor(){super("animate")}get target(){return this.#t}set target(t){this.#t=t}}var $=new Q;function tt(t){try{$.time=t,window.dispatchEvent($),J.forEach((t=>{t.update(),t.dispatchEvent($)})),B&&B(t),Z&&Z.update(),D&&D.update(),G.render(N,W)}catch(t){throw G.setAnimationLoop(null),t}}function et(t){B=t}console.time("TSL");var st=0,it=document.getElementById("spinner");it&&setTimeout((()=>it.style.display="none"),1e4);const rt=f((([t,e])=>e.smoothstep(t.x,t.y).smoothstep(0,1).smoothstep(0,1)),{edge:"vec2",value:"float",return:"float"});var ht=f((([t,e,s,i])=>{var r=t.y,h=t.z;return r=r.add(h.sub(e.z).div(i)),rt(s,r)}),{pos:"vec3",pivot:"vec3",rangeY:"vec2",slope:"float",return:"float"}),at=f((([t,e])=>rt(e,t.x)),{pos:"vec3",rangeX:"vec2",return:"float"}),nt=f((([t,e,s,i])=>{var r=t.x,h=t.y,a=h.sub(e.y).div(4,r.sign());return rt(s,r.add(a)).mul(z(h.smoothstep(i.x,v(i.x,i.y,.2)),h.smoothstep(i.y,v(i.y,i.x,.2)))).pow(2)}),{pos:"vec3",pivot:"vec3",rangeX:"vec2",rangeY:"vec2",return:"float"}),ot=f((([t,e,s,i,r])=>{var h=t.x,a=t.y,n=t.z,o=S(h.mul(2),a,n.min(0)).sub(S(0,e.y,0)).length().smoothstep(0,E(.13).div(E(r).add(1))).pow(10),l=a.sub(h.abs().mul(.2));return l=l.add(H(r.equal(1),n.abs().mul(.5),n.mul(1/6))),o.mul(h.smoothstep(s.x,s.y),rt(i,l).pow(2))}),{pos:"vec3",pivot:"vec3",rangeX:"vec2",rangeY:"vec2",grown:"float",return:"float"});class lt{constructor(t){this.pivot=new c(...t),this.isRight=!1}mirror(){return this.isRight=!0,this.pivot.x*=-1,this.rangeX&&(this.rangeX.value.x*=-1,this.rangeX.value.y*=-1),this}}class ct extends lt{constructor(t,e,s=0){super(t),this.rangeY=P(...e),this.slope=Math.tan((90-s)*Math.PI/180)}locus(){return ht(k,this.pivot,this.rangeY,this.slope)}}class dt extends lt{constructor(t,e){super(t),this.rangeX=P(...e)}locus(){return at(k,this.rangeX)}}class wt extends dt{constructor(t,e,s){super(t,e),this.rangeY=P(...s)}locus(){return st++,it&&st>=12*J.length&&(console.timeLog("TSL",st),it.style.display="none"),nt(k,this.pivot,this.rangeX,this.rangeY)}}class mt extends wt{constructor(t,e,s,i=0){super(t,e,s),this.grown=i}locus(){return ot(k,this.pivot,this.rangeX,this.rangeY,this.grown)}}class _t{constructor(t){this.head=new ct(...t.head),this.chest=new ct(...t.chest),this.waist=new ct(...t.waist),this.torso=new ct(...t.torso),this.l_knee=new ct(...t.knee),this.r_knee=new ct(...t.knee).mirror(),this.l_ankle=new ct(...t.ankle),this.r_ankle=new ct(...t.ankle).mirror(),this.l_shin=new ct(...t.shin),this.r_shin=new ct(...t.shin).mirror(),this.l_thigh=new ct(...t.thigh),this.r_thigh=new ct(...t.thigh).mirror(),this.l_foot=new ct(...t.foot),this.r_foot=new ct(...t.foot).mirror(),this.l_leg=new mt(...t.leg),this.r_leg=new mt(...t.leg).mirror(),this.l_elbow=new dt(...t.elbow),this.r_elbow=new dt(...t.elbow).mirror(),this.l_forearm=new dt(...t.forearm),this.r_forearm=new dt(...t.forearm).mirror(),this.l_wrist=new dt(...t.wrist),this.r_wrist=new dt(...t.wrist).mirror(),this.l_arm=new wt(...t.arm),this.r_arm=new wt(...t.arm).mirror()}}var pt=new g;const ut=import.meta.url.replace("/src/body.js","/assets/models/");var gt=new d,ft=new d,vt=new c;function bt(t,e,s){Object.defineProperty(t,e,{get:()=>180*t.angle[s]/Math.PI,set(e){t.angle[s]=e*Math.PI/180}})}class xt{constructor(t,e,s,i="xyz"){this.model=t,this.parent=e,this.space=s,this.angle=new c,this.matrix=L(new d),bt(this,"bend",i[0]),bt(this,"raise",i[0]),bt(this,"tilt",i[2]),bt(this,"straddle",i[2]),bt(this,"foreward",i[0]),bt(this,"turn",i[1])}attach(t){t.parent&&(t=t.clone());var e=new u;e.add(t),e.matrixAutoUpdate=!1,e.joint=this,this.model.add(e),this.model.accessories.push(e)}}var yt=new w,kt=new m,zt=new _,St=1;class Et extends a{constructor(t,e,s,i){var r;super(zt),this.url=t,this.uid=St,St+=.3+2*Math.random(),this.castShadow=!0,this.receiveShadow=!0,this.accessories=[],this.height=s??i,this.scale.setScalar(this.height/i),pt.load(this.url,(t=>{this.geometry=t.scene.children[0].geometry})),this.space=new _t(e),this.torso=new xt(this,null,this.space.torso),this.waist=new xt(this,this.torso,this.space.waist),this.chest=new xt(this,this.waist,this.space.chest),this.head=new xt(this,this.chest,this.space.head),this.l_leg=new xt(this,this.torso,this.space.l_leg),this.l_thigh=new xt(this,this.l_leg,this.space.l_thigh),this.l_knee=new xt(this,this.l_thigh,this.space.l_knee),this.l_shin=new xt(this,this.l_knee,this.space.l_shin),this.l_ankle=new xt(this,this.l_shin,this.space.l_ankle),this.l_foot=new xt(this,this.l_ankle,this.space.l_foot),this.r_leg=new xt(this,this.torso,this.space.r_leg),this.r_thigh=new xt(this,this.r_leg,this.space.r_thigh),this.r_knee=new xt(this,this.r_thigh,this.space.r_knee),this.r_shin=new xt(this,this.r_knee,this.space.r_shin),this.r_ankle=new xt(this,this.r_shin,this.space.r_ankle),this.r_foot=new xt(this,this.r_ankle,this.space.r_foot),this.l_arm=new xt(this,this.chest,this.space.l_arm,"yxz"),this.l_elbow=new xt(this,this.l_arm,this.space.l_elbow,"yxz"),this.l_forearm=new xt(this,this.l_elbow,this.space.l_forearm,"zxy"),this.l_wrist=new xt(this,this.l_forearm,this.space.l_wrist,"zxy"),this.r_arm=new xt(this,this.chest,this.space.r_arm,"yxz"),this.r_elbow=new xt(this,this.r_arm,this.space.r_elbow,"yxz"),this.r_forearm=new xt(this,this.r_elbow,this.space.r_forearm,"zxy"),this.r_wrist=new xt(this,this.r_forearm,this.space.r_wrist,"zxy"),this.material=new p({positionNode:(r={space:this.space,joints:this},r.vertex=k,r.fn=T,V(r)),normalNode:U({space:this.space,joints:this}),colorNode:S(.99,.65,.49),metalness:0,roughness:.6}),this.position.y=0,this.castShadow=!0,this.receiveShadow=!0,J.push(this),N&&N.add(this),this.l_arm.straddle=this.r_arm.straddle=65,this.l_elbow.bend=this.r_elbow.bend=20}update(){function t(t,e,i,r){kt.set(e*t.angle.x,i*t.angle.y,r*t.angle.z,"YZX"),s(t)}function e(t,e,i,r){kt.set(0,0,r*t.angle.z),kt.reorder("YZX"),kt.set(0,i*t.angle.y,kt.z),kt.reorder("XYZ"),kt.set(kt.x+e*t.angle.x,kt.y,kt.z),s(t)}function s(t){yt.makeRotationFromEuler(kt);var e=yt.elements;t.matrix.value.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10])}for(var i of(t(this.head,-1,-1,1),t(this.chest,-1,-1,1),t(this.waist,-1,-1,1),t(this.torso,-1,-1,1),t(this.l_elbow,0,1,0),t(this.r_elbow,0,-1,0),t(this.l_wrist,0,1,1),t(this.r_wrist,0,-1,-1),t(this.l_forearm,-1,0,0),t(this.r_forearm,-1,0,0),e(this.l_arm,-1,1,1),e(this.r_arm,-1,-1,-1),t(this.l_knee,-1,0,1),t(this.r_knee,-1,0,-1),t(this.l_ankle,-1,0,-1),t(this.r_ankle,-1,0,1),t(this.l_shin,0,-1,0),t(this.r_shin,0,1,0),t(this.l_foot,-1,0,0),t(this.r_foot,-1,0,0),t(this.l_thigh,0,-1,0),t(this.r_thigh,0,1,0),e(this.l_leg,1,0,-1),e(this.r_leg,1,0,1),this.accessories)){var r=i.joint;for(ft.identity(),vt.copy(r.space.pivot);r;r=r.parent)gt.copy(r.matrix.value).transpose(),ft.premultiply(gt),vt.sub(r.space.pivot).applyMatrix3(gt).add(r.space.pivot);i.matrix.setFromMatrix3(ft),i.matrix.setPosition(vt)}}}class Ht extends Et{static URL="man.glb";static HEIGHT=1.795;static SPACE={head:[[0,1.566,-.066],[1.495,1.647],30],chest:[[0,1.177,-.014],[.777,1.658],0,[.072,.538]],waist:[[0,1.014,-.016],[.547,1.498]],torso:[[0,1.014,-.016],[-3,-2]],leg:[[.074,.97,-.034],[-.004,.004],[1.229,.782]],thigh:[[.07,-.009,-.034],[1.247,.242]],knee:[[.09,.504,-.041],[.603,.382],20],ankle:[[.074,.082,-.002],[.165,.008],-10],shin:[[.092,.36,-.052],[.762,-.027]],foot:[[0,.026,.022],[.19,-.342],120],elbow:[[.427,1.453,-.072],[.413,.467]],forearm:[[.305,1.453,-.068],[.083,.879]],wrist:[[.673,1.462,-.072],[.635,.722]],arm:[[.153,1.408,-.072],[.054,.269],[1.067,1.616]]};constructor(t){super(ut+Ht.URL,Ht.SPACE,t,Ht.HEIGHT),this.l_leg.straddle=this.r_leg.straddle=5,this.l_ankle.tilt=this.r_ankle.tilt=-5,this.l_ankle.bend=this.r_ankle.bend=3}}class Pt extends Et{static URL="woman.glb";static HEIGHT=1.691;static SPACE={head:[[.001,1.471,-.049],[1.395,1.551],30],chest:[[.001,1.114,-.012],[.737,1.568],0,[.069,.509]],waist:[[.001,.961,-.014],[.589,1.417]],torso:[[.001,.961,-.014],[-1.696,-1.694]],leg:[[.071,.92,-.031],[-.002,.005],[1.163,.742]],thigh:[[.076,-.003,-.031],[1.18,.233]],knee:[[.086,.48,-.037],[.573,.365],20],shin:[[.088,.337,-.047],[.724,-.059]],ankle:[[.076,.083,-.005],[.161,.014],-10],foot:[[.001,.031,.022],[.184,-.316],120],elbow:[[.404,1.375,-.066],[.39,.441]],forearm:[[.289,1.375,-.063],[.093,.805]],wrist:[[.608,1.375,-.056],[.581,.644]],arm:[[.137,1.338,-.066],[.052,.233],[1.011,1.519]]};constructor(t){super(ut+Pt.URL,Pt.SPACE,t,Pt.HEIGHT),this.l_leg.straddle=this.r_leg.straddle=-2.9,this.l_ankle.tilt=this.r_ankle.tilt=2.9,this.l_ankle.bend=this.r_ankle.bend=3}}class Lt extends Et{static URL="child.glb";static HEIGHT=1.352;static SPACE={head:[[0,1.149,-.058],[1.091,1.209],30],chest:[[0,.865,-.013],[.566,1.236],0,[.054,.406]],waist:[[0,.717,-.024],[.385,1.13]],torso:[[0,.717,-.024],[-1.354,-1.353]],leg:[[.054,.704,-.027],[-.001,.001],[.845,.581],1],thigh:[[.062,-0,-.021],[.946,.189]],knee:[[.068,.389,-.031],[.468,.299],20],shin:[[.069,.272,-.048],[.581,-.045]],ankle:[[.073,.065,-.033],[.109,.044],-10],foot:[[0,.027,-.006],[.112,-.271],120],elbow:[[.337,1.072,-.09],[.311,.369]],forearm:[[.23,1.074,-.094],[.073,.642]],wrist:[[.538,1.084,-.091],[.519,.553]],arm:[[.108,1.072,-.068],[.041,.185],[.811,1.217]]};constructor(t){super(ut+Lt.URL,Lt.SPACE,t,Lt.HEIGHT),this.l_ankle.bend=this.r_ankle.bend=3}}console.log("\n%c⋮⋮⋮ Disfigure\n%chttps://boytchev.github.io/disfigure/\n","color: navy","font-size:80%");export{Lt as Child,Ht as Man,Pt as Woman,K as World,W as camera,O as cameraLight,A as chaotic,Z as controls,J as everybody,q as ground,F as light,Y as random,C as regular,G as renderer,N as scene,et as setAnimationLoop};
