<!DOCTYPE html>


<html>


<head>
	<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">

	<link rel="shortcut icon" href="../../assets/logo/favicon.ico" type="image/x-icon">
	<link rel="icon" href="../../assets/logo/favicon.ico" type="image/x-icon">
	
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">

	<link rel="stylesheet" href="styles.css">
	
	<script type="importmap">
	  {
		"imports": {
			"three": "https://cdn.jsdelivr.net/npm/three@0.176.0/build/three.webgpu.min.js",
			"three/webgpu": "https://cdn.jsdelivr.net/npm/three@0.176.0/build/three.webgpu.min.js",
			"three/tsl": "https://cdn.jsdelivr.net/npm/three@0.176.0/build/three.tsl.min.js",
			"three/addons/": "https://cdn.jsdelivr.net/npm/three@0.176.0/examples/jsm/",
			"disfigure": "../../src/disfigure.js",
			"disfigure/": "../../src/"
		}
	  }
	</script>
</head>


<body>
	<header>
		<h1><b>Disfigure</b> Posture Editor</h1>
		<h3> This is a WIP prototype, sources available at <a href="https://boytchev.github.io/disfigure/">Github</a>.</br>
		<span id="credits1"></span><!--br>
		and <span id="credits2"></span-->.</h3>
	</header>

	
	<script type="module">

import * as THREE from "three";
import { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js';
import { Fn, vec3 } from 'three/tsl';
import { tslNormalNode, tslPositionNode, tslPosture } from "../motion.js";
import { createGui, credits, scene, tslEmissiveNode } from "./gui.js";
import { centerModel, ennodeModel, flattenModel } from "../utils.js";
import { Space } from "../space.js";

//import { SPACE, URL } from "../models/default.js";
import { SPACE, URL } from "../models/man.js";
//import { SPACE, URL } from "../models/child.js";
//import { SPACE, URL } from "../models/woman.js";



console.clear( );



var overModel = new THREE.Object3D();
scene.add( overModel );



new GLTFLoader().load( '../../assets/models/'+URL, ( gltf ) => {




	var posture = tslPosture( SPACE );

	/*
	gltf.scene.add(
		new THREE.Mesh(
			new THREE.BoxGeometry(1,2,0.001,100,200,1).translate(-0.01,1,0),
		)
	);
*/

	var dims = {};
	var model = flattenModel( gltf.scene, SPACE?._?.rot ?? [ 0, 0, 0 ]);
	centerModel( model, dims );
	var space = new Space( dims, SPACE );
	ennodeModel( model, space, posture, {	// nodes
		positionNode: tslPositionNode, // rigging
		normalNode: tslNormalNode, // lighting
		colorNode: Fn( ()=>vec3( 1, 1, 1 ) ), // optional debug texture
		//colorNode: tslColorNode, // optional debug texture
		emissiveNode: tslEmissiveNode, // optional debug heatmaps
	},
	{	// additional material properties
		color: 'tan',
		metalness: 0.3,
		roughness: 0.6,
		//wireframe: true,
	}
	);

	overModel.scale.setScalar( 1.5/dims.scale );

	createGui( dims, space, posture, model );

	credits( '../assets/models/'+URL, 'credits1' );
	//credits( ENV_MAP, 'credits2' );

	overModel.add( model );

	//console.log('dims',dims )
	//console.log('space',space)
	//console.log('posture',posture)

} );


	</script>
</body>
</html>