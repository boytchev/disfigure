<!DOCTYPE html>


<html>


<head>
	<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">

	<style>
		body { margin: 0 }
		.padded { text-align: right; padding-right: 0.5em; color: gray;}
		.border { border-top: dotted #404040 1px;}
		.icon { display:inline-block; min-width:1em; text-align: center; color: orange; font-size: 1.7em; }
	</style>
	
	<script type="importmap">
	  {
		"imports": {
			"three": "https://cdn.jsdelivr.net/npm/three@0.176.0/build/three.webgpu.min.js",
			"three/webgpu": "https://cdn.jsdelivr.net/npm/three@0.176.0/build/three.webgpu.min.js",
			"three/tsl": "https://cdn.jsdelivr.net/npm/three@0.176.0/build/three.tsl.min.js",
			"three/addons/": "https://cdn.jsdelivr.net/npm/three@0.176.0/examples/jsm/"
		}
	  }
	</script>
</head>


<body>
	<script type="module">

import * as THREE from "three";
import { float, uniform, vec2, vec3, vec4 } from "three/tsl";
import { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js';
import { createGui, scene } from "./disfigure-gui.js";
import { tslColorNode, tslEmissiveNode, tslPositionNode, tslPosture } from "./disfigure.js";
import { processModel } from "./utils.js";


console.clear( );


const MODEL_URL = '../assets/models/mc-powerful-deep-chestnut-bougainvillea-t-pose.glb';
//const MODEL_URL = '../assets/models/gwen_os.glb';
//const MODEL_URL = '../assets/models/boy_zepeto.glb'; // broken?
//const MODEL_URL = '../assets/models/casual_lowpoly_female_rig_t-pose.glb'; // orientation?
//const MODEL_URL = '../assets/models/casual_lowpoly_male_rig_t-pose.glb'; // orientation?
//const MODEL_URL = '../assets/models/skeleton_t_pose.glb'; // orientation?



var overModel = new THREE.Object3D();
scene.add( overModel );


new GLTFLoader().load( MODEL_URL, ( gltf ) => {

	var posture = tslPosture( );

	var model = processModel(
		gltf.scene,
		skeleton,
		posture,
		{
			positionNode: tslPositionNode, // rigging
			colorNode: tslColorNode, // optional debug texture
			emissiveNode: tslEmissiveNode, // optional debug marking
		} );

	createGui( skeleton, posture, model );

	overModel.add( model );

} );





var skeleton = {

	// TORSO
	headPos: vec3( 0, 2.56, -0.02 ),
	headSpan: vec2( 2.51, 2.64 ),

	chestPos: vec3( 0, 2.3, 0 ),
	chestSpan: vec2( 2.1, 2.4 ),

	waistPos: vec3( 0, 2.1, 0 ),
	waistSpan: vec2( 1.9, 2.5 ),

	// LEGS
	kneeLeftPos: uniform( vec3( 0.08, 1.655, -0.01 ) ),
	kneeLeftSpan: uniform( vec2( 1.7, 1.6 ) ),

	kneeRightPos: vec3( -0.08, 1.655, -0.01 ),
	kneeRightSpan: vec2( 1.7, 1.6 ),

	ankleLeftPos: vec3( 0.085, 1.3, -0.04 ),
	ankleLeftSpan: vec2( 1.325, 1.265 ),

	ankleRightPos: vec3( -0.085, 1.3, -0.04 ),
	ankleRightSpan: vec2( 1.325, 1.265 ),

	hipLeftPos: vec3( 0.052, 2, -0.04 ),
	hipLeftSpan: vec4( 2.3, 1.9, 1.98, 1.85 ),

	hip2LeftPos: uniform( vec3( 0.011, 2, 0.01 ) ),
	hip2LeftSpan: uniform( vec4( 2, 1.5 ) ),

	hipRightPos: vec3( -0.052, 2, -0.04 ),
	hipRightSpan: vec4( 2.3, 1.9, 1.98, 1.85 ),

	hip2RightPos: uniform( vec3( -0.011, 2, 0.01 ) ),
	hip2RightSpan: uniform( vec4( 2, 1.5 ) ),

	legLeftPos: vec3( 0.1, 2, -0.04 ),
	legLeftSpan: vec2( 1.9, 0.4 ),

	legRightPos: vec3( -0.1, 2, -0.04 ),
	legRightSpan: vec2( 2.1, 0.4 ),

	// ARMS

	elbowLeftPos: vec3( 0.42, 2.46, -0.05 ),
	elbowLeftSpan: vec2( 0.39, 0.46 ),

	elbowRightPos: vec3( -0.42, 2.46, -0.05 ),
	elbowRightSpan: vec2( -0.39, -0.46 ),

	forearmLeftPos: vec3( 0.42, 2.46, -0.05 ),
	forearmLeftSpan: vec2( 0.30, 0.70 ),

	forearmRightPos: vec3( -0.42, 2.46, -0.05 ),
	forearmRightSpan: vec2( -0.30, -0.70 ),

	wristLeftPos: vec3( 0.68, 2.45, -0.06 ),
	wristLeftSpan: vec2( 0.67, 0.69 ),

	wristRightPos: vec3( -0.68, 2.45, -0.06 ),
	wristRightSpan: vec2( -0.67, -0.69 ),

	armLeftPos: vec3( 0.17, 2.44, -0.06 ),
	armLeftSpan: vec4( 0.115, 0.215, 2.315, 2.37 ),

	armRightPos: ( vec3( -0.17, 2.44, -0.06 ) ),
	armRightSpan: ( vec4( -0.115, -0.215, 2.315, 2.37 ) ),

};

	</script>
</body>
</html>